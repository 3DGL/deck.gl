(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{"+TUu":function(e,t,n){var r;n("OeI1"),n("zGcK"),n("HXzo"),n("HQhv"),n("sc67"),n("pS08"),n("rzGZ"),n("Dq+y"),n("8npG"),n("Ggvi"),n("E5k/"),n("sC2a"),n("JHok"),n("MIFh"),n("1dPr"),function(i,a,o,s){"use strict";var c,u=["","webkit","Moz","MS","ms","o"],l=a.createElement("div"),h=Math.round,f=Math.abs,p=Date.now;function d(e,t,n){return setTimeout(_(e,n),t)}function y(e,t,n){return!!Array.isArray(e)&&(v(e,n[t],n),!0)}function v(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function b(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=i.console&&(i.console.warn||i.console.log);return a&&a.call(i.console,r,n),e.apply(this,arguments)}}c="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var g=b((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),m=b((function(e,t){return g(e,t,!0)}),"merge","Use `assign`.");function O(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&c(r,n)}function _(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function T(e,t){return void 0===e?t:e}function j(e,t,n){v(S(t),(function(t){e.addEventListener(t,n,!1)}))}function E(e,t,n){v(S(t),(function(t){e.removeEventListener(t,n,!1)}))}function k(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function x(e,t){return e.indexOf(t)>-1}function S(e){return e.trim().split(/\s+/g)}function A(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];A(i,o)<0&&r.push(e[a]),i[a]=o,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function C(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),a=0;a<u.length;){if((r=(n=u[a])?n+i:t)in e)return r;a++}}var R=1;function D(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}var N="ontouchstart"in i,L=void 0!==C(i,"PointerEvent"),M=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U=["x","y"],B=["clientX","clientY"];function z(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function V(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,a=1&t&&r-i==0,o=12&t&&r-i==0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=F(t));i>1&&!n.firstMultiple?n.firstMultiple=F(t):1===i&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,s=o?o.center:a.center,c=t.center=G(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=Z(s,c),t.distance=W(s,c),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=q(t.deltaX,t.deltaY);var u=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=f(u.x)>f(u.y)?u.x:u.y,t.scale=o?(l=o.pointers,h=r,W(h[0],h[1],B)/W(l[0],l[1],B)):1,t.rotation=o?function(e,t){return Z(t[1],t[0],B)+Z(e[1],e[0],B)}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,a,o=e.lastInterval||t,s=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(s>25||void 0===o.velocity)){var c=t.deltaX-o.deltaX,u=t.deltaY-o.deltaY,l=H(s,c,u);r=l.x,i=l.y,n=f(l.x)>f(l.y)?l.x:l.y,a=q(c,u),e.lastInterval=t}else n=o.velocity,r=o.velocityX,i=o.velocityY,a=o.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=a}(n,t);var l,h;var d=e.element;k(t.srcEvent.target,d)&&(d=t.srcEvent.target);t.target=d}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function F(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:G(t),deltaX:e.deltaX,deltaY:e.deltaY}}function G(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function H(e,t,n){return{x:t/e||0,y:n/e||0}}function q(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function W(e,t,n){n||(n=U);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Z(e,t,n){n||(n=U);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}z.prototype={handler:function(){},init:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(D(this.element),this.evWin,this.domHandler)}};var Y={mousedown:1,mousemove:2,mouseup:4};function X(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,z.apply(this,arguments)}O(X,z,{handler:function(e){var t=Y[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var J={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},K={2:"touch",3:"pen",4:"mouse",5:"kinect"},Q="pointerdown",$="pointermove pointerup pointercancel";function ee(){this.evEl=Q,this.evWin=$,z.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(Q="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel"),O(ee,z,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=J[r],a=K[e.pointerType]||e.pointerType,o="touch"==a,s=A(t,e.pointerId,"pointerId");1&i&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,z.apply(this,arguments)}function re(e,t){var n=P(e.touches),r=P(e.changedTouches);return 12&t&&(n=I(n.concat(r),"identifier",!0)),[n,r]}O(ne,z,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ae(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},z.apply(this,arguments)}function oe(e,t){var n=P(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,a,o=P(e.changedTouches),s=[],c=this.target;if(a=n.filter((function(e){return k(e.target,c)})),1===t)for(i=0;i<a.length;)r[a[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&s.push(o[i]),12&t&&delete r[o[i].identifier],i++;return s.length?[I(a.concat(s),"identifier",!0),s]:void 0}O(ae,z,{handler:function(e){var t=ie[e.type],n=oe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function se(){z.apply(this,arguments);var e=_(this.handler,this);this.touch=new ae(this.manager,e),this.mouse=new X(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ce(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ue.call(this,t)):12&e&&ue.call(this,t)}function ue(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function le(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],a=Math.abs(t-i.x),o=Math.abs(n-i.y);if(a<=25&&o<=25)return!0}return!1}O(se,z,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ce.call(this,t,n);else if(i&&le.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=C(l.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||i.CSS.supports("touch-action",n)})),e}();function de(e,t){this.manager=e,this.set(t)}de.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return v(this.manager.recognizers,(function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(x(e,"none"))return"none";var t=x(e,"pan-x"),n=x(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(x(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=x(r,"none")&&!pe.none,a=x(r,"pan-y")&&!pe["pan-y"],o=x(r,"pan-x")&&!pe["pan-x"];if(i){var s=1===e.pointers.length,c=e.distance<2,u=e.deltaTime<250;if(s&&c&&u)return}if(!o||!a)return i||a&&6&n||o&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ye(e){this.options=c({},this.defaults,e||{}),this.id=R++,this.manager=null,this.options.enable=T(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ve(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function be(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ge(e,t){var n=t.manager;return n?n.get(e):e}function me(){ye.apply(this,arguments)}function Oe(){me.apply(this,arguments),this.pX=null,this.pY=null}function _e(){me.apply(this,arguments)}function we(){ye.apply(this,arguments),this._timer=null,this._input=null}function Te(){me.apply(this,arguments)}function je(){me.apply(this,arguments)}function Ee(){ye.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ke(e,t){return(t=t||{}).recognizers=T(t.recognizers,ke.defaults.preset),new xe(e,t)}ye.prototype={defaults:{},set:function(e){return c(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(y(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ge(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return y(e,"dropRecognizeWith",this)||(e=ge(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(y(e,"requireFailure",this))return this;var t=this.requireFail;return-1===A(t,e=ge(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(y(e,"dropRequireFailure",this))return this;e=ge(e,this);var t=A(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ve(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ve(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=c({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},O(me,ye,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),O(Oe,me,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(6&t.direction?(i=0===a?1:a<0?2:4,n=a!=this.pX,r=Math.abs(e.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return me.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=be(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),O(_e,me,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),O(we,ye,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),O(Te,me,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),O(je,me,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Oe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=be(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),O(Ee,ye,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||W(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ke.VERSION="2.0.7",ke.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Te,{enable:!1}],[_e,{enable:!1},["rotate"]],[je,{direction:6}],[Oe,{direction:6},["swipe"]],[Ee],[Ee,{event:"doubletap",taps:2},["tap"]],[we]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function xe(e,t){var n;this.options=c({},ke.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(L?ee:M?ae:N?se:X))(n,V),this.touchAction=new de(this,this.options.touchAction),Se(this,!0),v(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Se(e,t){var n,r=e.element;r.style&&(v(e.options.cssProps,(function(i,a){n=C(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}xe.prototype={set:function(e){return c(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),a++}},get:function(e){if(e instanceof ye)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(y(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(y(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=A(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return v(S(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return v(S(e),(function(e){t?n[e]&&n[e].splice(A(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&Se(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(ke,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:xe,Input:z,TouchAction:de,TouchInput:ae,MouseInput:X,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:ye,AttrRecognizer:me,Tap:Ee,Pan:Oe,Swipe:je,Pinch:_e,Rotate:Te,Press:we,on:j,off:E,each:v,merge:m,extend:g,assign:c,inherit:O,bindFn:_,prefixed:C}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=ke,void 0===(r=function(){return ke}.call(t,n,t,e))||(e.exports=r)}(window,document)},"5zO3":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));n("R48M"),n("E5k/"),n("sPse"),n("Ll4R");var r=n("1OyB"),i=n("vuIU"),a=n("rePB"),o=n("BHO1"),s=n.n(o),c=n("oJR1");var u={container:s.a.object,gl:s.a.object,mapboxApiAccessToken:s.a.string,mapboxApiUrl:s.a.string,attributionControl:s.a.bool,preserveDrawingBuffer:s.a.bool,reuseMaps:s.a.bool,transformRequest:s.a.func,mapOptions:s.a.object,mapStyle:s.a.oneOfType([s.a.string,s.a.object]),visible:s.a.bool,asyncRender:s.a.bool,onLoad:s.a.func,onError:s.a.func,width:s.a.number,height:s.a.number,viewState:s.a.object,longitude:s.a.number,latitude:s.a.number,zoom:s.a.number,bearing:s.a.number,pitch:s.a.number,altitude:s.a.number},l={container:c.a.body,mapboxApiAccessToken:function(){var t=null;if("undefined"!=typeof window&&window.location){var n=window.location.search.match(/access_token=([^&\/]*)/);t=n&&n[1]}t||void 0===e||(t=t||"pk.eyJ1IjoidWJlcmRhdGEiLCJhIjoiY2pwY3owbGFxMDVwNTNxcXdwMms2OWtzbiJ9.1PPVl0VLUQgqrosrI2nUhg");return t||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:function(){},onError:function(e){e&&console.error(e.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component";e.debug&&s.a.checkPropTypes(u,e,"prop",t)}var f=function(){function e(t){var n=this;if(Object(r.a)(this,e),Object(a.a)(this,"mapboxgl",void 0),Object(a.a)(this,"props",l),Object(a.a)(this,"_map",null),Object(a.a)(this,"width",0),Object(a.a)(this,"height",0),Object(a.a)(this,"_fireLoadEvent",(function(){n.props.onLoad({type:"load",target:n._map})})),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return Object(i.a)(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=e.savedMap;var n=this._map.getContainer(),r=t.container;for(r.classList.add("mapboxgl-map");n.childNodes.length>0;)r.appendChild(n.childNodes[0]);this._map._container=r,e.savedMap=null,t.mapStyle&&this._map.setStyle(t.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&e.savedMap)this._reuse(t);else{if(t.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,t.gl}}var r={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:t.mapStyle,interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(r.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},r,t.mapOptions)),this._map.once("load",t.onLoad),this._map.on("error",t.onError)}return this}},{key:"_destroy",value:function(){this._map&&(e.savedMap?this._map.remove():(e.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(e){var t=this;h(e=Object.assign({},l,e),"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||l.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var n=e.container;Object.defineProperty(n,"offsetWidth",{get:function(){return t.width}}),Object.defineProperty(n,"clientWidth",{get:function(){return t.width}}),Object.defineProperty(n,"offsetHeight",{get:function(){return t.height}}),Object.defineProperty(n,"clientHeight",{get:function(){return t.height}});var r=this._map.getCanvas();r&&(r.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,t){if(this._map){h(t=Object.assign({},this.props,t),"Mapbox");var n=this._updateMapViewport(e,t),r=this._updateMapSize(e,t);t.asyncRender||!n&&!r||this.redraw(),this.props=t}}},{key:"_updateMapSize",value:function(e,t){var n=e.width!==t.width||e.height!==t.height;return n&&(this.width=t.width,this.height=t.height,this.resize()),n}},{key:"_updateMapViewport",value:function(e,t){var n=this._getViewState(e),r=this._getViewState(t),i=r.latitude!==n.latitude||r.longitude!==n.longitude||r.zoom!==n.zoom||r.pitch!==n.pitch||r.bearing!==n.bearing||r.altitude!==n.altitude;return i&&(this._map.jumpTo(this._viewStateToMapboxProps(r)),r.altitude!==n.altitude&&(this._map.transform.altitude=r.altitude)),i}},{key:"_getViewState",value:function(e){var t=e.viewState||e,n=t.longitude,r=t.latitude,i=t.zoom,a=t.pitch,o=void 0===a?0:a,s=t.bearing,c=void 0===s?0:s,u=t.altitude;return{longitude:n,latitude:r,zoom:i,pitch:o,bearing:c,altitude:void 0===u?1.5:u}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==c.a)try{var t=c.a.createElement("div");t.className="mapboxgl-map",t.style.display="none",c.a.body.append(t);var n="static"!==window.getComputedStyle(t).position;if(!n){var r=c.a.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),c.a.head.append(r)}}catch(i){}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),e}();Object(a.a)(f,"initialized",!1),Object(a.a)(f,"propTypes",u),Object(a.a)(f,"defaultProps",l),Object(a.a)(f,"savedMap",null)}).call(this,n("8oxB"))},"9Nty":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"decode",(function(){return wo})),n.d(r,"encode",(function(){return jo}));var i={};n.r(i),n.d(i,"decode",(function(){return Co})),n.d(i,"encode",(function(){return Ro}));var a={};n.r(a),n.d(a,"decode",(function(){return Lo})),n.d(a,"encode",(function(){return Mo}));var o={};n.r(o),n.d(o,"decode",(function(){return zo})),n.d(o,"encode",(function(){return Vo}));var s={};n.r(s),n.d(s,"decode",(function(){return Uu})),n.d(s,"encode",(function(){return zu}));var c={};n.r(c),n.d(c,"decode",(function(){return Yu})),n.d(c,"encode",(function(){return Xu}));var u={};n.r(u),n.d(u,"decode",(function(){return Qu})),n.d(u,"encode",(function(){return $u}));var l={};n.r(l),n.d(l,"decode",(function(){return nl})),n.d(l,"encode",(function(){return rl}));n("E5k/");var h=n("q1tI"),f=n.n(h),p=n("lxDd"),d=(n("xtjI"),n("4DPX"),n("rzGZ"),n("Dq+y"),n("8npG"),n("Ggvi"),n("i8i4"),n("n7j8"),n("JHok"),n("OeI1"),n("q8oJ"),n("C9fy"),n("nWfQ"),n("wx14")),y=n("1OyB"),v=n("JX7q"),b=n("vuIU"),g=n("Ji7U"),m=n("md7G"),O=n("foSv"),_=n("rePB"),w=n("BHO1"),T=n.n(w);n("9ZhD"),n("YBKJ"),n("R48M"),n("+ar0"),n("AqHK"),n("YbXK"),n("cFtU"),n("pJf4"),n("MIFh"),n("m210");function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function A(e){if(!e)return null;if("string"==typeof e)return e;e.toJS&&(e=e.toJS());var t,n={},r=k(e.layers);try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i.id]=i}}catch(o){r.e(o)}finally{r.f()}var a=e.layers.map((function(e){var t=n[e.ref],r=null;if("interactive"in e&&delete(r=E({},e)).interactive,t){delete(r=r||E({},e)).ref;var i,a=k(S);try{for(a.s();!(i=a.n()).done;){var s=i.value;s in t&&(r[s]=t[s])}}catch(o){a.e(o)}finally{a.f()}}return r||e}));return E(E({},e),{},{layers:a})}var P=n("R25c"),I=n("evtk"),C=n("5zO3"),R=n("kZXF"),D=n.n(R),N=(n("QNMc"),n("ODXe"));function L(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function M(e,t){if(e===t)return!0;if(L(e)&&L(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!M(e[n],t[n]))return!1;return!0}return Math.abs(e-t)<=1e-7}function U(e,t,n){return Math.max(t,Math.min(n,e))}function B(e,t,n){return L(e)?e.map((function(e,r){return B(e,t[r],n)})):n*t+(1-n)*e}function z(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function V(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G=function(){function e(){Object(y.a)(this,e),Object(_.a)(this,"propNames",[])}return Object(b.a)(e,[{key:"arePropsEqual",value:function(e,t){var n,r=V(this.propNames||[]);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!M(e[i],t[i]))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}},{key:"initializeProps",value:function(e,t){return{start:e,end:t}}},{key:"interpolateProps",value:function(e,t,n){z(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(e,t){return t.transitionDuration}}]),e}(),H={longitude:1,bearing:1};function q(e){return Number.isFinite(e)||Array.isArray(e)}function W(e,t,n){return function(e){return e in H}(e)&&Math.abs(n-t)>180&&(n=n<0?n+360:n-360),n}function Z(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var J=["longitude","latitude","zoom","bearing","pitch"],K=["latitude","longitude","zoom","width","height"],Q=["bearing","pitch"],$={speed:1.2,curve:1.414};!function(e){Object(g.a)(n,e);var t=X(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(y.a)(this,n),e=t.call(this),Object(_.a)(Object(v.a)(e),"speed",void 0),Object(_.a)(Object(v.a)(e),"propNames",J),Object(_.a)(Object(v.a)(e),"props",void 0),e.props=Object.assign({},$,r),e}Object(b.a)(n,[{key:"initializeProps",value:function(e,t){var n,r={},i={},a=Z(K);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=e[o],c=t[o];z(q(s)&&q(c),"".concat(o," must be supplied for transition")),r[o]=s,i[o]=W(o,s,c)}}catch(d){a.e(d)}finally{a.f()}var u,l=Z(Q);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=e[h]||0,p=t[h]||0;r[h]=f,i[h]=W(h,f,p)}}catch(d){l.e(d)}finally{l.f()}return{start:r,end:i}}},{key:"interpolateProps",value:function(e,t,n){var r,i=Object(P.d)(e,t,n,this.props),a=Z(Q);try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=B(e[o],t[o],n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"getDuration",value:function(e,t){var n=t.transitionDuration;return"auto"===n&&(n=Object(P.g)(e,t,this.props)),n}}])}(G);function ee(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var re=["longitude","latitude","zoom","bearing","pitch"],ie=function(e){Object(g.a)(n,e);var t=ne(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(y.a)(this,n),e=t.call(this),Object(_.a)(Object(v.a)(e),"around",void 0),Array.isArray(r)&&(r={transitionProps:r}),e.propNames=r.transitionProps||re,r.around&&(e.around=r.around),e}return Object(b.a)(n,[{key:"initializeProps",value:function(e,t){var n={},r={};if(this.around){n.around=this.around;var i=new P.a(e).unproject(this.around);Object.assign(r,t,{around:new P.a(t).project(i),aroundLngLat:i})}var a,o=ee(this.propNames);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=e[s],u=t[s];z(q(c)&&q(u),"".concat(s," must be supplied for transition")),n[s]=c,r[s]=W(s,c,u)}}catch(l){o.e(l)}finally{o.f()}return{start:n,end:r}}},{key:"interpolateProps",value:function(e,t,n){var r,i={},a=ee(this.propNames);try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=B(e[o],t[o],n)}}catch(h){a.e(h)}finally{a.f()}if(t.around){var s=new P.a(Object.assign({},t,i)).getMapCenterByLngLatPosition({lngLat:t.aroundLngLat,pos:B(e.around,t.around,n)}),c=Object(N.a)(s,2),u=c[0],l=c[1];i.longitude=u,i.latitude=l}return i}}]),n}(G),ae={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},oe=0,se=0,ce=1.5,ue=function(){function e(t){var n=t.width,r=t.height,i=t.latitude,a=t.longitude,o=t.zoom,s=t.bearing,c=void 0===s?se:s,u=t.pitch,l=void 0===u?oe:u,h=t.altitude,f=void 0===h?ce:h,p=t.maxZoom,d=void 0===p?ae.maxZoom:p,v=t.minZoom,b=void 0===v?ae.minZoom:v,g=t.maxPitch,m=void 0===g?ae.maxPitch:g,O=t.minPitch,w=void 0===O?ae.minPitch:O,T=t.transitionDuration,j=t.transitionEasing,E=t.transitionInterpolator,k=t.transitionInterruption,x=t.startPanLngLat,S=t.startZoomLngLat,A=t.startBearing,P=t.startPitch,I=t.startZoom;Object(y.a)(this,e),Object(_.a)(this,"_viewportProps",void 0),Object(_.a)(this,"_interactiveState",void 0),z(Number.isFinite(n),"`width` must be supplied"),z(Number.isFinite(r),"`height` must be supplied"),z(Number.isFinite(a),"`longitude` must be supplied"),z(Number.isFinite(i),"`latitude` must be supplied"),z(Number.isFinite(o),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:r,latitude:i,longitude:a,zoom:o,bearing:c,pitch:l,altitude:f,maxZoom:d,minZoom:b,maxPitch:m,minPitch:w,transitionDuration:T,transitionEasing:j,transitionInterpolator:E,transitionInterruption:k}),this._interactiveState={startPanLngLat:x,startZoomLngLat:S,startBearing:A,startPitch:P,startZoom:I}}return Object(b.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(e){var t=e.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(t)})}},{key:"pan",value:function(e){var t=e.pos,n=e.startPos,r=this._interactiveState.startPanLngLat||this._unproject(n);if(!r)return this;var i=this._calculateNewLngLat({startPanLngLat:r,pos:t}),a=Object(N.a)(i,2),o=a[0],s=a[1];return this._getUpdatedMapState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(e){e.pos;return this._getUpdatedMapState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(e){var t=e.deltaScaleX,n=void 0===t?0:t,r=e.deltaScaleY,i=void 0===r?0:r,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var c=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:i,startBearing:o||0,startPitch:s||0}),u=c.pitch,l=c.bearing;return this._getUpdatedMapState({bearing:l,pitch:u})}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(e){var t=e.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(t),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(e){var t=e.pos,n=e.startPos,r=e.scale;z(r>0,"`scale` must be a positive number");var i=this._interactiveState,a=i.startZoom,o=i.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(n)||this._unproject(t)),z(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:r,startZoom:a||0}),c=new P.a(Object.assign({},this._viewportProps,{zoom:s})).getMapCenterByLngLatPosition({lngLat:o,pos:t}),u=Object(N.a)(c,2),l=u[0],h=u[1];return this._getUpdatedMapState({zoom:s,longitude:l,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(e){var t=e.maxZoom,n=e.minZoom,r=e.zoom;e.zoom=U(r,n,t);var i=e.maxPitch,a=e.minPitch,o=e.pitch;return e.pitch=U(o,a,i),Object.assign(e,Object(P.l)(e)),e}},{key:"_unproject",value:function(e){var t=new P.a(this._viewportProps);return e&&t.unproject(e)}},{key:"_calculateNewLngLat",value:function(e){var t=e.startPanLngLat,n=e.pos;return new P.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"_calculateNewZoom",value:function(e){var t=e.scale,n=e.startZoom,r=this._viewportProps,i=r.maxZoom,a=r.minZoom;return U(n+Math.log2(t),a,i)}},{key:"_calculateNewPitchAndBearing",value:function(e){var t=e.deltaScaleX,n=e.deltaScaleY,r=e.startBearing,i=e.startPitch;n=U(n,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,c=i;return n>0?c=i+n*(s-i):n<0&&(c=i-n*(o-i)),{pitch:c,bearing:r+180*t}}}]),e}();function le(e){return e[0].toLowerCase()+e.slice(1)}var he=Object(h.createContext)({viewport:null,map:null,mapContainer:null,onViewportChange:null,onViewStateChange:null,eventManager:null,isDragging:!1});function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var ye="A valid API access token is required to use Mapbox data";var ve={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},be=Object.assign({},C.a.propTypes,{width:T.a.oneOfType([T.a.number,T.a.string]),height:T.a.oneOfType([T.a.number,T.a.string]),onResize:T.a.func,preventStyleDiffing:T.a.bool,disableTokenWarning:T.a.bool,visible:T.a.bool,className:T.a.string,style:T.a.object,visibilityConstraints:T.a.object}),ge=Object.assign({},C.a.defaultProps,{preventStyleDiffing:!1,disableTokenWarning:!1,visible:!0,onResize:function(){},className:"",style:null,visibilityConstraints:ae}),me=function(e){Object(g.a)(n,e);var t=de(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"state",{accessTokenInvalid:!1}),Object(_.a)(Object(v.a)(e),"_mapbox",null),Object(_.a)(Object(v.a)(e),"_map",null),Object(_.a)(Object(v.a)(e),"_mapboxMapRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(e),"_mapContainerRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(e),"_queryParams",{}),Object(_.a)(Object(v.a)(e),"_width",0),Object(_.a)(Object(v.a)(e),"_height",0),Object(_.a)(Object(v.a)(e),"getMap",(function(){return e._map})),Object(_.a)(Object(v.a)(e),"queryRenderedFeatures",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e._map.queryRenderedFeatures(t,n)})),Object(_.a)(Object(v.a)(e),"_mapboxMapError",(function(t){401!==(t.error&&t.error.status||t.status)||e.state.accessTokenInvalid||(console.error(ye),e.setState({accessTokenInvalid:!0})),e.props.onError(t)})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){if(n.supported()){var e=this.props.mapStyle;this._mapbox=new C.a(Object.assign({},this.props,{mapboxgl:D.a,width:this._width,height:this._height,container:this._mapboxMapRef.current,onError:this._mapboxMapError,mapStyle:A(e)})),this._map=this._mapbox.getMap()}}},{key:"componentDidUpdate",value:function(e){this._mapbox&&(this._updateMapStyle(e,this.props),this._updateMapProps(this.props))}},{key:"componentWillUnmount",value:function(){this._mapbox&&(this._mapbox.finalize(),this._mapbox=null,this._map=null)}},{key:"_updateMapSize",value:function(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this._updateMapProps(this.props))}},{key:"_updateMapStyle",value:function(e,t){var n=t.mapStyle;n!==e.mapStyle&&n&&this._map.setStyle(A(n),{diff:!this.props.preventStyleDiffing})}},{key:"_updateMapProps",value:function(e){this._mapbox&&this._mapbox.setProps(Object.assign({},e,{width:this._width,height:this._height}))}},{key:"_renderNoTokenWarning",value:function(){if(this.state.accessTokenInvalid&&!this.props.disableTokenWarning){return h.createElement("div",{key:"warning",id:"no-token-warning",style:{position:"absolute",left:0,top:0}},h.createElement("h3",{key:"header"},"NO_TOKEN_WARNING"),h.createElement("div",{key:"text"},"For information on setting up your basemap, read"),h.createElement("a",{key:"link",href:"https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens"},"Note on Map Tokens"))}return null}},{key:"_renderOverlays",value:function(e){var t=this,n=e.width,r=void 0===n?Number(this.props.width):n,i=e.height,a=void 0===i?Number(this.props.height):i;return this._updateMapSize(r,a),h.createElement(he.Consumer,null,(function(e){var n=pe(pe({},e),{},{viewport:new P.a(pe(pe(pe({},t.props),t.props.viewState),{},{width:r,height:a})),map:t._map,mapContainer:e.mapContainer||t._mapContainerRef.current});return h.createElement(he.Provider,{value:n},h.createElement("div",{key:"map-overlays",className:"overlays",style:ve},t.props.children))}))}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.width,r=e.height,i=e.style,a=e.visibilityConstraints,o=Object.assign({position:"relative"},i,{width:n,height:r}),s=this.props.visible&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae;for(var n in t){var r=n.slice(0,3),i=le(n.slice(3));if("min"===r&&e[i]<t[n])return!1;if("max"===r&&e[i]>t[n])return!1}return!0}(this.props.viewState||this.props,a),c=Object.assign({},ve,{visibility:s?"inherit":"hidden"});return h.createElement("div",{key:"map-container",style:o,ref:this._mapContainerRef},h.createElement("div",{key:"map-mapbox",ref:this._mapboxMapRef,style:c,className:t}),h.createElement(I.a,{key:"autosizer",disableWidth:Number.isFinite(n),disableHeight:Number.isFinite(r),onResize:this.props.onResize},this._renderOverlays.bind(this)),this._renderNoTokenWarning())}}],[{key:"supported",value:function(){return D.a&&D.a.supported()}}]),n}(h.PureComponent);Object(_.a)(me,"propTypes",be),Object(_.a)(me,"defaultProps",ge);n("1dPr");var Oe=function(){};var _e=1,we=2,Te=3,je=4,Ee={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new ie,transitionInterruption:_e,onTransitionStart:Oe,onTransitionInterrupt:Oe,onTransitionEnd:Oe,onViewportChange:Oe,onStateChange:Oe},ke=function(){function e(t,n){var r=this;Object(y.a)(this,e),Object(_.a)(this,"props",void 0),Object(_.a)(this,"state",void 0),Object(_.a)(this,"time",void 0),Object(_.a)(this,"_animationFrame",null),Object(_.a)(this,"_onTransitionFrame",(function(){r._animationFrame=requestAnimationFrame(r._onTransitionFrame),r._updateViewport()})),t&&(this.props=t),this.time=n||Date.now}return Object(b.a)(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(e){var t=this.props;if(this.props=e,this._shouldIgnoreViewportChange(t,e))return!1;if(this._isTransitionEnabled(e)){var n=Object.assign({},t),r=Object.assign({},e);if(this._isTransitionInProgress()&&(t.onTransitionInterrupt(),this.state.interruption===we?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===je)){var i=this.time(),a=(i-this.state.startTime)/this.state.duration;r.transitionDuration=this.state.duration-(i-this.state.startTime),r.transitionEasing=function(e,t){var n=e(t);return function(r){return 1/(1-n)*(e(r*(1-t)+t)-n)}}(this.state.easing,a),r.transitionInterpolator=n.transitionInterpolator}return r.onTransitionStart(),this._triggerTransition(n,r),!0}return this._isTransitionInProgress()&&(t.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(e){var t=e.transitionDuration,n=e.transitionInterpolator;return(t>0||"auto"===t)&&Boolean(n)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return!!this.state.propsInTransition&&this.state.interpolator.arePropsEqual(e,this.state.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(e,t){return!e||(this._isTransitionInProgress()?this.state.interruption===Te||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t))}},{key:"_triggerTransition",value:function(e,t){z(this._isTransitionEnabled(t)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=t.transitionInterpolator,r=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0!==r){var i=t.transitionInterpolator.initializeProps(e,t),a={inTransition:!0,isZooming:e.zoom!==t.zoom,isPanning:e.longitude!==t.longitude||e.latitude!==t.latitude,isRotating:e.bearing!==t.bearing||e.pitch!==t.pitch};this.state={duration:r,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startTime:this.time(),startProps:i.start,endProps:i.end,animation:null,propsInTransition:{},interactionState:a},this._onTransitionFrame(),this.props.onStateChange(a)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.props.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var e=this.time(),t=this.state,n=t.startTime,r=t.duration,i=t.easing,a=t.interpolator,o=t.startProps,s=t.endProps,c=!1,u=(e-n)/r;u>=1&&(u=1,c=!0),u=i(u);var l=a.interpolateProps(o,s,u),h=new ue(Object.assign({},this.props,l));this.state.propsInTransition=h.getViewportProps(),this.props.onViewportChange(this.state.propsInTransition,this.state.interactionState,this.props),c&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();Object(_.a)(ke,"defaultProps",Ee);n("xJgp");var xe,Se,Ae=n("+TUu"),Pe=n.n(Ae),Ie={mousedown:1,mousemove:2,mouseup:4};xe=Pe.a.PointerEventInput,Se=xe.prototype.handler,xe.prototype.handler=function(e){var t=this.store;e.button>0&&(function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}(t,(function(t){return t.pointerId===e.pointerId}))||t.push(e)),Se.call(this,e)},Pe.a.MouseInput.prototype.handler=function(e){var t=Ie[e.type];1&t&&e.button>=0&&(this.pressed=!0),2&t&&0===e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))};var Ce=Pe.a.Manager,Re=Pe.a,De=(n("sc67"),Re?[[Re.Rotate,{enable:!1}],[Re.Pinch,{enable:!1}],[Re.Swipe,{enable:!1}],[Re.Pan,{threshold:0,enable:!1}],[Re.Press,{enable:!1}],[Re.Tap,{event:"doubletap",taps:2,enable:!1}],[Re.Tap,{event:"anytap",enable:!1}],[Re.Tap,{enable:!1}]]:null),Ne={rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Le={doubletap:["tap"]},Me={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ue=["keydown","keyup"],Be=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],ze=["wheel","mousewheel","DOMMouseScroll"],Ve={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Fe={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Ge=n("q8n8"),He=-1!==Ge.b.indexOf("firefox"),qe=ze,We=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(y.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},i),this.events=qe.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(e){return t.addEventListener(e,r.handleEvent,!!Ge.a&&{passive:!1})}))}return Object(b.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))}},{key:"enableEventType",value:function(e,t){"wheel"===e&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){if(this.options.enable){var t=e.deltaY;Ge.c.WheelEvent&&(He&&e.deltaMode===Ge.c.WheelEvent.DOM_DELTA_PIXEL&&(t/=Ge.c.devicePixelRatio),e.deltaMode===Ge.c.WheelEvent.DOM_DELTA_LINE&&(t*=40));var n={x:e.clientX,y:e.clientY};0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this._onWheel(e,-t,n)}}},{key:"_onWheel",value:function(e,t,n){this.callback({type:"wheel",center:n,delta:t,srcEvent:e,pointerType:"mouse",target:e.target})}}]),e}(),Ze=Be,Ye=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(y.a)(this,e),this.element=t,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=Ze.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(e){return t.addEventListener(e,r.handleEvent)}))}return Object(b.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))}},{key:"enableEventType",value:function(e,t){"pointermove"===e&&(this.enableMoveEvent=t),"pointerover"===e&&(this.enableOverEvent=t),"pointerout"===e&&(this.enableOutEvent=t),"pointerleave"===e&&(this.enableLeaveEvent=t)}},{key:"handleEvent",value:function(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}},{key:"handleOverEvent",value:function(e){this.enableOverEvent&&"mouseover"===e.type&&this.callback({type:"pointerover",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleOutEvent",value:function(e){this.enableOutEvent&&"mouseout"===e.type&&this.callback({type:"pointerout",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleLeaveEvent",value:function(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this.callback({type:"pointerleave",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleMoveEvent",value:function(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1}}}]),e}(),Xe=Ue,Je=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(y.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=Xe.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),t.tabIndex=i.tabIndex||0,t.style.outline="none",this.events.forEach((function(e){return t.addEventListener(e,r.handleEvent)}))}return Object(b.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))}},{key:"enableEventType",value:function(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}},{key:"handleEvent",value:function(e){var t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))}}]),e}(),Ke=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(y.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),t.addEventListener("contextmenu",this.handleEvent)}return Object(b.a)(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(e,t){"contextmenu"===e&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}]),e}(),Qe=(n("wZFJ"),n("U8pU")),$e={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};var et={srcElement:"root",priority:0},tt=function(){function e(t){Object(y.a)(this,e),this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}return Object(b.a)(e,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.handlers,o=this.handlersByElement;n&&("object"!==Object(Qe.a)(n)||n.addEventListener)&&(n={srcElement:n}),n=n?Object.assign({},et,n):et;var s=o.get(n.srcElement);s||(s=[],o.set(n.srcElement,s));var c={type:e,handler:t,srcElement:n.srcElement,priority:n.priority};r&&(c.once=!0),i&&(c.passive=!0),a.push(c),this._active=this._active||!c.passive;for(var u=s.length-1;u>=0&&!(s[u].priority>=c.priority);)u--;s.splice(u+1,0,c)}},{key:"remove",value:function(e,t){for(var n=this.handlers,r=this.handlersByElement,i=n.length-1;i>=0;i--){var a=n[i];if(a.type===e&&a.handler===t){n.splice(i,1);var o=r.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&r.delete(a.srcElement)}}this._active=n.some((function(e){return!e.passive}))}},{key:"handleEvent",value:function(e){if(!this.isEmpty()){for(var t=this._normalizeEvent(e),n=e.srcEvent.target;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")}}},{key:"_emit",value:function(e,t){var n=this.handlersByElement.get(t);if(n){for(var r=!1,i=function(){e.handled=!0},a=function(){e.handled=!0,r=!0},o=[],s=0;s<n.length;s++){var c=n[s],u=c.type,l=c.handler,h=c.once;if(l(Object.assign({},e,{type:u,stopPropagation:i,stopImmediatePropagation:a})),h&&o.push(n[s]),r)break}for(var f=0;f<o.length;f++){var p=o[f];u=p.type,l=p.handler;this.remove(u,l)}}}},{key:"_normalizeEvent",value:function(e){var t=this.eventManager.element;return Object.assign({},e,function(e){var t=$e[e.srcEvent.type];if(!t)return null;var n=e.srcEvent,r=n.buttons,i=n.button,a=n.which,o=!1,s=!1,c=!1;return 4===t||2===t&&!Number.isFinite(r)?(o=1===a,s=2===a,c=3===a):2===t?(o=Boolean(1&r),s=Boolean(4&r),c=Boolean(2&r)):1===t&&(o=0===i,s=1===i,c=2===i),{leftButton:o,middleButton:s,rightButton:c}}(e),function(e,t){var n=e.srcEvent;if(!e.center&&!Number.isFinite(n.clientX))return null;var r=e.center||{x:n.clientX,y:n.clientY},i=t.getBoundingClientRect(),a=i.width/t.offsetWidth,o=i.height/t.offsetHeight;return{center:r,offsetCenter:{x:(r.x-i.left-t.clientLeft)/a,y:(r.y-i.top-t.clientTop)/o}}}(e,t),{handled:!1,rootElement:t})}}]),e}(),nt={events:null,recognizers:null,recognizerOptions:{},Manager:Ce,touchAction:"none",tabIndex:0},rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(y.a)(this,e),this.options=Object.assign({},nt,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(t);var r=n.events;r&&this.on(r)}return Object(b.a)(e,[{key:"setElement",value:function(e){var t=this;if(this.element&&this.destroy(),this.element=e,e){var n=this.options,r=n.Manager;for(var i in this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||De}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Ne).forEach((function(e){var n=t.manager.get(e);n&&Ne[e].forEach((function(e){n.recognizeWith(e)}))})),n.recognizerOptions){var a=this.manager.get(i);if(a){var o=n.recognizerOptions[i];delete o.enable,a.set(o)}}this.wheelInput=new We(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Ye(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Je(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new Ke(e,this._onOtherEvent,{enable:!1});var s=!0,c=!1,u=void 0;try{for(var l,h=this.events[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=Object(N.a)(l.value,2),p=f[0],d=f[1];d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(p,d.handleEvent))}}catch(y){c=!0,u=y}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,t,n){this._addEventHandler(e,t,n,!1)}},{key:"once",value:function(e,t,n){this._addEventHandler(e,t,n,!0)}},{key:"watch",value:function(e,t,n){this._addEventHandler(e,t,n,!1,!0)}},{key:"off",value:function(e,t){this._removeEventHandler(e,t)}},{key:"_toggleRecognizer",value:function(e,t){var n=this.manager;if(n){var r=n.get(e);if(r&&r.options.enable!==t){r.set({enable:t});var i=Le[e];i&&!this.options.recognizers&&i.forEach((function(i){var a=n.get(i);t?(a.requireFailure(e),r.dropRequireFailure(i)):a.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}}},{key:"_addEventHandler",value:function(e,t,n,r,i){if("string"==typeof e){var a=this.manager,o=this.events,s=Fe[e]||e,c=o.get(s);c||(c=new tt(this),o.set(s,c),c.recognizerName=Ve[s]||s,a&&a.on(s,c.handleEvent)),c.add(e,t,n,r,i),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}else for(var u in n=t,e)this._addEventHandler(u,e[u],n,r,i)}},{key:"_removeEventHandler",value:function(e,t){if("string"==typeof e){var n=this.events,r=Fe[e]||e,i=n.get(r);if(i&&(i.remove(e,t),i.isEmpty())){var a=i.recognizerName,o=!1,s=!0,c=!1,u=void 0;try{for(var l,h=n.values()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=l.value;if(f.recognizerName===a&&!f.isEmpty()){o=!0;break}}}catch(d){c=!0,u=d}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}o||this._toggleRecognizer(a,!1)}}else for(var p in e)this._removeEventHandler(p,e[p])}},{key:"_onBasicInput",value:function(e){var t=e.srcEvent,n=Me[t.type];n&&this.manager.emit(n,e)}},{key:"_onOtherEvent",value:function(e){this.manager.emit(e.type,e)}}]),e}();var it={transitionDuration:0},at={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new ie,transitionInterruption:_e},ot=["wheel"],st=["panstart","panmove","panend"],ct=["pinchstart","pinchmove","pinchend","pinchcancel"],ut=["doubletap"],lt=["keydown"],ht=function(){function e(){var t=this;Object(y.a)(this,e),Object(_.a)(this,"events",[]),Object(_.a)(this,"mapState",void 0),Object(_.a)(this,"onViewportChange",void 0),Object(_.a)(this,"onStateChange",void 0),Object(_.a)(this,"mapStateProps",void 0),Object(_.a)(this,"eventManager",void 0),Object(_.a)(this,"scrollZoom",!0),Object(_.a)(this,"dragPan",!0),Object(_.a)(this,"dragRotate",!0),Object(_.a)(this,"doubleClickZoom",!0),Object(_.a)(this,"touchZoom",!0),Object(_.a)(this,"touchRotate",!1),Object(_.a)(this,"keyboard",!0),Object(_.a)(this,"_state",{isDragging:!1}),Object(_.a)(this,"_events",{}),Object(_.a)(this,"_transitionManager",new ke),Object(_.a)(this,"setState",(function(e){Object.assign(t._state,e),t.onStateChange&&t.onStateChange(t._state)})),this.handleEvent=this.handleEvent.bind(this),this._onWheelEnd=function(e,t){var n,r,i,a=function(){return i=null,e.apply(n,r)};return function(){n=this,r=arguments,i&&clearTimeout(i),i=setTimeout(a,t)}}(this._onWheelEnd,100)}return Object(b.a)(e,[{key:"handleEvent",value:function(e){switch(this.mapState=this.getMapState(),e.type){case"panstart":return this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchcancel":case"pinchend":return this._onPinchEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"getCenter",value:function(e){var t=e.offsetCenter;return[t.x,t.y]}},{key:"isFunctionKeyPressed",value:function(e){var t=e.srcEvent;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}},{key:"updateViewport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.mapState?this.mapState.getViewportProps():{},i=Object.assign({},e.getViewportProps(),t),a=Object.keys(i).some((function(e){return r[e]!==i[e]}));a&&this.onViewportChange(i,n,r),this.setState(Object.assign({},e.getInteractiveState(),n))}},{key:"getMapState",value:function(e){return new ue(Object.assign({},this.mapStateProps,this._state,e))}},{key:"setOptions",value:function(e){var t=e.onViewportChange,n=e.onStateChange,r=e.eventManager,i=void 0===r?this.eventManager:r,a=e.isInteractive,o=void 0===a||a,s=e.scrollZoom,c=void 0===s?this.scrollZoom:s,u=e.dragPan,l=void 0===u?this.dragPan:u,h=e.dragRotate,f=void 0===h?this.dragRotate:h,p=e.doubleClickZoom,d=void 0===p?this.doubleClickZoom:p,y=e.touchZoom,v=void 0===y?this.touchZoom:y,b=e.touchRotate,g=void 0===b?this.touchRotate:b,m=e.keyboard,O=void 0===m?this.keyboard:m;this.onViewportChange=t,this.onStateChange=n;var _=!this.mapStateProps||this.mapStateProps.height!==e.height;this.mapStateProps=e,_&&this.updateViewport(new ue(e)),this._transitionManager.processViewportChange(Object.assign({},e,{onStateChange:this.setState})),this.eventManager!==i&&(this.eventManager=i,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(ot,o&&c),this.toggleEvents(st,o&&(l||f)),this.toggleEvents(ct,o&&(v||g)),this.toggleEvents(ut,o&&d),this.toggleEvents(lt,o&&O),this.scrollZoom=c,this.dragPan=l,this.dragRotate=f,this.doubleClickZoom=d,this.touchZoom=v,this.touchRotate=g,this.keyboard=O}},{key:"toggleEvents",value:function(e,t){var n=this;this.eventManager&&e.forEach((function(e){n._events[e]!==t&&(n._events[e]=t,t?n.eventManager.on(e,n.handleEvent):n.eventManager.off(e,n.handleEvent))}))}},{key:"_onPanStart",value:function(e){var t=this.getCenter(e),n=this.mapState.panStart({pos:t}).rotateStart({pos:t});return this.updateViewport(n,it,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isFunctionKeyPressed(e)||e.rightButton?this._onPanRotate(e):this._onPanMove(e)}},{key:"_onPanEnd",value:function(e){var t=this.mapState.panEnd().rotateEnd();return this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var t=this.getCenter(e),n=this.mapState.pan({pos:t});return this.updateViewport(n,it,{isPanning:!0}),!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var t=e.deltaX,n=e.deltaY,r=this.getCenter(e),i=Object(N.a)(r,2)[1],a=i-n,o=this.mapState.getViewportProps(),s=o.width,c=o.height,u=t/s,l=0;n>0?Math.abs(c-a)>5&&(l=n/(a-c)*1.2):n<0&&a>5&&(l=1-i/a),l=Math.min(1,Math.max(-1,l));var h=this.mapState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(h,it,{isRotating:!0}),!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;e.preventDefault();var t=this.getCenter(e),n=e.delta,r=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==r&&(r=1/r);var i=this.mapState.zoom({pos:t,scale:r});return this.updateViewport(i,it,{isZooming:!0}),this._onWheelEnd(),!0}},{key:"_onWheelEnd",value:function(){this.setState({isZooming:!1})}},{key:"_onPinchStart",value:function(e){var t=this.getCenter(e),n=this.mapState.zoomStart({pos:t}).rotateStart({pos:t});return this._state.startPinchRotation=e.rotation,this.updateViewport(n,it,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate)return!1;var t=this.mapState;if(this.touchZoom){var n=e.scale,r=this.getCenter(e);t=t.zoom({pos:r,scale:n})}if(this.touchRotate){var i=e.rotation,a=this._state.startPinchRotation;t=t.rotate({deltaScaleX:-(i-a)/180})}return this.updateViewport(t,it,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(e){var t=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var t=this.getCenter(e),n=this.isFunctionKeyPressed(e),r=this.mapState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(r,Object.assign({},at,{transitionInterpolator:new ie({around:t})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var t,n=this.isFunctionKeyPressed(e),r=this.mapStateProps;switch(e.srcEvent.keyCode){case 189:t=n?this.getMapState({zoom:r.zoom-2}):this.getMapState({zoom:r.zoom-1});break;case 187:t=n?this.getMapState({zoom:r.zoom+2}):this.getMapState({zoom:r.zoom+1});break;case 37:t=n?this.getMapState({bearing:r.bearing-15}):this.mapState.pan({pos:[100,0],startPos:[0,0]});break;case 39:t=n?this.getMapState({bearing:r.bearing+15}):this.mapState.pan({pos:[-100,0],startPos:[0,0]});break;case 38:t=n?this.getMapState({pitch:r.pitch+10}):this.mapState.pan({pos:[0,100],startPos:[0,0]});break;case 40:t=n?this.getMapState({pitch:r.pitch-10}):this.mapState.pan({pos:[0,-100],startPos:[0,0]});break;default:return!1}return this.updateViewport(t,at)}}]),e}(),ft=[{old:"onChangeViewport",new:"onViewportChange"},{old:"perspectiveEnabled",new:"dragRotate"},{old:"onHoverFeatures",new:"onHover"},{old:"onClickFeatures",new:"onClick"},{old:"touchZoomRotate",new:"touchZoom, touchRotate"},{old:"mapControls",new:"controller"}];function pt(e){return"react-map-gl: `".concat(e,"` is removed.")}function dt(e){return"Use `".concat(e,"` instead.")}function yt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft.forEach((function(t){if(e.hasOwnProperty(t.old)){var n=pt(t.old);t.new&&(n="".concat(n," ").concat(dt(t.new))),console.warn(n)}}))}function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var bt=Object.assign({},me.propTypes,{maxZoom:T.a.number,minZoom:T.a.number,maxPitch:T.a.number,minPitch:T.a.number,onViewStateChange:T.a.func,onViewportChange:T.a.func,onInteractionStateChange:T.a.func,transitionDuration:T.a.oneOfType([T.a.number,T.a.string]),transitionInterpolator:T.a.object,transitionInterruption:T.a.number,transitionEasing:T.a.func,onTransitionStart:T.a.func,onTransitionInterrupt:T.a.func,onTransitionEnd:T.a.func,scrollZoom:T.a.bool,dragPan:T.a.bool,dragRotate:T.a.bool,doubleClickZoom:T.a.bool,touchZoom:T.a.bool,touchRotate:T.a.bool,keyboard:T.a.bool,onHover:T.a.func,onClick:T.a.func,onDblClick:T.a.func,onContextMenu:T.a.func,onMouseDown:T.a.func,onMouseMove:T.a.func,onMouseUp:T.a.func,onTouchStart:T.a.func,onTouchMove:T.a.func,onTouchEnd:T.a.func,onMouseEnter:T.a.func,onMouseLeave:T.a.func,onMouseOut:T.a.func,onWheel:T.a.func,touchAction:T.a.string,clickRadius:T.a.number,interactiveLayerIds:T.a.array,getCursor:T.a.func,controller:T.a.instanceOf(ht)}),gt=Object.assign({},me.defaultProps,ae,ke.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",clickRadius:0,getCursor:function(e){var t=e.isDragging,n=e.isHovering;return t?"grabbing":n?"pointer":"grab"}}),mt=function(e){Object(g.a)(n,e);var t=vt(n);function n(e){var r;return Object(y.a)(this,n),r=t.call(this,e),Object(_.a)(Object(v.a)(r),"state",{isLoaded:!1,isDragging:!1,isHovering:!1}),Object(_.a)(Object(v.a)(r),"_controller",void 0),Object(_.a)(Object(v.a)(r),"_eventManager",void 0),Object(_.a)(Object(v.a)(r),"_interactiveContext",void 0),Object(_.a)(Object(v.a)(r),"_width",0),Object(_.a)(Object(v.a)(r),"_height",0),Object(_.a)(Object(v.a)(r),"_eventCanvasRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(r),"_staticMapRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(r),"getMap",(function(){return r._staticMapRef.current?r._staticMapRef.current.getMap():null})),Object(_.a)(Object(v.a)(r),"queryRenderedFeatures",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.getMap();return n&&n.queryRenderedFeatures(e,t)})),Object(_.a)(Object(v.a)(r),"_onInteractionStateChange",(function(e){var t=e.isDragging,n=void 0!==t&&t;n!==r.state.isDragging&&(r._updateInteractiveContext({isDragging:n}),r.setState({isDragging:n}));var i=r.props.onInteractionStateChange;i&&i(e)})),Object(_.a)(Object(v.a)(r),"_onResize",(function(e){var t=e.width,n=e.height;r._width=t,r._height=n,r._setControllerProps(r.props),r.props.onResize({width:t,height:n})})),Object(_.a)(Object(v.a)(r),"_onViewportChange",(function(e,t,n){var i=r.props,a=i.onViewStateChange,o=i.onViewportChange;a&&a({viewState:e,interactionState:t,oldViewState:n}),o&&o(e,t,n)})),Object(_.a)(Object(v.a)(r),"_onLoad",(function(e){r.setState({isLoaded:!0}),r.props.onLoad(e)})),Object(_.a)(Object(v.a)(r),"_onEvent",(function(e,t){var n=r.props[e];n&&n(r._normalizeEvent(t))})),Object(_.a)(Object(v.a)(r),"_onPointerDown",(function(e){switch(e.pointerType){case"touch":r._onEvent("onTouchStart",e);break;default:r._onEvent("onMouseDown",e)}})),Object(_.a)(Object(v.a)(r),"_onPointerUp",(function(e){switch(e.pointerType){case"touch":r._onEvent("onTouchEnd",e);break;default:r._onEvent("onMouseUp",e)}})),Object(_.a)(Object(v.a)(r),"_onPointerMove",(function(e){switch(e.pointerType){case"touch":r._onEvent("onTouchMove",e);break;default:r._onEvent("onMouseMove",e)}if(!r.state.isDragging){var t,n=r.props,i=n.onHover,a=n.interactiveLayerIds;e=r._normalizeEvent(e),r.state.isLoaded&&(a||i)&&(t=r._getFeatures({pos:e.point,radius:r.props.clickRadius})),i&&(e.features=t,i(e));var o=Boolean(a&&t&&t.length>0),s=o&&!r.state.isHovering,c=!o&&r.state.isHovering;s&&r._onEvent("onMouseEnter",e),c&&r._onEvent("onMouseLeave",e),(s||c)&&r.setState({isHovering:o})}})),Object(_.a)(Object(v.a)(r),"_onClick",(function(e){var t=r.props,n=t.onClick,i=t.onNativeClick,a=t.onDblClick,o=t.doubleClickZoom,s=[],c=a||o;switch(e.type){case"anyclick":s.push(i),c||s.push(n);break;case"click":c&&s.push(n)}(s=s.filter(Boolean)).length&&((e=r._normalizeEvent(e)).features=r._getFeatures({pos:e.point,radius:r.props.clickRadius}),s.forEach((function(t){return t(e)})))})),yt(e),r._controller=e.controller||new ht,r._eventManager=new rt(null,{touchAction:e.touchAction}),r._updateInteractiveContext({isDragging:!1,eventManager:r._eventManager}),r}return Object(b.a)(n,null,[{key:"supported",value:function(){return me.supported()}}]),Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this._eventManager,t=this._eventCanvasRef.current;e.setElement(t),e.on({pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerup:this._onPointerUp,pointerleave:this._onEvent.bind(this,"onMouseOut"),click:this._onClick,anyclick:this._onClick,dblclick:this._onEvent.bind(this,"onDblClick"),wheel:this._onEvent.bind(this,"onWheel"),contextmenu:this._onEvent.bind(this,"onContextMenu")}),this._setControllerProps(this.props),this._updateInteractiveContext({mapContainer:t})}},{key:"componentDidUpdate",value:function(){this._setControllerProps(this.props)}},{key:"componentWillUnmount",value:function(){this._eventManager.destroy()}},{key:"_setControllerProps",value:function(e){e=Object.assign({},e,e.viewState,{isInteractive:Boolean(e.onViewStateChange||e.onViewportChange),onViewportChange:this._onViewportChange,onStateChange:this._onInteractionStateChange,eventManager:this._eventManager,width:this._width,height:this._height}),this._controller.setOptions(e);var t=this._interactiveContext;t.onViewportChange=e.onViewportChange,t.onViewStateChange=e.onViewStateChange}},{key:"_getFeatures",value:function(e){var t,n=e.pos,r=e.radius,i={},a=this.getMap();if(this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds),r){var o=r,s=[[n[0]-o,n[1]+o],[n[0]+o,n[1]-o]];t=a&&a.queryRenderedFeatures(s,i)}else t=a&&a.queryRenderedFeatures(n,i);return t}},{key:"_updateInteractiveContext",value:function(e){this._interactiveContext=Object.assign({},this._interactiveContext,e)}},{key:"_normalizeEvent",value:function(e){if(e.lngLat)return e;var t=e.offsetCenter,n=[t.x,t.y],r=new P.a(Object.assign({},this.props,{width:this._width,height:this._height}));return e.point=n,e.lngLat=r.unproject(n),e}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,r=e.style,i=e.getCursor,a=Object.assign({position:"relative"},r,{width:t,height:n,cursor:i(this.state)});return h.createElement(he.Provider,{value:this._interactiveContext},h.createElement("div",{key:"event-canvas",ref:this._eventCanvasRef,style:a},h.createElement(me,Object(d.a)({},this.props,{width:"100%",height:"100%",style:null,onResize:this._onResize,onLoad:this._onLoad,ref:this._staticMapRef}),this.props.children)))}}]),n}(h.PureComponent);function Ot(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Ot(e[n],t[n]))return!1;return!0}if(Array.isArray(t))return!1;if("object"===Object(Qe.a)(e)&&"object"===Object(Qe.a)(t)){var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var a=0,o=r;a<o.length;a++){var s=o[a];if(!t.hasOwnProperty(s))return!1;if(!Ot(e[s],t[s]))return!1}return!0}return!1}function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(mt,"propTypes",bt),Object(_.a)(mt,"defaultProps",gt);var wt={type:T.a.string.isRequired,id:T.a.string},Tt=0,jt=function(e){Object(g.a)(n,e);var t=_t(n);function n(e){var r;return Object(y.a)(this,n),r=t.call(this,e),Object(_.a)(Object(v.a)(r),"id",void 0),Object(_.a)(Object(v.a)(r),"type",void 0),Object(_.a)(Object(v.a)(r),"_map",null),Object(_.a)(Object(v.a)(r),"_sourceOptions",{}),Object(_.a)(Object(v.a)(r),"_updateSource",(function(){var e=Object(v.a)(r),t=e.type;if(e._map){var n=Object(v.a)(r),i=n._sourceOptions,a=n.props;z(!a.id||a.id===r.id,"source id changed"),z(a.type===t,"source type changed");var o="",s=0;for(var c in a)"children"===c||"id"===c||Ot(i[c],a[c])||(i[c]=a[c],o=c,s++);var u=r.getSource();u?s&&("geojson"===t?u.setData(i.data):"image"===t?u.updateImage({url:i.url,coordinates:i.coordinates}):"canvas"!==t&&"video"!==t||1!==s||"coordinates"!==o?console.warn("Unable to update <Source> prop: ".concat(o)):u.setCoordinates(i.coordinates)):r._createSource(i)}})),r.id=e.id||"jsx-source-".concat(Tt++),r.type=e.type,r}return Object(b.a)(n,[{key:"componentWillUnmount",value:function(){var e=this,t=this._map;t&&(t.off("styledata",this._updateSource),requestAnimationFrame((function(){t.style&&t.style._loaded&&t.removeSource(e.id)})))}},{key:"getSource",value:function(){var e=this._map;return e&&e.style&&e.getSource(this.id)}},{key:"_createSource",value:function(e){var t=this._map;t.style&&t.style._loaded&&t.addSource(this.id,e)}},{key:"_render",value:function(e){var t=this;return!this._map&&e.map&&(this._map=e.map,this._map.on("styledata",this._updateSource)),this._updateSource(),h.Children.map(this.props.children,(function(e){return Object(h.cloneElement)(e,{source:t.id})}))}},{key:"render",value:function(){return h.createElement(he.Consumer,null,this._render.bind(this))}}]),n}(h.PureComponent);Object(_.a)(jt,"propTypes",wt);var Et=n("Ff2n");function kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var xt={type:T.a.string.isRequired,id:T.a.string,source:T.a.string,beforeId:T.a.string};var St=0,At=function(e){Object(g.a)(n,e);var t=kt(n);function n(e){var r;return Object(y.a)(this,n),r=t.call(this,e),Object(_.a)(Object(v.a)(r),"id",void 0),Object(_.a)(Object(v.a)(r),"type",void 0),Object(_.a)(Object(v.a)(r),"_map",null),Object(_.a)(Object(v.a)(r),"_layerOptions",{}),Object(_.a)(Object(v.a)(r),"_updateLayer",(function(){var e=r._map;if(e){var t=Object(v.a)(r),n=t.props,i=t._layerOptions;if(z(!n.id||n.id===r.id,"layer id changed"),z(n.type===r.type,"layer type changed"),r.getLayer())try{!function(e,t,n,r){var i=n.layout,a=void 0===i?{}:i,o=n.paint,s=void 0===o?{}:o,c=n.filter,u=n.minzoom,l=n.maxzoom,h=n.beforeId,f=Object(Et.a)(n,["layout","paint","filter","minzoom","maxzoom","beforeId"]);if(h!==r.beforeId&&e.moveLayer(t,h),a!==r.layout)for(var p in a)Ot(a[p],r.layout[p])||e.setLayoutProperty(t,p,a[p]);if(s!==r.paint)for(var d in s)Ot(s[d],r.paint[d])||e.setPaintProperty(t,d,s[d]);for(var y in Ot(c,r.filter)||e.setFilter(t,c),u===r.minzoom&&l===r.maxzoom||e.setLayerZoomRange(t,u,l),f)Ot(f[y],r[y])||e.setLayerProperty(t,y,f[y])}(e,r.id,n,i),Object.assign(i,n)}catch(a){console.warn(a)}else r._createLayer()}})),r.id=e.id||"jsx-layer-".concat(St++),r.type=e.type,r}return Object(b.a)(n,[{key:"componentDidMount",value:function(){this._updateLayer()}},{key:"componentDidUpdate",value:function(){this._updateLayer()}},{key:"componentWillUnmount",value:function(){var e=this._map;e&&(e.off("styledata",this._updateLayer),e.style&&e.style._loaded&&e.removeLayer(this.id))}},{key:"getLayer",value:function(){var e=this._map;return e&&e.style&&e.getLayer(this.id)}},{key:"_createLayer",value:function(){var e=this._map;if(e.style&&e.style._loaded){var t=Object.assign({},this.props);t.id=this.id,delete t.beforeId,e.addLayer(t,this.props.beforeId),this._layerOptions=t}}},{key:"_render",value:function(e){return!this._map&&e.map&&(this._map=e.map,this._map.on("styledata",this._updateLayer)),null}},{key:"render",value:function(){return h.createElement(he.Consumer,null,this._render.bind(this))}}]),n}(h.PureComponent);function Pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(At,"propTypes",xt);var It={captureScroll:T.a.bool,captureDrag:T.a.bool,captureClick:T.a.bool,captureDoubleClick:T.a.bool},Ct=function(e){Object(g.a)(n,e);var t=Pt(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"_context",{}),Object(_.a)(Object(v.a)(e),"_events",null),Object(_.a)(Object(v.a)(e),"_containerRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(e),"_onScroll",(function(t){e.props.captureScroll&&t.stopPropagation()})),Object(_.a)(Object(v.a)(e),"_onDragStart",(function(t){e.props.captureDrag&&t.stopPropagation()})),Object(_.a)(Object(v.a)(e),"_onDblClick",(function(t){e.props.captureDoubleClick&&t.stopPropagation()})),Object(_.a)(Object(v.a)(e),"_onClick",(function(t){e.props.captureClick&&t.stopPropagation()})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this._containerRef.current;if(e){var t=this._context.eventManager;t&&(this._events={wheel:this._onScroll,panstart:this._onDragStart,anyclick:this._onClick,click:this._onClick,dblclick:this._onDblClick},t.watch(this._events,e))}}},{key:"componentWillUnmount",value:function(){var e=this._context.eventManager;e&&this._events&&e.off(this._events)}},{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){var e=this;return h.createElement(he.Consumer,null,(function(t){return e._context=t,e._render()}))}}]),n}(h.PureComponent);Object(_.a)(Ct,"propTypes",It),Object(_.a)(Ct,"defaultProps",{captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0});var Rt=n("ReuC");function Dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Nt=Object.assign({},Ct.propTypes,{draggable:T.a.bool,onDrag:T.a.func,onDragEnd:T.a.func,onDragStart:T.a.func,offsetLeft:T.a.number,offsetTop:T.a.number}),Lt=Object.assign({},Ct.defaultProps,{draggable:!1,offsetLeft:0,offsetTop:0}),Mt=function(e){Object(g.a)(n,e);var t=Dt(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"state",{dragPos:null,dragOffset:null}),Object(_.a)(Object(v.a)(e),"_dragEvents",null),Object(_.a)(Object(v.a)(e),"_onDragStart",(function(t){var n=e.props,r=n.draggable,i=n.captureDrag;if((r||i)&&t.stopPropagation(),r){var a=e._getDragEventPosition(t),o=e._getDragEventOffset(t);e.setState({dragPos:a,dragOffset:o}),e._setupDragEvents();var s=e.props.onDragStart;if(s&&o){var c=Object.assign({},t);c.lngLat=e._getDragLngLat(a,o),s(c)}}})),Object(_.a)(Object(v.a)(e),"_onDrag",(function(t){t.stopPropagation();var n=e._getDragEventPosition(t);e.setState({dragPos:n});var r=e.props.onDrag,i=e.state.dragOffset;if(r&&i){var a=Object.assign({},t);a.lngLat=e._getDragLngLat(n,i),r(a)}})),Object(_.a)(Object(v.a)(e),"_onDragEnd",(function(t){var n=e.state,r=n.dragPos,i=n.dragOffset;t.stopPropagation(),e.setState({dragPos:null,dragOffset:null}),e._removeDragEvents();var a=e.props.onDragEnd;if(a&&r&&i){var o=Object.assign({},t);o.lngLat=e._getDragLngLat(r,i),a(o)}})),Object(_.a)(Object(v.a)(e),"_onDragCancel",(function(t){t.stopPropagation(),e.setState({dragPos:null,dragOffset:null}),e._removeDragEvents()})),e}return Object(b.a)(n,[{key:"componentWillUnmount",value:function(){Object(Rt.a)(Object(O.a)(n.prototype),"componentWillUnmount",this).call(this),this._removeDragEvents()}},{key:"_setupDragEvents",value:function(){var e=this._context.eventManager;e&&(this._dragEvents={panmove:this._onDrag,panend:this._onDragEnd,pancancel:this._onDragCancel},e.on(this._dragEvents))}},{key:"_removeDragEvents",value:function(){var e=this._context.eventManager;e&&this._dragEvents&&(e.off(this._dragEvents),this._dragEvents=null)}},{key:"_getDragEventPosition",value:function(e){var t=e.offsetCenter;return[t.x,t.y]}},{key:"_getDragEventOffset",value:function(e){var t=e.center,n=t.x,r=t.y,i=this._containerRef.current;if(i){var a=i.getBoundingClientRect();return[a.left-n,a.top-r]}return null}},{key:"_getDraggedPosition",value:function(e,t){return[e[0]+t[0],e[1]+t[1]]}},{key:"_getDragLngLat",value:function(e,t){var n=this.props,r=n.offsetLeft,i=n.offsetTop,a=this._getDraggedPosition(e,t),o=Object(N.a)(a,2),s=o[0],c=o[1];return this._context.viewport.unproject([s-r,c-i])}}]),n}(Ct);Object(_.a)(Mt,"propTypes",Nt),Object(_.a)(Mt,"defaultProps",Lt);var Ut="undefined"!=typeof window&&window.devicePixelRatio||1,Bt=function(e){return Math.round(e*Ut)/Ut},zt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";if(null===e)return t;var r="x"===n?e.offsetWidth:e.offsetHeight;return Bt(t/100*r)/r*100};function Vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Ft=Object.assign({},Mt.propTypes,{className:T.a.string,longitude:T.a.number.isRequired,latitude:T.a.number.isRequired}),Gt=Object.assign({},Mt.defaultProps,{className:""}),Ht=function(e){Object(g.a)(n,e);var t=Vt(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"_control",null),e}return Object(b.a)(n,[{key:"_getPosition",value:function(){var e=this.props,t=e.longitude,n=e.latitude,r=e.offsetLeft,i=e.offsetTop,a=this.state,o=a.dragPos,s=a.dragOffset;if(o&&s)return this._getDraggedPosition(o,s);var c=this._context.viewport.project([t,n]),u=Object(N.a)(c,2),l=u[0],h=u[1];return[l+=r,h+=i]}},{key:"_render",value:function(){var e=this._getPosition(),t=Object(N.a)(e,2),n=t[0],r=t[1],i="translate(".concat(Bt(n),"px, ").concat(Bt(r),"px)"),a=this._containerRef.current;if(this._control&&a)a.style.transform=i;else{var o=this.props,s=o.className,c=o.draggable,u=this.state.dragPos,l={position:"absolute",left:0,top:0,transform:i,cursor:c?u?"grabbing":"grab":"auto"};this._control=h.createElement("div",{className:"mapboxgl-marker ".concat(s),ref:this._containerRef,style:l},this.props.children)}return this._control}},{key:"render",value:function(){return this._control=null,Object(Rt.a)(Object(O.a)(n.prototype),"render",this).call(this)}}]),n}(Mt);Object(_.a)(Ht,"propTypes",Ft),Object(_.a)(Ht,"defaultProps",Gt);n("q/PY"),n("v9g0");var qt={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Wt=Object.keys(qt);function Zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Yt=Object.assign({},Ct.propTypes,{className:T.a.string,longitude:T.a.number.isRequired,latitude:T.a.number.isRequired,altitude:T.a.number,offsetLeft:T.a.number,offsetTop:T.a.number,tipSize:T.a.number,closeButton:T.a.bool,closeOnClick:T.a.bool,anchor:T.a.oneOf(Object.keys(qt)),dynamicPosition:T.a.bool,sortByDepth:T.a.bool,onClose:T.a.func}),Xt=Object.assign({},Ct.defaultProps,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}}),Jt=function(e){Object(g.a)(n,e);var t=Zt(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"_closeOnClick",!1),Object(_.a)(Object(v.a)(e),"_contentRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(e),"_onClick",(function(t){if(e.props.captureClick&&t.stopPropagation(),e.props.closeOnClick||"mapboxgl-popup-close-button"===t.target.className){e.props.onClose();var n=e._context.eventManager;n&&n.once("click",(function(e){return e.stopPropagation()}),t.target)}})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){Object(Rt.a)(Object(O.a)(n.prototype),"componentDidMount",this).call(this),this.forceUpdate()}},{key:"_getPosition",value:function(e,t){var n=this._context.viewport,r=this.props,i=r.anchor,a=r.dynamicPosition,o=r.tipSize,s=this._contentRef.current;return s&&a?function(e){var t=e.x,n=e.y,r=e.width,i=e.height,a=e.selfWidth,o=e.selfHeight,s=e.anchor,c=e.padding,u=void 0===c?0:c,l=qt[s],h=l.x,f=l.y,p=n-f*o,d=p+o;if(p<u)for(;p<u&&f>=.5;)f-=.5,p+=.5*o;else if(d>i-u)for(;d>i-u&&f<=.5;)f+=.5,d-=.5*o;var y=t-h*a,v=y+a,b=.5;if(.5===f&&(h=Math.floor(h),b=1),y<u)for(;y<u&&h>=b;)h-=b,y+=b*a;else if(v>r-u)for(;v>r-u&&h<=1-b;)h+=b,v-=b*a;return Wt.find((function(e){var t=qt[e];return t.x===h&&t.y===f}))||s}({x:e,y:t,anchor:i,padding:o,width:n.width,height:n.height,selfWidth:s.clientWidth,selfHeight:s.clientHeight}):i}},{key:"_getContainerStyle",value:function(e,t,n,r){var i=this._context.viewport,a=this.props,o=a.offsetLeft,s=a.offsetTop,c=a.sortByDepth,u=qt[r],l=e+o,h=t+s,f=this._containerRef.current,p=zt(f,100*-u.x),d=zt(f,100*-u.y,"y"),y={position:"absolute",transform:"\n        translate(".concat(p,"%, ").concat(d,"%)\n        translate(").concat(Bt(l),"px, ").concat(Bt(h),"px)\n      "),display:void 0,zIndex:void 0};return c?(n>1||n<-1||e<0||e>i.width||t<0||t>i.height?y.display="none":y.zIndex=Math.floor((1-n)/2*1e5),y):y}},{key:"_renderTip",value:function(e){var t=this.props.tipSize;return h.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:t}})}},{key:"_renderContent",value:function(){var e=this.props,t=e.closeButton,n=e.children,r=this._context.eventManager?null:this._onClick;return h.createElement("div",{key:"content",ref:this._contentRef,className:"mapboxgl-popup-content",onClick:r},t&&h.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button"},"×"),n)}},{key:"_render",value:function(){var e=this.props,t=e.className,n=e.longitude,r=e.latitude,i=e.altitude,a=this._context.viewport.project([n,r,i]),o=Object(N.a)(a,3),s=o[0],c=o[1],u=o[2],l=this._getPosition(s,c),f=this._getContainerStyle(s,c,u,l);return h.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(l," ").concat(t),style:f,ref:this._containerRef},this._renderTip(l),this._renderContent())}}]),n}(Ct);Object(_.a)(Jt,"propTypes",Yt),Object(_.a)(Jt,"defaultProps",Xt);var Kt=n("oJR1");function Qt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var $t=Object.assign({},Ct.propTypes,{className:T.a.string,container:T.a.object}),en=Object.assign({},Ct.defaultProps,{className:"",container:null}),tn=function(e){Object(g.a)(n,e);var t=Qt(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"state",{isFullscreen:!1,showButton:!1}),Object(_.a)(Object(v.a)(e),"_mapboxFullscreenControl",null),Object(_.a)(Object(v.a)(e),"_onFullscreenChange",(function(){var t=!e._mapboxFullscreenControl._fullscreen;e._mapboxFullscreenControl._fullscreen=t,e.setState({isFullscreen:t})})),Object(_.a)(Object(v.a)(e),"_onClickFullscreen",(function(){e._mapboxFullscreenControl._onClickFullscreen()})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.container||this._context.mapContainer;this._mapboxFullscreenControl=new D.a.FullscreenControl({container:e}),this.setState({showButton:this._mapboxFullscreenControl._checkFullscreenSupport()}),Kt.a.addEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"componentWillUnmount",value:function(){Kt.a.removeEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"_renderButton",value:function(e,t,n){return h.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:n},h.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}},{key:"_render",value:function(){if(!this.state.showButton)return null;var e=this.props.className,t=this.state.isFullscreen?"shrink":"fullscreen";return h.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(e),ref:this._containerRef},this._renderButton(t,"Toggle fullscreen",this._onClickFullscreen))}}]),n}(Ct);Object(_.a)(tn,"propTypes",$t),Object(_.a)(tn,"defaultProps",en);var nn;n("6kNP");function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var an=Object.assign({},ke.defaultProps,{transitionDuration:500}),on=function(){},sn=Object.assign({},Ct.propTypes,{className:T.a.string,style:T.a.object,label:T.a.string,auto:T.a.bool,positionOptions:T.a.object,fitBoundsOptions:T.a.object,trackUserLocation:T.a.bool,showUserLocation:T.a.bool,onViewStateChange:T.a.func,onViewportChange:T.a.func,onGeolocate:T.a.func}),cn=Object.assign({},Ct.defaultProps,{className:"",style:{},label:"Geolocate",auto:!1,positionOptions:null,fitBoundsOptions:null,trackUserLocation:!1,showUserLocation:!0,onGeolocate:function(){}}),un=function(e){Object(g.a)(n,e);var t=rn(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"state",{supportsGeolocation:!1,markerPosition:null}),Object(_.a)(Object(v.a)(e),"_mapboxGeolocateControl",null),Object(_.a)(Object(v.a)(e),"_geolocateButtonRef",Object(h.createRef)()),Object(_.a)(Object(v.a)(e),"_setupMapboxGeolocateControl",(function(t){if(t){var n={showUserLocation:!1};["positionOptions","fitBoundsOptions","trackUserLocation"].forEach((function(t){t in e.props&&null!==e.props[t]&&(n[t]=e.props[t])}));var r=new D.a.GeolocateControl(n);e._mapboxGeolocateControl=r,r._watchState="OFF",r._geolocateButton=e._geolocateButtonRef.current,r.options.trackUserLocation&&r._geolocateButton&&r._geolocateButton.setAttribute("aria-pressed","false"),r._updateMarker=e._updateMarker,r._updateCamera=e._updateCamera,r._setup=!0;var i=e._context.eventManager;r.options.trackUserLocation&&i&&i.on("panstart",(function(){"ACTIVE_LOCK"===r._watchState&&(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"))})),r.on("geolocate",e.props.onGeolocate)}else console.warn("Geolocation support is not available, the GeolocateControl will not be visible.")})),Object(_.a)(Object(v.a)(e),"_triggerGeolocate",(function(){var t=e._mapboxGeolocateControl;return t._map=e._context.map,e.props.showUserLocation&&(t.on("geolocate",e._updateMarker),t.on("trackuserlocationend",e._updateMarker)),e._mapboxGeolocateControl.trigger()})),Object(_.a)(Object(v.a)(e),"_updateMarker",(function(t){t&&e.setState({markerPosition:t.coords})})),Object(_.a)(Object(v.a)(e),"_getBounds",(function(e){var t=new D.a.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=t.toBounds(n);return[[r._ne.lng,r._ne.lat],[r._sw.lng,r._sw.lat]]})),Object(_.a)(Object(v.a)(e),"_updateCamera",(function(t){var n=e._context.viewport,r=e._getBounds(t),i=new P.a(n).fitBounds(r),a=i.longitude,o=i.latitude,s=i.zoom,c=Object.assign({},n,{longitude:a,latitude:o,zoom:s}),u=new ue(c),l=Object.assign({},u.getViewportProps(),an),h=e.props.onViewportChange||e._context.onViewportChange||on;(e.props.onViewStateChange||e._context.onViewStateChange||on)({viewState:l}),h(l)})),Object(_.a)(Object(v.a)(e),"_renderButton",(function(t,n,r){return h.createElement("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),ref:e._geolocateButtonRef,type:"button",title:n,onClick:r},h.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))})),Object(_.a)(Object(v.a)(e),"_renderMarker",(function(){var t=e.state.markerPosition,n=e.props.showUserLocation;return t&&n?h.createElement(Ht,{key:"location-maker",className:"mapboxgl-user-location-dot",longitude:t.longitude,latitude:t.latitude,onContextMenu:function(e){return e.preventDefault()},captureDrag:!1,captureDoubleClick:!1}):null})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this;(void 0!==nn?Promise.resolve(nn):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then((function(e){return nn="denied"!==e.state})):(nn=Boolean(window.navigator.geolocation),Promise.resolve(nn))).then((function(t){e.setState({supportsGeolocation:t}),e._setupMapboxGeolocateControl(t),t&&e.props.auto&&e._triggerGeolocate()}))}},{key:"componentDidUpdate",value:function(e){this.state.supportsGeolocation&&!e.auto&&this.props.auto&&this._triggerGeolocate()}},{key:"componentWillUnmount",value:function(){if(this._mapboxGeolocateControl){var e=this._mapboxGeolocateControl._geolocationWatchID;void 0!==e&&(window.navigator.geolocation.clearWatch(e),this._mapboxGeolocateControl._geolocationWatchID=void 0)}}},{key:"_render",value:function(){if(!this.state.supportsGeolocation)return null;var e=this.props,t=e.className,n=e.style,r=e.label;return h.createElement("div",null,this._renderMarker(),h.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(t),ref:this._containerRef,style:n,onContextMenu:function(e){return e.preventDefault()}},this._renderButton("geolocate",r,this._triggerGeolocate)))}}]),n}(Ct);Object(_.a)(un,"propTypes",sn),Object(_.a)(un,"defaultProps",cn);n("HQhv");function ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var hn=function(){},fn=Object.assign({},Ct.propTypes,{className:T.a.string,onViewStateChange:T.a.func,onViewportChange:T.a.func,showCompass:T.a.bool,showZoom:T.a.bool,zoomInLabel:T.a.string,zoomOutLabel:T.a.string,compassLabel:T.a.string}),pn=Object.assign({},Ct.defaultProps,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"});function dn(e){return function(e,t){for(var n=(e||"").split(".").map(Number),r=(t||"").split(".").map(Number),i=0;i<3;i++){var a=n[i]||0,o=r[i]||0;if(a<o)return-1;if(a>o)return 1}return 0}(e,"1.6.0")>=0?2:1}var yn=function(e){Object(g.a)(n,e);var t=ln(n);function n(e){var r;return Object(y.a)(this,n),r=t.call(this,e),Object(_.a)(Object(v.a)(r),"_uiVersion",void 0),Object(_.a)(Object(v.a)(r),"_onZoomIn",(function(){r._updateViewport({zoom:r._context.viewport.zoom+1})})),Object(_.a)(Object(v.a)(r),"_onZoomOut",(function(){r._updateViewport({zoom:r._context.viewport.zoom-1})})),Object(_.a)(Object(v.a)(r),"_onResetNorth",(function(){r._updateViewport({bearing:0,pitch:0})})),yt(e),r}return Object(b.a)(n,[{key:"_updateViewport",value:function(e){var t=this._context.viewport,n=new ue(Object.assign({},t,e)),r=Object.assign({},n.getViewportProps(),at),i=this.props.onViewportChange||this._context.onViewportChange||hn;(this.props.onViewStateChange||this._context.onViewStateChange||hn)({viewState:r}),i(r)}},{key:"_renderCompass",value:function(){var e=this._context.viewport.bearing,t={transform:"rotate(".concat(-e,"deg)")};return 2===this._uiVersion?h.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:t}):h.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:t})}},{key:"_renderButton",value:function(e,t,n,r){return h.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:n},r||h.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}},{key:"_render",value:function(){var e=this.props,t=e.className,n=e.showCompass,r=e.showZoom,i=e.zoomInLabel,a=e.zoomOutLabel,o=e.compassLabel;if(!this._uiVersion){var s=this._context.map;this._uiVersion=s?dn(s.version):2}return h.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(t),ref:this._containerRef},r&&this._renderButton("zoom-in",i,this._onZoomIn),r&&this._renderButton("zoom-out",a,this._onZoomOut),n&&this._renderButton("compass",o,this._onResetNorth,this._renderCompass()))}}]),n}(Ct);function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(yn,"propTypes",fn),Object(_.a)(yn,"defaultProps",pn);var bn=Object.assign({},Ct.propTypes,{maxWidth:T.a.number,unit:T.a.oneOf(["imperial","metric","nautical"])}),gn=Object.assign({},Ct.defaultProps,{maxWidth:100,unit:"metric"}),mn=function(e){Object(g.a)(n,e);var t=vn(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"_control",null),Object(_.a)(Object(v.a)(e),"_mapboxScaleControl",null),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=new D.a.ScaleControl;e._map=this._context.map,e._container=this._containerRef.current,this._mapboxScaleControl=e,this._update()}},{key:"_update",value:function(){var e=this._mapboxScaleControl;e&&(e.options=this.props,e._onMove())}},{key:"_render",value:function(){return this._control=this._control||h.createElement("div",{ref:this._containerRef,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}),this._update(),this._control}}]),n}(Ct);function On(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(mn,"propTypes",bn),Object(_.a)(mn,"defaultProps",gn);var _n=Object.assign({},Ct.propTypes,{redraw:T.a.func.isRequired}),wn=function(e){Object(g.a)(n,e);var t=On(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object(_.a)(Object(v.a)(e),"_canvas",void 0),Object(_.a)(Object(v.a)(e),"_ctx",void 0),Object(_.a)(Object(v.a)(e),"_redraw",(function(){var t=e._ctx;if(t){var n=Kt.b.devicePixelRatio||1;t.save(),t.scale(n,n);var r=e._context,i=r.viewport,a=r.isDragging;e.props.redraw({width:i.width,height:i.height,ctx:t,isDragging:a,project:i.project.bind(i),unproject:i.unproject.bind(i)}),t.restore()}})),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this._containerRef.current;e&&(this._canvas=e,this._ctx=e.getContext("2d")),this._redraw()}},{key:"_render",value:function(){var e=Kt.b.devicePixelRatio||1,t=this._context.viewport,n=t.width,r=t.height;return this._redraw(),h.createElement("canvas",{ref:this._containerRef,width:n*e,height:r*e,style:{width:"".concat(n,"px"),height:"".concat(r,"px"),position:"absolute",left:0,top:0}})}}]),n}(Ct);function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(wn,"propTypes",_n),Object(_.a)(wn,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var jn=Object.assign({},Ct.propTypes,{redraw:T.a.func.isRequired,style:T.a.object}),En=function(e){Object(g.a)(n,e);var t=Tn(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"_render",value:function(){var e=this._context,t=e.viewport,n=e.isDragging,r=Object.assign({position:"absolute",left:0,top:0,width:t.width,height:t.height},this.props.style);return h.createElement("div",{ref:this._containerRef,style:r},this.props.redraw({width:t.width,height:t.height,isDragging:n,project:t.project.bind(t),unproject:t.unproject.bind(t)}))}}]),n}(Ct);function kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}Object(_.a)(En,"propTypes",jn),Object(_.a)(En,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var xn=Object.assign({},Ct.propTypes,{redraw:T.a.func.isRequired,style:T.a.object}),Sn=function(e){Object(g.a)(n,e);var t=kn(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"_render",value:function(){var e=this._context,t=e.viewport,n=e.isDragging,r=Object.assign({position:"absolute",left:0,top:0},this.props.style);return h.createElement("svg",{width:t.width,height:t.height,ref:this._containerRef,style:r},this.props.redraw({width:t.width,height:t.height,isDragging:n,project:t.project.bind(t),unproject:t.unproject.bind(t)}))}}]),n}(Ct);Object(_.a)(Sn,"propTypes",xn),Object(_.a)(Sn,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});D.a&&D.a.setRTLTextPlugin;var An=n("pLLy"),Pn=(n("5irr"),n("o0o1")),In=n.n(Pn),Cn=(n("wcNg"),n("1+Ew")),Rn=n("PPQy"),Dn=n.n(Rn),Nn=n("7G5M"),Ln=n("5VxJ"),Mn=n("mejf"),Un=n("bZ2V"),Bn=n("ro6J"),zn=n("Cdqv"),Vn=n("74We"),Fn=n("p1p/"),Gn=(n("ToIb"),n("cxuS"),n("TAD1"),n("HaE+")),Hn=n("kh/P"),qn=n("SDD5"),Wn=(n("EMED"),n("DrhF"),n("2plT")),Zn=n("V6u+"),Yn=n("yeNo"),Xn=n("MTwu"),Jn=(Math.max(6378137,6378137,6356752.314245179),function(e){return e}),Kn=new qn.a;function Qn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jn;return Object(Yn.f)(e)?(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z),t}function $n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kn;return Qn(e,t,Yn.b._cartographicRadians?Jn:Yn.i)}function er(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jn;return Object(Yn.f)(t)?(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]),t}function tr(e,t){return er(e,t,Yn.b._cartographicRadians?Jn:Yn.h)}var nr=new qn.a,rr=new qn.a,ir=new qn.a;var ar=new qn.a,or={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},sr={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},cr={east:new qn.a,north:new qn.a,up:new qn.a,west:new qn.a,south:new qn.a,down:new qn.a},ur=new qn.a,lr=new qn.a,hr=new qn.a;function fr(e,t,n,r,i,a){var o,s,c,u=or[t]&&or[t][n];Object(Wn.a)(u&&(!r||r===u));var l=ar.copy(i);if(Object(Yn.d)(l.x,0,1e-14)&&Object(Yn.d)(l.y,0,1e-14)){var h=Math.sign(l.z);o=ur.fromArray(sr[t]),"east"!==t&&"west"!==t&&o.scale(h),s=lr.fromArray(sr[n]),"east"!==n&&"west"!==n&&s.scale(h),c=hr.fromArray(sr[r]),"east"!==r&&"west"!==r&&c.scale(h)}else{var f=cr.up,p=cr.east,d=cr.north;p.set(-l.y,l.x,0).normalize(),e.geodeticSurfaceNormal(l,f),d.copy(f).cross(p);var y=cr.west,v=cr.south;cr.down.copy(f).scale(-1),y.copy(p).scale(-1),v.copy(d).scale(-1),o=cr[t],s=cr[n],c=cr[r]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=s.x,a[5]=s.y,a[6]=s.z,a[7]=0,a[8]=c.x,a[9]=c.y,a[10]=c.z,a[11]=0,a[12]=l.x,a[13]=l.y,a[14]=l.z,a[15]=1,a}var pr,dr=new qn.a,yr=new qn.a,vr=new qn.a,br=new qn.a,gr=new qn.a,mr=new qn.a,Or=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(y.a)(this,e),Object(Wn.a)(t>=0),Object(Wn.a)(n>=0),Object(Wn.a)(r>=0),this.radii=new qn.a(t,n,r),this.radiiSquared=new qn.a(t*t,n*n,r*r),this.radiiToTheFourth=new qn.a(t*t*t*t,n*n*n*n,r*r*r*r),this.oneOverRadii=new qn.a(0===t?0:1/t,0===n?0:1/n,0===r?0:1/r),this.oneOverRadiiSquared=new qn.a(0===t?0:1/(t*t),0===n?0:1/(n*n),0===r?0:1/(r*r)),this.minimumRadius=Math.min(t,n,r),this.maximumRadius=Math.max(t,n,r),this.centerToleranceSquared=Zn.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Object(b.a)(e,null,[{key:"WGS84",get:function(){return pr=pr||new e(6378137,6378137,6356752.314245179)}}]),Object(b.a)(e,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=yr,r=vr,i=Object(N.a)(e,3),a=i[2];this.geodeticSurfaceNormalCartographic(e,n),r.copy(this.radiiSquared).scale(n);var o=Math.sqrt(n.dot(r));return r.scale(1/o),n.scale(a),r.add(n),r.to(t)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];mr.from(e);var n=this.scaleToGeodeticSurface(mr,br);if(n){var r=this.geodeticSurfaceNormal(n,yr),i=gr;i.copy(mr).subtract(n);var a=Math.atan2(r.y,r.x),o=Math.asin(r.z),s=Math.sign(Xn.d(i,mr))*Xn.g(i);return tr([a,o,s],t)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hn.a;return fr(this,"east","north","up",e,t)}},{key:"localFrameToFixedFrame",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Hn.a;return fr(this,e,t,n,r,i)}},{key:"geocentricSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return dr.from(e).normalize().to(t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=$n(e),r=n[0],i=n[1],a=Math.cos(i);return dr.set(a*Math.cos(r),a*Math.sin(r),Math.sin(i)).normalize(),dr.to(t)}},{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return dr.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}},{key:"scaleToGeodeticSurface",value:function(e,t){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qn.a,r=t.oneOverRadii,i=t.oneOverRadiiSquared,a=t.centerToleranceSquared;nr.from(e);var o=e.x,s=e.y,c=e.z,u=r.x,l=r.y,h=r.z,f=o*o*u*u,p=s*s*l*l,d=c*c*h*h,y=f+p+d,v=Math.sqrt(1/y);if(Number.isFinite(v)){var b=rr;if(b.copy(e).scale(v),y<a)return b.to(n);var g=i.x,m=i.y,O=i.z,_=ir;_.set(b.x*g*2,b.y*m*2,b.z*O*2);var w,T,j,E,k=(1-v)*e.len()/(.5*_.len()),x=0;do{var S=(w=1/(1+(k-=x)*g))*w,A=(T=1/(1+k*m))*T,P=(j=1/(1+k*O))*j,I=S*w,C=A*T,R=P*j,D=f*I*g+p*C*m+d*R*O,N=-2*D;x=(E=f*S+p*A+d*P-1)/N}while(Math.abs(E)>Zn.a.EPSILON12);return nr.scale([w,T,j]).to(n)}}(e,this,t)}},{key:"scaleToGeocentricSurface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];br.from(e);var n=br.x,r=br.y,i=br.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+r*r*a.y+i*i*a.z);return br.multiplyScalar(o).to(t)}},{key:"transformPositionToScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return br.from(e).scale(this.oneOverRadii).to(t)}},{key:"transformPositionFromScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return br.from(e).scale(this.radii).to(t)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(Wn.a)(Object(Yn.d)(this.radii.x,this.radii.y,Zn.a.EPSILON15)),Object(Wn.a)(this.radii.z>0),br.from(e);var r=br.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-t))return br.set(0,0,r).to(n)}}]),e}(),_r=n("G+eI"),wr=n("DYWF"),Tr=n("oCaT"),jr=n("D430"),Er=function e(t,n,r){Object(y.a)(this,e),this.item=t,this.previous=n,this.next=r},kr=function(){function e(){Object(y.a)(this,e),this.head=null,this.tail=null,this._length=0}return Object(b.a)(e,[{key:"add",value:function(e){var t=new Er(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,t){e!==t&&(this.remove(t),this._insert(e,t))}},{key:"_insert",value:function(e,t){var n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}},{key:"length",get:function(){return this._length}}]),e}();function xr(e){return null!=e}var Sr=function(){function e(){Object(y.a)(this,e),this._list=new kr,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return Object(b.a)(e,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var t=e._cacheNode;xr(t)&&this._list.splice(this._sentinel,t)}},{key:"add",value:function(e,t,n){xr(t._cacheNode)||(t._cacheNode=this._list.add(t),n&&n(e,t))}},{key:"unloadTile",value:function(e,t,n){var r=t._cacheNode;xr(r)&&(this._list.remove(r),t._cacheNode=void 0,n&&n(e,t))}},{key:"unloadTiles",value:function(e,t){var n=this._trimTiles;this._trimTiles=!1;for(var r=this._list,i=1024*e.maximumMemoryUsage*1024,a=this._sentinel,o=r.head;o!==a&&(e.gpuMemoryUsageInBytes>i||n);){var s=o.item;o=o.next,this.unloadTile(e,s,t)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),e}();var Ar=n("DUak"),Pr=new qn.a,Ir=new qn.a,Cr=new Ar.c([new Ar.e,new Ar.e,new Ar.e,new Ar.e,new Ar.e,new Ar.e]);function Rr(e,t){var n=e.cameraDirection,r=e.cameraUp,i=e.height,a=e.distanceScales.metersPerUnit,o=[e.longitude,e.latitude,0],s=Or.WGS84.cartographicToCartesian(o,new qn.a),c=Or.WGS84.eastNorthUpToFixedFrame(s),u=e.unprojectPosition(e.cameraPosition),l=Or.WGS84.cartographicToCartesian(u,new qn.a),h=new qn.a(c.transformAsVector(new qn.a(n).scale(a))).normalize(),f=new qn.a(c.transformAsVector(new qn.a(r).scale(a))).normalize();return function(e,t){var n=e.getFrustumPlanes(),r=0;for(var i in n){var a=n[i],o=a.normal.dot(e.center);Ir.copy(a.normal).scale(a.distance-o).add(e.center);var s=e.unprojectPosition(Ir),c=Or.WGS84.cartographicToCartesian(s,new qn.a);Cr.planes[r++].fromPointNormal(c,Pr.copy(t).subtract(c))}}(e,s),{camera:{position:l,direction:h,up:f},viewport:e,height:i,cullingVolume:Cr,frameNumber:t,sseDenominator:1.15}}var Dr=new qn.a;n("ofTv");var Nr=0,Lr=1,Mr=3,Ur=4,Br=5,zr=1,Vr=2,Fr="empty",Gr="scenegraph",Hr="pointcloud",qr="mesh",Wr="I3S",Zr="TILES3D",Yr="geometricError",Xr=1;function Jr(e){throw new Error('"'+e+'" is read-only')}var Kr=n("T27a");function Qr(e){return null!=e}new Kr.a;var $r=new qn.a,ei=new qn.a,ti=new qn.a;new Hn.a;function ni(e,t,n){if(Object(wr.a)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,n){var r=new qn.a(e[0],e[1],e[2]);t.transform(r,r);var i=t.transformAsVector(e.slice(3,6)),a=t.transformAsVector(e.slice(6,9)),o=t.transformAsVector(e.slice(9,12)),s=new Kr.a([i[0],i[1],i[2],a[0],a[1],a[2],o[0],o[1],o[2]]);if(Qr(n))return n.center=r,n.halfAxes=s,n;return new Ar.d(r,s)}(e.box,t,n);if(e.region){var r=Object(N.a)(e.region,6),i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=Or.WGS84.cartographicToCartesian([Object(Yn.c)(i),Object(Yn.c)(s),c],ei),h=Or.WGS84.cartographicToCartesian([Object(Yn.c)(o),Object(Yn.c)(a),u],ti),f=(new qn.a).addVectors(l,h).multiplyScalar(.5),p=(new qn.a).subVectors(l,h).len()/2;return ri([f[0],f[1],f[2],p],new Hn.a)}if(e.sphere)return ri(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ri(e,t,n){var r=new qn.a(e[0],e[1],e[2]);t.transform(r,r);var i=t.getScale($r),a=Math.max(Math.max(i[0],i[1]),i[2]),o=e[3]*a;return Qr(n)?(n.center=r,n.radius=o,n):new Ar.b(r,o)}new qn.a,new qn.a,new Hn.a,new qn.a,new qn.a,new qn.a;function ii(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){var n=e._dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor;return function(e,t){var n=e*t;return 1-Math.exp(-n*n)}(t,n)*r}return 0}var ai=Math.PI/2;function oi(e){var t=Object(N.a)(e,3),n=t[0],r=t[1],i=t[2],a=Object(Yn.i)(n),o=Object(Yn.i)(r),s=1+i/6378137,c=s*Math.cos(o);return[n=c*Math.cos(a),r=c*Math.sin(a),i=s*Math.sin(o)]}function si(e,t){var n=Object(N.a)(e,3),r=n[0],i=n[1],a=n[2],o=void 0===a?0:a,s=Object(N.a)(t,3),c=s[0],u=s[1],l=s[2],h=oi([c,u,void 0===l?0:l]),f=oi([r,i,o]),p=f[0]-h[0],d=f[1]-h[1],y=f[2]-h[2];return p*p+d*d+y*y}function ci(e,t){var n=t.viewport,r=e.header.mbs[1],i=[e.header.mbs[0],r,e.header.mbs[2]],a=e.header.mbs[3]/6378137,o=si(n.unprojectPosition(n.cameraPosition),i)-a*a;if(o<=0)return 170141175e30;var s=function(e,t){var n=t.viewport,r=n.width,i=n.height,a=n.pixelProjectionMatrix,o=Math.tan(Math.atan(Math.sqrt(1/(a[0]*a[0])+1/(a[5]*a[5]))));return Math.sqrt(i*i+r*r)/o}(0,t);return s*=a/Math.sqrt(o)/n.scale}function ui(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function li(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ui(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var hi=new qn.a;function fi(e){return e.isVisible?e.contentState===Nr?-1:Math.max(1e7-e._priority,0)||0:-1}var pi=function(){function e(t,n,r){Object(y.a)(this,e),Object(wr.a)("object"===Object(Qe.a)(n)),this.header=n,this.tileset=t,this.id=n.id,this.url=n.url,this.parent=r,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=Nr,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}var t;return Object(b.a)(e,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"getScreenSpaceError",value:function(e,t){switch(this.tileset.type){case Wr:return ci(this,e);case Zr:return function(e,t,n){var r=e.tileset,i=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,a=n?i:e.lodMetricValue;if(0===a)return 0;var o=Math.max(e._distanceToCamera,1e-7),s=a*t.height/(o*t.sseDenominator);return s-=ii(r,o)}(this,e,t);default:return console.error("Unsupported tileset type"),null}}},{key:"loadContent",value:(t=Object(Gn.a)(In.a.mark((function e(){var t,n,r,i,a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasEmptyContent){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.content){e.next=4;break}return e.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=Lr,e.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,fi);case 9:if(t=e.sent){e.next=13;break}return this.contentState=Nr,e.abrupt("return",!1);case 13:return e.prev=13,n=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.fetchOptions,i=this.tileset.loader,a=li(li({},r),{},Object(_.a)({},i.id,{tile:this.header,tileset:this.tileset.tileset})),e.next=20,Object(Fn.a)(n,i,a);case 20:return this.content=e.sent,this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,Tr.a.dirname(this.contentUrl)),this.contentState=Mr,this._onContentLoaded(),e.abrupt("return",!0);case 27:throw e.prev=27,e.t0=e.catch(13),this.contentState=Br,e.t0;case 31:return e.prev=31,t.done(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[13,27,31,34]])}))),function(){return t.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=Nr,!0}},{key:"updateVisibility",value:function(e){if(this._frameNumber!==e.frameNumber){var t=this.parent,n=t?t.computedTransform:this.tileset.modelMatrix,r=t?t._visibilityPlaneMask:Ar.c.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==Ar.c.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priority=this.lodMetricValue,this._frameNumber=e.frameNumber}}},{key:"visibility",value:function(e,t){var n=e.cullingVolume,r=this.boundingVolume;return n.computeVisibilityWithPlaneMask(r,t)}},{key:"contentVisibility",value:function(e){return!0}},{key:"distanceToTile",value:function(e){var t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var t=e.camera,n=this.boundingVolume;return hi.subVectors(n.center,t.position),t.direction.dot(hi)}},{key:"insideViewerRequestVolume",value:function(e){var t=this._viewerRequestVolume;return!t||0===t.distanceToCamera(e)}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new Hn.a(e.transform):new Hn.a;var t=this.parent,n=this.tileset,r=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Hn.a(r).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new Hn.a;this._initialTransform=new Hn.a(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Nr,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Ar.c.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||Vr}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=ni(e.boundingVolume,this.computedTransform,this.boundingVolume);var t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=ni(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=ni(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hn.a,t=e.clone().multiplyRight(this.transform),n=!t.equals(this.computedTransform);n&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Ur,this._expiredContent=this.content)}}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===Mr||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===Nr}},{key:"contentExpired",get:function(){return this.contentState===Ur}},{key:"contentFailed",get:function(){return this.contentState===Br}},{key:"extras",get:function(){return this.header.extras}}]),e}(),di=(n("zGcK"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(y.a)(this,e),this._array=new Array(t),this._map=new Map,this._length=t}return Object(b.a)(e,[{key:"get",value:function(e){return Object(wr.a)(e<this._array.length),this._array[e]}},{key:"set",value:function(e,t){Object(wr.a)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}},{key:"delete",value:function(e){var t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var t=this.length++;this._array[t]=e,this._map.set(e,t)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){Object(wr.a)(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){Object(wr.a)(e>=0),this.length=e}},{key:"trim",value:function(e){null==e&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}},{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}}]),e}());function yi(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mi={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2},Oi=function(){function e(t){Object(y.a)(this,e),this.options=gi(gi({},mi),t),this._traversalStack=new di,this._emptyTraversalStack=new di,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return Object(b.a)(e,[{key:"traverse",value:function(e,t,n){this.root=e,this.options=gi(gi({},this.options),n),this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,t){var n=this._traversalStack;for(n.push(e);n.length>0;){var r=n.pop(),i=!1;this.canTraverse(r,t)&&(this.updateChildTiles(r,t),i=this.updateAndPushChildren(r,t,n));var a=r.parent,o=Boolean(!a||a._shouldRefine),s=!i;r.hasRenderContent?r.refine===zr?(this.loadTile(r,t),this.selectTile(r,t)):r.refine===Vr&&(this.loadTile(r,t),s&&this.selectTile(r,t)):(this.emptyTiles[r.id]=r,this.loadTile(r,t),s&&this.selectTile(r,t)),this.touchTile(r,t),r._shouldRefine=i&&o}this.options.onTraversalEnd&&this.options.onTraversalEnd(t)}},{key:"updateChildTiles",value:function(e,t){var n,r=yi(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.updateTile(i,t)}}catch(a){r.e(a)}finally{r.f()}return!0}},{key:"updateAndPushChildren",value:function(e,t,n){var r=this.options,i=r.loadSiblings,a=r.skipLevelOfDetail,o=e.children;o.sort(this.compareDistanceToCamera);var s,c=!a&&e.refine===Vr&&e.hasRenderContent,u=!1,l=yi(o);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(h.isVisibleAndInRequestVolume?(n.find(h)&&n.delete(h),n.push(h),u=!0):(c||i)&&(this.loadTile(h,t),this.touchTile(h,t)),c){var f=void 0;if(!(f=!!h._inRequestVolume&&(h.hasRenderContent?h.contentAvailable:this.executeEmptyTraversal(h,t))))return f}}}catch(p){l.e(p)}finally{l.f()}return u}},{key:"updateTile",value:function(e,t){this.updateTileVisibility(e,t)}},{key:"selectTile",value:function(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}},{key:"canTraverse",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!(!r&&!e.isVisibleAndInRequestVolume)&&(!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,n)))}},{key:"shouldLoadTile",value:function(e,t){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,t,n){var r=e._screenSpaceError;return n&&(r=e.getScreenSpaceError(t,!0)),r>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,t){e.updateVisibility(t)}},{key:"compareDistanceToCamera",value:function(e,t){return e._distanceToCamera-t._distanceToCamera}},{key:"getPriority",value:function(e){var t=this.options;switch(e.refine){case zr:return e._distanceToCamera;case Vr:var n=e.parent,r=n&&(!t.skipLevelOfDetail||0===e._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:e._screenSpaceError;return this.root._screenSpaceError-r;default:return Object(wr.a)(!1)}}},{key:"anyChildrenVisible",value:function(e,t){var n,r=!1,i=yi(e.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.updateVisibility(t),r=r||a.isVisibleAndInRequestVolume}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"executeEmptyTraversal",value:function(e,t){for(var n=!0,r=this._emptyTraversalStack;r.length>0;){var i=r.pop();this.updateTile(i,t),i.isVisibleAndInRequestVolume||(this.loadTile(i,t),this.touchTile(i,t));var a=!i.hasRenderContent&&this.canTraverse(i,t,!1,!0);if(a||i.contentAvailable||(n=!1),a){var o,s=yi(i.children.filter((function(e){return e})));try{for(s.s();!(o=s.n()).done;){var c=o.value;r.find(c)&&r.delete(c),r.push(c)}}catch(u){s.e(u)}finally{s.f()}}}return n}}]),e}();function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var wi=function(e){Object(g.a)(n,e);var t=_i(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"compareDistanceToCamera",value:function(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}},{key:"updateTileVisibility",value:function(e,t){if(e.updateVisibility(t),e.isVisibleAndInRequestVolume){var n=e.children.length>0;if(e.hasTilesetContent&&n){var r=e.children[0];return this.updateTileVisibility(r,t),void(e._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))e._visible=!1;else{var i=e.refine===Vr,a=e._optimChildrenWithinParent===Xr;i&&a&&n&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}}}},{key:"meetsScreenSpaceErrorEarly",value:function(e,t){var n=e.parent;return!(!n||n.hasTilesetContent||n.refine!==zr)&&!this.shouldRefine(e,t,!0)}}]),n}(Oi),Ti="REQUESTED",ji="COMPLETED",Ei="ERROR",ki=function(){function e(){Object(y.a)(this,e),this._statusMap={}}return Object(b.a)(e,[{key:"add",value:function(e,t,n,r){var i=this;this._statusMap[t]||(this._statusMap[t]={request:e,callback:n,key:t,frameState:r,status:Ti},e().then((function(e){i._statusMap[t].status=ji,i._statusMap[t].callback(e,r)})).catch((function(e){i._statusMap[t].status=Ei,n(e)})))}},{key:"update",value:function(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t)}},{key:"find",value:function(e){return this._statusMap[e]}}]),e}();function xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Si(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ai(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Pi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Pi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(O.a)(e);if(t){var i=Object(O.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var Ci=function(e){Object(g.a)(r,e);var t,n=Ii(r);function r(e){var t;return Object(y.a)(this,r),(t=n.call(this,e))._tileManager=new ki,t}return Object(b.a)(r,[{key:"shouldRefine",value:function(e,t){return e._lodJudge=function(e,t){var n=t.viewport,r=n.metersPerPixel,i=e.header.mbs[1],a=e.header.mbs[0],o=e.header.mbs[2],s=e.header.mbs[3],c=n.height,u=n.width,l=n.latitude,h=n.longitude,f=[h,l],p=[a,i,o],d=[h,i],y=[a,l],v=Math.sqrt(c*c+u*u)*r[0],b=.5*c+s/6378137,g=.5*u+s/6378137;if(si(f,p)>v+s/6378137)return"OUT";if(si(f,d)>b)return"OUT";if(si(f,y)>g)return"OUT";if(0===e.lodMetricValue)return"DIG";var m=ci(e,t);return(m*=ai)<.5?"OUT":!e.header.children||m<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}},{key:"updateChildTiles",value:function(e,t){var n,r=this,i=e.header.children||[],a=e.children,o=e.tileset,s=Ai(i);try{var c=function(){var i=n.value,s=a&&a.find((function(e){return e.id===i.id}));if(s)s&&r.updateTile(s,t);else{r._tileManager.find(i.id)?r._tileManager.update(i.id,t):r._tileManager.add((function(){return r._loadTile(i.id,o)}),i.id,(function(t){return r._onTileLoad(t,e)}),t)}};for(s.s();!(n=s.n()).done;)c()}catch(u){s.e(u)}finally{s.f()}}},{key:"_loadTile",value:(t=Object(Gn.a)(In.a.mark((function e(t,n){var r,i,a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.loader,i=n.getTileUrl("".concat(n.url,"/nodes/").concat(t)),a={i3s:Si(Si({},n.fetchOptions),{},{isHeader:!0,loadContent:!1})},e.next=5,Object(Fn.a)(i,r,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"_onTileLoad",value:function(e,t){var n=this.options.basePath,r=new pi(t.tileset,e,t,n);t.children.push(r);var i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&this.executeTraversal(r,i)}}]),r}(Oi);function Ri(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Di(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Di(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Di(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ni(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Li(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ni(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ni(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mi={ellipsoid:Or.WGS84,modelMatrix:new Hn.a,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(e,t,n){},maximumScreenSpaceError:8},Ui=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(y.a)(this,e),Object(wr.a)(t),this.options=Li(Li({},Mi),n),this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||Tr.a.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new Sr,this._requestScheduler=new jr.a({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new _r.a({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(t,this.options)}var t;return Object(b.a)(e,[{key:"isLoaded",value:function(){return 0===this._pendingCount}},{key:"destroy",value:function(){this._destroy()}},{key:"getTileUrl",value:function(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}},{key:"update",value:function(e){this._cache.reset(),this._frameNumber++,this._frameState=Rr(e,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}},{key:"_onTraversalEnd",value:function(){var e=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,e)&&this._updateFrameNumber++,this.selectedTiles=e;var t,n=Ri(this.selectedTiles);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._tiles[r.id]=r}}catch(i){n.e(i)}finally{n.f()}return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}},{key:"_tilesChanged",value:function(e,t){if(e.length!==t.length)return!0;var n=new Set(e.map((function(e){return e.id}))),r=new Set(t.map((function(e){return e.id}))),i=e.filter((function(e){return!r.has(e.id)})).length>0;return i=i||t.filter((function(e){return!n.has(e.id)})).length>0}},{key:"_loadTiles",value:function(e){var t,n=Ri(this._requestedTiles);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.contentUnloaded&&this._loadTile(r,e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(e,t){return e._unloadTile(t)}))}},{key:"_updateStats",value:function(){var e,t=0,n=0,r=Ri(this.selectedTiles);try{for(r.s();!(e=r.n()).done;){var i=e.value;i.contentAvailable&&(t++,i.content.pointCount&&(n+=i.content.pointCount))}}catch(a){r.e(a)}finally{r.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=n}},{key:"_initializeTileSet",value:function(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===Zr&&this._initializeCesiumTileset(e),this.type===Wr&&this._initializeI3STileset(e),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var e=this.root,t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new qn.a,void(this.zoom=1);this.cartographicCenter=Or.WGS84.cartesianToCartographic(t,new qn.a),this.cartesianCenter=t,this.zoom=function(e){var t=e.halfAxes,n=e.radius,r=e.width,i=e.height;if(t){t.getColumn(0,Dr);var a=Dr.len();t.getColumn(1,Dr);var o=Dr.len();t.getColumn(2,Dr);var s=a/2,c=o/2,u=Dr.len()/2;return(Math.log2(6378137/s)+Math.log2(6378137/c)+Math.log2(6356752.314245179/u))/3}return n?Math.log2(6356752.314245179/n):i&&r?(Math.log2(6378137/r)+Math.log2(6378137/i))/2:1}(e.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(e,t,n){var r=new pi(this,e.root,t,n);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===Zr){var i=[];for(i.push(r);i.length>0;){var a=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var o,s=Ri(a.header.children||[]);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=new pi(this,c,a,n);a.children.push(u),u.depth=a.depth+1,i.push(u)}}catch(l){s.e(l)}finally{s.f()}}}return r}},{key:"_initializeTraverser",value:function(){var e;switch(this.type){case Zr:e=wi;break;case Wr:e=Ci;break;default:e=Oi}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:(t=Object(Gn.a)(In.a.mark((function e(t,n){var r;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._onStartTileLoading(),e.next=4,t.loadContent(n);case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this._onTileLoadError(t,e.t0);case 10:return e.prev=10,this._onEndTileLoading(),this._onTileLoad(t,r),e.finish(10);case 14:case"end":return e.stop()}}),e,this,[[0,7,10,14]])}))),function(e,n){return t.apply(this,arguments)})},{key:"_onTileLoadError",value:function(e,t){this.stats.get("Failed Tile Loads").incrementCount();var n=t.message||t.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(n)),this.options.onTileError(e,n,r)}},{key:"_onTileLoad",value:function(e,t){t&&(e&&e.content&&function(e,t){Object(wr.a)(e),Object(wr.a)(t);var n=t.rtcCenter,r=t.rotateYtoZ,i=e.computedTransform,a=e.boundingVolume.center,o=new Hn.a(i);if(n&&o.translate(n),r){var s=(new Hn.a).rotateX(Math.PI/2);o=o.multiplyRight(s)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var c=new qn.a(a);t.cartesianModelMatrix=o,t.cartesianOrigin=c;var u=Or.WGS84.cartesianToCartographic(c,new qn.a),l=Or.WGS84.eastNorthUpToFixedFrame(c).invert();t.cartographicModelMatrix=l.multiplyRight(o),t.cartographicOrigin=u,t.modelMatrix=t.cartographicModelMatrix}(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,(function(t){return t._updateCacheStats(e)}))}},{key:"_updateCacheStats",value:function(e){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var t,n=e.pop(),r=Ri(n.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;e.push(i)}}catch(a){r.e(a)}finally{r.f()}this._destroyTile(n)}this.root=null}},{key:"_destroySubtree",value:function(e){var t=e,n=[];for(n.push(t);n.length>0;){var r,i=Ri((e=n.pop()).children);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.push(a)}}catch(o){i.e(o)}finally{i.f()}e!==t&&this._destroyTile(e)}t.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeCesiumTileset",value:function(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}},{key:"_initializeI3STileset",value:function(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t.push("".concat(i,"=").concat(e[i]))}switch(t.length){case 0:return"";case 1:return"?".concat(t[0]);default:return"?".concat(t.join("&"))}}(this._queryParams)),this._queryParamsString}}]),e}(),Bi={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(Bi),n("t+I+"),n("CtJk");function zi(e,t,n){Object(wr.a)(e instanceof ArrayBuffer);var r=new TextDecoder("utf8"),i=new Uint8Array(e,t,n);return r.decode(i)}function Vi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new DataView(e);return"".concat(String.fromCharCode(n.getUint8(t+0))).concat(String.fromCharCode(n.getUint8(t+1))).concat(String.fromCharCode(n.getUint8(t+2))).concat(String.fromCharCode(n.getUint8(t+3)))}var Fi,Gi=n("7UmL"),Hi=n("nGEl");function qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zi(e){return Yi.apply(this,arguments)}function Yi(){return(Yi=Object(Gn.a)(In.a.mark((function e(t){var n;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.modules||{}).draco3d){e.next=3;break}return e.abrupt("return",{draco:n.draco3d.createDecoderModule()});case 3:return Fi=Fi||Xi(t),e.next=6,Fi;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xi(e){return Ji.apply(this,arguments)}function Ji(){return(Ji=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.draco&&t.draco.decoderType,e.next="js"===e.t0?3:(e.t0,7);break;case 3:return e.next=5,Object(Gi.a)("draco_decoder.js","draco",t);case 5:return n=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,Object(Gi.a)("draco_wasm_wrapper.js","draco",t);case 10:return e.t2=e.sent,e.next=13,Object(Gi.a)("draco_decoder.wasm","draco",t);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:i=e.sent,a=Object(N.a)(i,2),n=a[0],r=a[1];case 21:return n=n||Hi.a.DracoDecoderModule,e.next=24,Ki(n,r);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ki(e,t){var n={};return t&&(n.wasmBinary=t),new Promise((function(t){e(Wi(Wi({},n),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}n("SIeT"),n("6nXr"),n("h3Sa"),n("AItV"),n("88iX");var Qi=n("6V5v"),$i=0,ea=1,ta={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},na={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},ra=function(){function e(t){Object(y.a)(this,e),this.draco=t,this.drawMode="TRIANGLE"}return Object(b.a)(e,[{key:"destroy",value:function(){}},{key:"destroyGeometry",value:function(e){e&&this.draco.destroy(e.dracoGeometry)}},{key:"parseSync",value:function(e,t){var n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength);var r,i,a,o=new this.draco.Decoder,s={};try{var c=o.GetEncodedGeometryType(n);switch(c){case this.draco.TRIANGULAR_MESH:i=new this.draco.Mesh,r=o.DecodeBufferToMesh(n,i),a={type:$i,faceCount:i.num_faces(),attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;case this.draco.POINT_CLOUD:i=new this.draco.PointCloud,r=o.DecodeBufferToPointCloud(n,i),a={type:ea,attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!r.ok()||!i.ptr){var u="DRACO decompression failed: ".concat(r.error_msg());throw i&&this.draco.destroy(i),new Error(u)}s.loaderData={header:a},this.extractDRACOGeometry(o,i,c,s),s.header={vertexCount:a.vertexCount,boundingBox:Object(Qi.a)(s.attributes)}}finally{this.draco.destroy(o),this.draco.destroy(n)}return s}},{key:"extractDRACOGeometry",value:function(e,t,n,r){var i=this.getAttributes(e,t),a=i.POSITION;if(!a)throw new Error("DRACO decompressor: No position attribute found.");return this.getPositionAttributeMetadata(a),n===this.draco.TRIANGULAR_MESH?(i.indices="TRIANGLE_STRIP"===this.drawMode?this.getMeshStripIndices(e,t):this.getMeshFaceIndices(e,t),r.mode="TRIANGLE_STRIP"===this.drawMode?5:4):r.mode=0,i.indices&&(r.indices={value:i.indices,size:1},delete i.indices),r.attributes=i,r}},{key:"getPositionAttributeMetadata",value:function(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};var t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(var n=0;n<3;++n)this.metadata.attributes.position.minValues[n]=t.min_value(n)}this.draco.destroy(t)}},{key:"getAttributes",value:function(e,t){var n={},r=t.num_points();for(var i in ta){var a=this.draco[i],o=e.GetAttributeId(t,a);if(-1!==o){var s=e.GetAttribute(t,o),c=this.getAttributeTypedArray(e,t,s,i).typedArray;n[ta[i]]={value:c,size:c.length/r}}}return n}},{key:"getMeshFaceIndices",value:function(e,t){for(var n=t.num_faces(),r=new Uint32Array(3*n),i=new this.draco.DracoInt32Array,a=0;a<n;++a){e.GetFaceFromMesh(t,a,i);var o=3*a;r[o]=i.GetValue(0),r[o+1]=i.GetValue(1),r[o+2]=i.GetValue(2)}return this.draco.destroy(i),r}},{key:"getMeshStripIndices",value:function(e,t){var n=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,n);for(var r=new Uint32Array(n.size()),i=0;i<n.size();++i)r[i]=n.GetValue(i);return this.draco.destroy(n),r}},{key:"getAttributeTypedArray",value:function(e,t,n,r){if(0===n.ptr){var i="DRACO decode bad attribute ".concat(r);throw new Error(i)}var a,o,s=na[n.data_type()],c=n.num_components(),u=t.num_points()*c;switch(s){case Float32Array:a=new this.draco.DracoFloat32Array,e.GetAttributeFloatForAllPoints(t,n,a),o=new Float32Array(u);break;case Int8Array:a=new this.draco.DracoInt8Array,e.GetAttributeInt8ForAllPoints(t,n,a),o=new Int8Array(u);break;case Int16Array:a=new this.draco.DracoInt16Array,e.GetAttributeInt16ForAllPoints(t,n,a),o=new Int16Array(u);break;case Int32Array:a=new this.draco.DracoInt32Array,e.GetAttributeInt32ForAllPoints(t,n,a),o=new Int32Array(u);break;case Uint8Array:a=new this.draco.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(t,n,a),o=new Uint8Array(u);break;case Uint16Array:a=new this.draco.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(t,n,a),o=new Uint16Array(u);break;case Uint32Array:a=new this.draco.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(t,n,a),o=new Uint32Array(u);break;default:throw new Error("DRACO decoder: unexpected attribute type.")}for(var l=0;l<u;l++)o[l]=a.GetValue(l);return this.draco.destroy(a),{typedArray:o,components:c}}},{key:"decode",value:function(e,t){return this.parseSync(e,t)}}]),e}();function ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ia(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oa=aa(aa({},{id:"draco",name:"Draco",version:"2.2.3",extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,test:"DRACO",options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":Object(Qe.a)(WebAssembly))?"wasm":"js",libraryPath:"libs/",workerUrl:"https://unpkg.com/@loaders.gl/draco@".concat("2.2.3","/dist/draco-loader.worker.js"),localWorkerUrl:"modules/draco/dist/draco-loader.worker.dev.js"}}}),{},{parse:function(e,t,n,r){return sa.apply(this,arguments)}});function sa(){return(sa=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zi(n);case 2:return a=e.sent,o=a.draco,s=new ra(o),e.prev=5,e.abrupt("return",s.parseSync(t));case 7:return e.prev=7,s.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})))).apply(this,arguments)}function ca(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ca(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var la,ha={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},fa=ua(ua({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6}),ha),pa=(n("zZTu"),la={},Object(_.a)(la,ha.DOUBLE,Float64Array),Object(_.a)(la,ha.FLOAT,Float32Array),Object(_.a)(la,ha.UNSIGNED_SHORT,Uint16Array),Object(_.a)(la,ha.UNSIGNED_INT,Uint32Array),Object(_.a)(la,ha.UNSIGNED_BYTE,Uint8Array),Object(_.a)(la,ha.BYTE,Int8Array),Object(_.a)(la,ha.SHORT,Int16Array),Object(_.a)(la,ha.INT,Int32Array),la),da={DOUBLE:ha.DOUBLE,FLOAT:ha.FLOAT,UNSIGNED_SHORT:ha.UNSIGNED_SHORT,UNSIGNED_INT:ha.UNSIGNED_INT,UNSIGNED_BYTE:ha.UNSIGNED_BYTE,BYTE:ha.BYTE,SHORT:ha.SHORT,INT:ha.INT},ya=function(){function e(){Object(y.a)(this,e)}return Object(b.a)(e,null,[{key:"fromTypedArray",value:function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,pa){if(pa[t]===e)return t}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(e){var t=da[e];if(!t)throw new Error("Failed to convert GL type");return t}},{key:"getArrayType",value:function(e){switch(e){case ha.UNSIGNED_SHORT_5_6_5:case ha.UNSIGNED_SHORT_4_4_4_4:case ha.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=pa[e];if(!t)throw new Error("Failed to convert GL type");return t}}},{key:"getByteSize",value:function(t){return e.getArrayType(t).BYTES_PER_ELEMENT}},{key:"validate",value:function(t){return Boolean(e.getArrayType(t))}},{key:"createTypedArray",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(n.byteLength-r)/e.getByteSize(t));var a=e.getArrayType(t);return new a(n,r,i)}}]),e}(),va=function(){function e(t,n){Object(y.a)(this,e),this.json=t,this.buffer=n,this.featuresLength=0,this._cachedTypedArrays={}}return Object(b.a)(e,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fa.UNSIGNED_INT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,r.byteOffset):r}},{key:"getPropertyArray",value:function(e,t,n){var r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=ya.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}},{key:"getProperty",value:function(e,t,n,r,i){var a=this.json[e];if(!a)return a;var o=this.getPropertyArray(e,t,n);if(1===n)return o[r];for(var s=0;s<n;++s)i[s]=o[n*r+s];return i}},{key:"_getTypedArrayFromBinary",value:function(e,t,n,r,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=ya.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,r*n),a[e]=o),o}},{key:"_getTypedArrayFromArray",value:function(e,t,n){var r=this._cachedTypedArrays,i=r[e];return i||(i=ya.createTypedArray(t,n),r[e]=i),i}}]),e}(),ba=n("KQm4"),ga={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ma={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},Oa={SCALAR:function(e,t,n){t[n]=e},VEC2:function(e,t,n){t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:function(e,t,n){t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:function(e,t,n){t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:function(e,t,n){t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};n("n0hJ");var _a=function(e){return void 0!==e};function wa(e,t,n){if(!t)return null;var r=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?function(e,t){var n,r,i,a,o=e.instancesLength,s=e.classes,c=e.classIds,u=e.parentCounts,l=e.parentIds,h=o;_a(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),Jr("classIds"),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,o));if(_a(u))for(_a(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),Jr("parentCounts"),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o)),a=new Uint16Array(o),Jr("parentIdsLength"),h=0,n=0;n<o;++n)a[n]=h,h+=(Jr("parentIdsLength"),u[n]);_a(l)&&_a(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),Jr("parentIds"),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));var f=s.length;for(n=0;n<f;++n){var p=s[n].length,d=s[n].instances,y=getBinaryProperties(p,d,t);s[n].instances=combine(y,d)}var v=new Array(f).fill(0),b=new Uint16Array(o);for(n=0;n<o;++n)r=c[n],b[n]=v[r],++v[r];var g={classes:s,classIds:c,classIndexes:b,parentCounts:u,parentIndexes:a,parentIds:l};return function(e){for(var t=e.classIds.length,n=0;n<t;++n)ja(e,n,stack)}(g),g}(r,n):null}function Ta(e,t,n){if(e){var r=e.parentCounts;return e.parentIds?n(e,t):r>0?function(e,t,n){var r=e.classIds,i=e.parentCounts,a=e.parentIds,o=e.parentIndexes,s=r.length,c=scratchVisited;c.length=Math.max(c.length,s);var u=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;)if(t=l.pop(),c[t]!==u){c[t]=u;var h=n(e,t);if(_a(h))return h;for(var f=i[t],p=o[t],d=0;d<f;++d){var y=a[p+d];y!==t&&l.push(y)}}return null}(e,t,n):function(e,t,n){var r=!0;for(;r;){var i=n(e,t);if(_a(i))return i;var a=e.parentIds[t];r=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,n)}}function ja(e,t,n){var r=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=e.classIds.length;if(_a(i)){assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(-1===n.indexOf(t),"Circular dependency detected in the batch table hierarchy."),n.push(t);for(var s=_a(r)?r[t]:1,c=_a(r)?a[t]:t,u=0;u<s;++u){var l=i[c+u];l!==t&&ja(e,l,n)}n.pop(t)}}function Ea(e){return null!=e}var ka={HIERARCHY:!0,extensions:!0,extras:!0},xa=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var a in Object(y.a)(this,e),Object(wr.a)(r>=0),this.json=t||{},this.binary=n,this.featureCount=r,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)ka[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=wa(this,this.json,this.binary))}return Object(b.a)(e,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,t){return this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),!!this._hierarchy&&Ea(Ta(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return e.classes[r].name===t})))}},{key:"isExactClass",value:function(e,t){return Object(wr.a)("string"==typeof t,t),this.getExactClassName(e)===t}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}},{key:"hasProperty",value:function(e,t){return this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),Ea(this._properties[t])||this._hasPropertyInHierarchy(e,t)}},{key:"getPropertyNames",value:function(e,t){var n;this._checkBatchId(e),(t=Ea(t)?t:[]).length=0;var r=Object.keys(this._properties);return(n=t).push.apply(n,Object(ba.a)(r)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}},{key:"getProperty",value:function(e,t){if(this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),this._binaryProperties){var n=this._binaryProperties[t];if(Ea(n))return this._getBinaryProperty(n,e)}var r=this._properties[t];if(Ea(r))return r[e];if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(Ea(i))return i}}},{key:"setProperty",value:function(e,t,n){var r=this.featureCount;if(this._checkBatchId(e,r),Object(wr.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,n)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,n)){var a=this._properties[t];Ea(a)||(this._properties[t]=new Array(r),a=this._properties[t]),a[e]=n}}},{key:"_checkBatchId",value:function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,t){return e.unpack(e.typedArray,t)}},{key:"_setBinaryProperty",value:function(e,t,n){e.pack(n,e.typedArray,t)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var t in this._properties){var n=this._properties[t],r=this._initializeBinaryProperty(t,n);r&&((e=e||{})[t]=r)}return e}},{key:"_initializeBinaryProperty",value:function(e,t){if("byteOffset"in t){var n=t;Object(wr.a)(this.binary,"Property ".concat(e," requires a batch table binary.")),Object(wr.a)(n.type,"Property ".concat(e," requires a type."));var r=function(e,t,n,r){var i=e.componentType;Object(wr.a)(e.componentType);var a="string"==typeof i?ya.fromName(i):i,o=ga[e.type],s=ma[e.type],c=Oa[e.type];return n+=e.byteOffset,{values:ya.createTypedArray(a,t,n,o*r),type:a,size:o,unpacker:s,packer:c}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,t){if(!this._hierarchy)return!1;var n=Ta(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return Ea(e.classes[r].instances[t])}));return Ea(n)}},{key:"_getPropertyNamesInHierarchy",value:function(e,t){Ta(this._hierarchy,e,(function(e,n){var r=e.classIds[n],i=e.classes[r].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)}))}},{key:"_getHierarchyProperty",value:function(e,t){var n=this;return Ta(this._hierarchy,e,(function(e,r){var i=e.classIds[r],a=e.classes[i],o=e.classIndexes[r],s=a.instances[t];return Ea(s)?Ea(s.typedArray)?n._getBinaryProperty(s,o):s[o]:null}))}},{key:"_setHierarchyProperty",value:function(e,t,n,r){var i=this,a=Ta(this._hierarchy,t,(function(e,a){var o=e.classIds[a],s=e.classes[o],c=e.classIndexes[a],u=s.instances[n];return!!Ea(u)&&(Object(wr.a)(a===t,'Inherited property "'.concat(n,'" is read-only.')),Ea(u.typedArray)?i._setBinaryProperty(u,c,r):u[c]=r,!0)}));return Ea(a)}}]),e}();function Sa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new DataView(t);if(e.magic=r.getUint32(n,!0),n+=4,e.version=r.getUint32(n,!0),n+=4,e.byteLength=r.getUint32(n,!0),n+=4,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return n}function Aa(e,t,n){var r=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=r.getUint32(n,!0),n+=4,e.header.featureTableBinaryByteLength=r.getUint32(n,!0),n+=4,e.header.batchTableJsonByteLength=r.getUint32(n,!0),n+=4,e.header.batchTableBinaryByteLength=r.getUint32(n,!0),n+=4}function Pa(e,t,n,r){return n=function(e,t,n,r){var i=e.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength;if(e.featureTableJson={BATCH_LENGTH:0},a>0){var s=zi(t,n,a);e.featureTableJson=JSON.parse(s)}return n+=a,e.featureTableBinary=new Uint8Array(t,n,o),n+=o}(e,t,n),n=function(e,t,n,r){var i=e.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=zi(t,n,a);e.batchTableJson=JSON.parse(s),n+=a,o>0&&(e.batchTableBinary=new Uint8Array(t,n,o),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=o)}return n}(e,t,n)}n("HOSt");function Ia(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=e>>11&31,r=e>>5&63,i=31&e;return t[0]=n<<3,t[1]=r<<2,t[2]=i<<3,t}function Ca(e,t,n){if(!(t||e&&e.batchIds&&n))return null;var r=e.batchIds,i=e.isRGB565,a=e.pointCount;if(r&&n){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var c=r[s],u=n.getProperty(c,"dimensions").map((function(e){return 255*e}));o[3*s]=u[0],o[3*s+1]=u[1],o[3*s+2]=u[2]}return{type:fa.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),h=0;h<a;h++){var f=Ia(t[h]);l[3*h]=f[0],l[3*h+1]=f[1],l[3*h+2]=f[2]}return{type:fa.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return t&&t.length===3*a?{type:fa.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:fa.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}var Ra=n("uJc0");function Da(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}new Ra.a,new qn.a,new Ra.a,new Ra.a,new Uint8Array(1);function Na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Object(Yn.a)(e,0,t)/t*2-1}function La(e){return e<0?-1:1}function Ma(e,t,n,r){if(Da(r),e<0||e>n||t<0||t>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=Na(e,n),r.y=Na(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){var i=r.x;r.x=(1-Math.abs(r.y))*La(i),r.y=(1-Math.abs(i))*La(r.y)}return r.normalize()}function Ua(e,t,n){return Ma(e,t,255,n)}var Ba=new qn.a;function za(e,t,n){return e.isQuantized?n.decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var n=new qn.a,r=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)n.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,3*i);return r}(e,t)):{type:fa.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Va(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ga(e,t,n,r,i){return Ha.apply(this,arguments)}function Ha(){return(Ha=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Sa(t,n,r,i),r=Aa(t,n,r),r=Pa(t,n,r),qa(t),o=Wa(t),s=o.featureTable,c=o.batchTable,e.next=7,Ja(t,s,c,i,a);case 7:return Za(t,s,i),Ya(t,s,c),Xa(t,s),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qa(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function Wa(e){var t=new va(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",fa.FLOAT,3);var r=function(e,t){var n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",fa.UNSIGNED_SHORT,1),e.batchIds)){var r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;n=new xa(i,a,r)}return n}(e,t);return{featureTable:t,batchTable:r}}function Za(e,t,n){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",fa.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var r=t.getPropertyArray("POSITION_QUANTIZED",fa.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",fa.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",fa.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=za(e,r,n)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Ya(e,t,n){if(!e.attributes.colors){var r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",fa.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",fa.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",fa.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=Ca(e,r,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",fa.UNSIGNED_BYTE,4))}function Xa(e,t){if(!e.attributes.normals){var n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",fa.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",fa.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){for(var n=new Float32Array(3*e.pointsLength),r=0;r<e.pointsLength;r++)Ua(t[2*r],t[2*r+1],Ba),Ba.toArray(n,3*r);return{type:fa.FLOAT,size:2,value:n}}return{type:fa.FLOAT,size:2,value:t}}(e,n)}}function Ja(e,t,n,r,i){return Ka.apply(this,arguments)}function Ka(){return(Ka=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c,u,l,h,f,p;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((u=r&&r.getExtension("3DTILES_draco_point_compression"))&&(c=u.properties),!(l=n.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(s=l.properties,h=l.byteOffset,f=l.byteLength,s&&Number.isFinite(h)&&f){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=t.featureTableBinary.slice(h,h+f),t.hasPositions=Number.isFinite(s.POSITION),t.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),t.hasNormals=Number.isFinite(s.NORMAL),t.hasBatchIds=Number.isFinite(s.BATCH_ID),t.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){e.next=17;break}return e.abrupt("return",!0);case 17:return p={buffer:o,properties:Fa(Fa({},s),c),featureTableProperties:s,batchTableProperties:c,dequantizeInShader:!1},e.next=20,Qa(t,p,i,a);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qa(e,t,n,r){return $a.apply(this,arguments)}function $a(){return($a=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s,c,u,l,h,f,p,d;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.parse,e.next=3,a(n.buffer,oa,{});case 3:o=e.sent,s=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,u=o.attributes.NORMAL&&o.attributes.NORMAL.value,l=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=s&&o.attributes.POSITION.value.quantization,f=u&&o.attributes.NORMAL.value.quantization,h&&(p=o.POSITION.data.quantization,d=p.range,t.quantizedVolumeScale=new qn.a(d,d,d),t.quantizedVolumeOffset=new qn.a(p.minValues),t.quantizedRange=(1<<p.quantizationBits)-1,t.isQuantizedDraco=!0),f&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),t.attributes={positions:s,colors:Ca(t,c),normals:u,batchIds:l};case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n("sC2a");var eo=n("kEPd"),to=n("sx9D"),no=n("h5Ug");function ro(e,t){if(!e)throw new Error(t||"assert failed: gltf")}n("lFjb");function io(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return n.substr(0,n.lastIndexOf("/")+1)+e}function ao(e,t,n){var r=e.bufferViews[n];ro(r);var i=t[r.buffer];ro(i);var a=(r.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,r.byteLength)}var oo=n("YkLe"),so=["SCALAR","VEC2","VEC3","VEC4"],co=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),uo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lo={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ho={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function fo(e){return so[e-1]||so[0]}function po(e){var t=co.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function yo(e,t){var n=ho[e.componentType],r=uo[e.type],i=lo[e.componentType],a=e.count*r,o=e.count*r*i;return ro(o>=0&&o<=t.byteLength),{ArrayType:n,length:a,byteLength:o}}var vo=function(){function e(t){if(Object(y.a)(this,e),t instanceof e)return t;t||(t={json:{version:2,buffers:[]},buffers:[]}),this.gltf=t,ro(this.gltf.json)}return Object(b.a)(e,[{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"getExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),n=this.json.extensions||{};return t?n[e]||!0:null}},{key:"getRequiredExtension",value:function(e){return this.getRequiredExtensions().find((function(t){return t===e}))?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,t){if("object"===Object(Qe.a)(t))return t;var n=this.json[e]&&this.json[e][t];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return n}},{key:"getTypedArrayForBufferView",value:function(e){var t=(e=this.getBufferView(e)).buffer,n=this.gltf.buffers[t];ro(n);var r=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=yo(e,t),i=r.ArrayType,a=r.length;return new i(n,t.byteOffset+e.byteOffset,a)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(n,r,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,n){return ro(n),e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}},{key:"removeObjectExtension",value:function(e,t){return delete(e.extensions||{})[t],this}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ro(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ro(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}},{key:"setObjectExtension",value:function(e,t,n){(e.extensions||{})[t]=n}},{key:"addMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=this._addAttributes(e),i={primitives:[{attributes:r,indices:t,mode:n}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){t=t||Object(oo.a)(e);var n={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=e.byteLength;ro(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var n={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Object(no.c)(t),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var n={bufferView:e,type:fo(t.size),componentType:t.componentType,count:t.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},n=this.addBufferView(e),r={size:t.size,componentType:po(e),count:Math.round(e.length/t.size)};return this.addAccessor(n,Object.assign(r,t))}},{key:"createBinaryChunk",value:function(){if(!this.arrayBuffer){for(var e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t),r=0,i=0;i<this.sourceBuffers.length;i++){var a=this.sourceBuffers[i];r=Object(no.a)(a,n,r)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}}},{key:"_removeStringFromArray",value:function(e,t){for(var n=!0;n;){var r=e.indexOf(t);r>-1?e.splice(r,1):n=!1}}},{key:"json",get:function(){return this.gltf.json}}]),e}();function bo(e){var t={};for(var n in e){var r=e[n];if("indices"!==n){var i=go(r);t[n]=i}}return t}function go(e,t){var n=function(e,t){var n=e,r=1,i=0;e&&e.value&&(n=e.value,r=e.size||1);n&&(ArrayBuffer.isView(n)||(n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(n&&!(e instanceof t))return new t(e);return e}(n,Float32Array)),i=n.length/r);return{buffer:n,size:r,count:i}}(e),r=n.buffer,i=n.size;return{value:r,size:i,bufferView:null,byteOffset:0,count:n.count,type:fo(i),componentType:po(r)}}var mo=In.a.mark(Ao);function Oo(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wo(e,t,n){return To.apply(this,arguments)}function To(){return(To=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o,s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.gltf.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:i=new vo(t),a=[],o=Oo(Ao(i));try{for(o.s();!(s=o.n()).done;)c=s.value,i.getObjectExtension(c,"KHR_draco_mesh_compression")&&a.push(Eo(c,i,n,r))}catch(u){o.e(u)}finally{o.f()}return e.next=8,Promise.all(a);case 8:i.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jo(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new vo(e),i=Oo(r.json.meshes||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;xo(a,n),r.addRequiredExtension("KHR_draco_mesh_compression")}}catch(o){i.e(o)}finally{i.f()}}function Eo(e,t,n,r){return ko.apply(this,arguments)}function ko(){return(ko=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s,c,u;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getObjectExtension(t,"KHR_draco_mesh_compression"),o=n.getTypedArrayForBufferView(a.bufferView),s=Object(no.b)(o.buffer,o.byteOffset),c=i.parse,e.next=6,c(s,oa,r,i);case 6:u=e.sent,t.attributes=bo(u.attributes),u.indices&&(t.indices=go(u.indices)),So(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter||!r.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");var a=r.DracoWriter.encodeSync({attributes:e}),o=i.parseSync,s=o({attributes:e}),c=r._addFauxAttributes(s.attributes),u=r.addBufferView(a),l={primitives:[{attributes:c,mode:n,extensions:Object(_.a)({},"KHR_draco_mesh_compression",{bufferView:u,attributes:c})}]};return l}function So(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}function Ao(e){var t,n,r,i,a,o;return In.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=Oo(e.json.meshes||[]),s.prev=1,t.s();case 3:if((n=t.n()).done){s.next=24;break}r=n.value,i=Oo(r.primitives),s.prev=6,i.s();case 8:if((a=i.n()).done){s.next=14;break}return o=a.value,s.next=12,o;case 12:s.next=8;break;case 14:s.next=19;break;case 16:s.prev=16,s.t0=s.catch(6),i.e(s.t0);case 19:return s.prev=19,i.f(),s.finish(19);case 22:s.next=3;break;case 24:s.next=29;break;case 26:s.prev=26,s.t1=s.catch(1),t.e(s.t1);case 29:return s.prev=29,t.f(),s.finish(29);case 32:case"end":return s.stop()}}),mo,null,[[1,26,29,32],[6,16,19,22]])}function Po(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Io(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Io(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Io(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Co(e,t){var n=new vo(e),r=n.json,i=n.getExtension("KHR_lights_punctual");i&&(n.json.lights=i.lights,n.removeExtension("KHR_lights_punctual"));var a,o=Po(r.nodes||[]);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=n.getObjectExtension(s,"KHR_lights_punctual");c&&(s.light=c.light),n.removeObjectExtension(s,"KHR_lights_punctual")}}catch(u){o.e(u)}finally{o.f()}}function Ro(e,t){var n=new vo(e),r=n.json;if(r.lights){var i=n.addExtension("KHR_lights_punctual");ro(!i.lights),i.lights=r.lights,delete r.lights}if(n.json.lights){var a,o=Po(n.json.lights);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.node;n.addObjectExtension(c,"KHR_lights_punctual",s)}}catch(u){o.e(u)}finally{o.f()}delete n.json.lights}}function Do(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return No(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return No(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function No(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lo(e,t){var n=new vo(e),r=n.json;n.removeExtension("KHR_materials_unlit");var i,a=Do(r.materials||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.extensions&&o.extensions.KHR_materials_unlit&&(o.unlit=!0),n.removeObjectExtension(o,"KHR_materials_unlit")}}catch(s){a.e(s)}finally{a.f()}}function Mo(e,t){var n=new vo(e),r=n.json;if(n.materials){var i,a=Do(r.materials);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.unlit&&(delete o.unlit,n.addObjectExtension(o,"KHR_materials_unlit"),n.addExtension("KHR_materials_unlit"))}}catch(s){a.e(s)}finally{a.f()}}}function Uo(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Bo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zo(e,t){var n=new vo(e),r=n.json,i=n.getExtension("KHR_techniques_webgl");if(i){var a,o=function(e,t){var n=e.programs,r=void 0===n?[]:n,i=e.shaders,a=void 0===i?[]:i,o=e.techniques,s=void 0===o?[]:o,c=new TextDecoder;return a.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=c.decode(t.getTypedArrayForBufferView(e.bufferView))})),r.forEach((function(e){e.fragmentShader=a[e.fragmentShader],e.vertexShader=a[e.vertexShader]})),s.forEach((function(e){e.program=r[e.program]})),s}(i,n),s=Uo(r.materials||[]);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=n.getObjectExtension(c,"KHR_techniques_webgl");u&&(c.technique=Object.assign({},u,o[u.technique]),c.technique.values=Fo(c.technique,n)),n.removeObjectExtension(c,"KHR_techniques_webgl")}}catch(l){s.e(l)}finally{s.f()}n.removeExtension("KHR_techniques_webgl")}}function Vo(e,t){}function Fo(e,t){var n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)})),Object.keys(n).forEach((function(e){"object"===Object(Qe.a)(n[e])&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))})),n}var Go={KHR_draco_mesh_compression:r,KHR_lights_punctual:i,KHR_materials_unlit:a,KHR_techniques_webgl:o};function Ho(e){return qo.apply(this,arguments)}function qo(){return(qo=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o,s=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2?s[2]:void 0,n.gltf=n.gltf||{},e.t0=In.a.keys(Go);case 4:if((e.t1=e.t0()).done){e.next=14;break}if(i=e.t1.value,a=n.gltf.excludeExtensions||{},i in a&&!a[i]){e.next=12;break}return o=Go[i],e.next=12,o.decode(t,n,r);case 12:e.next=4;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Wo;function Zo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function Yo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new DataView(e),i=n.magic,a=void 0===i?1735152710:i,o=r.getUint32(t,!1);return o===a||1735152710===o}function Xo(e,t,n,r){for(;n+8<=e.header.byteLength;){var i=t.getUint32(n+0,!0),a=t.getUint32(n+4,!0);switch(n+=8,a){case 1313821514:Jo(e,t,n,i,r);break;case 5130562:Ko(e,t,n,i,r);break;case 0:r.glb.strict||Jo(e,t,n,i,r);break;case 1:r.glb.strict||Ko(e,t,n,i,r)}n+=Object(no.c)(i)}return n}function Jo(e,t,n,r,i){var a=new Uint8Array(t.buffer,n,r),o=new TextDecoder("utf8").decode(a);e.json=JSON.parse(o)}function Ko(e,t,n,r,i){e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:t.buffer})}function Qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qo(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var es={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ts={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ns={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},rs={magFilter:ns.TEXTURE_MAG_FILTER,minFilter:ns.TEXTURE_MIN_FILTER,wrapS:ns.TEXTURE_WRAP_S,wrapT:ns.TEXTURE_WRAP_T},is=(Wo={},Object(_.a)(Wo,ns.TEXTURE_MAG_FILTER,ns.LINEAR),Object(_.a)(Wo,ns.TEXTURE_MIN_FILTER,ns.NEAREST_MIPMAP_LINEAR),Object(_.a)(Wo,ns.TEXTURE_WRAP_S,ns.REPEAT),Object(_.a)(Wo,ns.TEXTURE_WRAP_,ns.REPEAT),Wo);var as=function(){function e(){Object(y.a)(this,e)}return Object(b.a)(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.json,r=e.buffers,i=void 0===r?[]:r,a=e.images,o=void 0===a?[]:a,s=e.baseUri,c=void 0===s?"":s;return ro(n),this.baseUri=c,this.json=n,this.buffers=i,this.images=o,this._resolveTree(this.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this;e.bufferViews&&(e.bufferViews=e.bufferViews.map((function(e,n){return t._resolveBufferView(e,n)}))),e.images&&(e.images=e.images.map((function(e,n){return t._resolveImage(e,n)}))),e.samplers&&(e.samplers=e.samplers.map((function(e,n){return t._resolveSampler(e,n)}))),e.textures&&(e.textures=e.textures.map((function(e,n){return t._resolveTexture(e,n)}))),e.accessors&&(e.accessors=e.accessors.map((function(e,n){return t._resolveAccessor(e,n)}))),e.materials&&(e.materials=e.materials.map((function(e,n){return t._resolveMaterial(e,n)}))),e.meshes&&(e.meshes=e.meshes.map((function(e,n){return t._resolveMesh(e,n)}))),e.nodes&&(e.nodes=e.nodes.map((function(e,n){return t._resolveNode(e,n)}))),e.skins&&(e.skins=e.skins.map((function(e,n){return t._resolveSkin(e,n)}))),e.scenes&&(e.scenes=e.scenes.map((function(e,n){return t._resolveScene(e,n)}))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,t){if("object"===Object(Qe.a)(t))return t;var n=this.json[e]&&this.json[e][t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}},{key:"_resolveScene",value:function(e,t){var n=this;return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((function(e){return n.getNode(e)})),e}},{key:"_resolveNode",value:function(e,t){var n=this;return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((function(e){return n.getNode(e)}))),void 0!==e.mesh&&(e.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,t){var n=this;return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((function(e){var t=(e=$o({},e)).attributes;for(var r in e.attributes={},t)e.attributes[r]=n.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=n.getAccessor(e.indices)),void 0!==e.material&&(e.material=n.getMaterial(e.material)),e}))),e}},{key:"_resolveMaterial",value:function(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture=$o({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=$o({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=$o({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.pbrMetallicRoughness){e.pbrMetallicRoughness=$o({},e.pbrMetallicRoughness);var n=e.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture=$o({},n.baseColorTexture),n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture=$o({},n.metallicRoughnessTexture),n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,t){var n,r;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(n=e.componentType,ts[n]),e.components=(r=e.type,es[r]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var i=e.bufferView.buffer,a=yo(e,e.bufferView),o=a.ArrayType,s=a.length,c=(e.bufferView.byteOffset||0)+i.byteOffset;e.value=new o(i.arrayBuffer,c,s)}return e}},{key:"_resolveTexture",value:function(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):is,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,t){for(var n in e.id=e.id||"sampler-".concat(t),e.parameters={},e){var r=this._enumSamplerParameter(n);void 0!==r&&(e.parameters[r]=e[n])}return e}},{key:"_enumSamplerParameter",value:function(e){return rs[e]}},{key:"_resolveImage",value:function(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));var n=this.images[t];return n&&(e.image=n),e}},{key:"_resolveBufferView",value:function(e,t){e.id=e.id||"bufferView-".concat(t);var n=e.buffer;e.buffer=this.buffers[n];var r=this.buffers[n].arrayBuffer,i=this.buffers[n].byteOffset||0;return"byteOffset"in e&&(i+=e.byteOffset),e.data=new Uint8Array(r,i,e.byteLength),e}},{key:"_resolveCamera",value:function(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}]),e}();function os(e,t){return(new as).postProcess(e,t)}function ss(e,t){return cs.apply(this,arguments)}function cs(){return(cs=Object(Gn.a)(In.a.mark((function e(t,n){var r,i,a,o,s,c,u=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:0,i=u.length>3?u[3]:void 0,a=u.length>4?u[4]:void 0,us(t,n,r,i),o=[],i.gltf.loadImages&&(s=fs(t,i,a),o.push(s)),!i.gltf.loadBuffers){e.next=9;break}return e.next=9,ls(t,i,a);case 9:return c=Ho(t,i,a),o.push(c),e.next=13,Promise.all(o);case 13:return e.abrupt("return",i.gltf.postProcess?os(t,i):t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function us(e,t,n,r){(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!Yo(t,n,r))&&(t=(new TextDecoder).decode(t));if("string"==typeof t)e.json=Object(to.a)(t);else if(t instanceof ArrayBuffer){var i={};n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=new DataView(t);e.type=Zo(i,n+0),e.version=i.getUint32(n+4,!0);var a=i.getUint32(n+8,!0);return e.header={byteOffset:n,byteLength:a},Object(wr.a)(2===e.version,"Invalid GLB version ".concat(e.version,". Only supports v2.")),Object(wr.a)(e.header.byteLength>20),e.json={},e.binChunks=[],Xo(e,i,n+12,r),n+e.header.byteLength}(i,t,n,r),ro("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else ro(!1,"GLTF: must be ArrayBuffer or string");var a=e.json.buffers||[];if(e.buffers=new Array(a.length).fill(null),e._glb&&e._glb.header.hasBinChunk){var o=e._glb.binChunks;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}var s=e.json.images||[];e.images=new Array(s.length).fill({})}function ls(e,t,n){return hs.apply(this,arguments)}function hs(){return(hs=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o,s,c,u;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<t.json.buffers.length)){e.next=18;break}if(!(a=t.json.buffers[i]).uri){e.next=15;break}return ro(o=r.fetch),s=io(a.uri,n),e.next=9,o(s);case 9:return c=e.sent,e.next=12,c.arrayBuffer();case 12:u=e.sent,t.buffers[i]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri;case 15:++i,e.next=1;break;case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fs(e,t,n){return ps.apply(this,arguments)}function ps(){return(ps=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.json.images||[],a=[],o=0;o<i.length;++o)a.push(ds(t,i[o],o,n,r));return e.next=5,Promise.all(a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ds(e,t,n,r,i){return ys.apply(this,arguments)}function ys(){return(ys=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c,u,l,h,f;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.fetch,s=a.parse,!n.uri){e.next=9;break}return u=io(n.uri,i),e.next=5,o(u);case 5:return l=e.sent,e.next=8,l.arrayBuffer();case 8:c=e.sent;case 9:return Number.isFinite(n.bufferView)&&(h=ao(t.json,t.buffers,n.bufferView),c=Object(no.b)(h.buffer,h.byteOffset,h.byteLength)),ro(c,"glTF image has no data"),e.next=13,s(c,eo.a,{},a);case 13:f=e.sent,t.images[r]=f;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gs={id:"gltf",name:"glTF",version:"2.2.3",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,test:"glTF",parse:function(e){return Os.apply(this,arguments)},options:{gltf:{loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}},ms=gs;function Os(){return(Os=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o,s=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2?s[2]:void 0,(n=bs(bs({},gs.options),n)).gltf=bs(bs({},gs.options.gltf),n.gltf),_s(n),i=n.byteOffset,a=void 0===i?0:i,o={},e.next=9,ss(o,t,a,n,r);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _s(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess)}var ws=0,Ts=1;function js(e,t,n){e.rotateYtoZ=!0;var r=e.byteOffset+e.byteLength-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");return e.gltfArrayBuffer=Object(no.b)(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,n%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}function Es(e,t,n,r){return ks.apply(this,arguments)}function ks(){return(ks=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xs(t,n,r),!r.loadGLTF){e.next=15;break}if(a=i.parse,o=i.fetch,!t.gltfUrl){e.next=8;break}return e.next=6,o(t.gltfUrl,r);case 6:t.gltfArrayBuffer=e.sent,t.gltfByteOffset=0;case 8:if(!t.gltfArrayBuffer){e.next=15;break}return e.next=11,a(t.gltfArrayBuffer,ms,r,i);case 11:t.gltf=e.sent,delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xs(e,t,n){switch(t){case ws:var r=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(r);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Ts:break;default:throw new Error("b3dm: Illegal glTF format field")}}function Ss(e,t,n,r,i){return As.apply(this,arguments)}function As(){return(As=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ps(t,n,r,i,a),e.next=3,Es(t,Ts,i,a);case 3:return o=t.gltf||{},(s=o.extensions)&&s.CESIUM_RTC&&(t.rtcCenter=s.CESIUM_RTC.center),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ps(e,t,n,r,i){n=js(e,t,n=Pa(e,t,n=Aa(e,t,n=Sa(e,t,n,r))));var a=new va(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",fa.FLOAT,3),n}var Is=n("PcVa");function Cs(e,t,n,r,i){return Rs.apply(this,arguments)}function Rs(){return(Rs=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ds(t,n,r,i,a),e.next=3,Es(t,t.gltfFormat,i,a);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ds(e,t,n,r,i){if(n=Sa(e,t,n,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));n=Aa(e,t,n);var a=new DataView(t);if(e.gltfFormat=a.getUint32(n,!0),n=js(e,t,n=Pa(e,t,n+=4)),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new va(e.featureTableJson,e.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",fa.FLOAT,3);new xa(e.batchTableJson,e.batchTableBinary,s);return function(e,t,n,r){for(var i=[new Array(r),e._batchTable][0],a=new qn.a,o=(new qn.a,new qn.a,new qn.a,new Kr.a),s=new Is.a,c=new qn.a,u={},l=new Hn.a,h=[],f=[],p=new qn.a,d=new qn.a,y=0;y<r;y++){var v=void 0;if(t.hasProperty("POSITION"))v=t.getProperty("POSITION",fa.FLOAT,3,y,a);else if(t.hasProperty("POSITION_QUANTIZED")){v=t.getProperty("POSITION_QUANTIZED",fa.UNSIGNED_SHORT,3,y,a);var b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",fa.FLOAT,3,p);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var g=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",fa.FLOAT,3,d);if(!g)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var m=0;m<3;m++)v[m]=v[m]/65535*g[m]+b[m]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(v),u.translation=a,e.normalUp=t.getProperty("NORMAL_UP",fa.FLOAT,3,y,h),e.normalRight=t.getProperty("NORMAL_RIGHT",fa.FLOAT,3,y,f);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",fa.UNSIGNED_SHORT,2,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",fa.UNSIGNED_SHORT,2,f),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(Or.WGS84.eastNorthUpToFixedFrame(a,l),l.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),u.rotation=s,c.set(1,1,1);var O=t.getProperty("SCALE",fa.FLOAT,1,y);Number.isFinite(O)&&c.multiplyByScalar(O);var _=t.getProperty("SCALE_NON_UNIFORM",fa.FLOAT,3,y,h);_&&c.scale(_),u.scale=c;var w=t.getProperty("BATCH_ID",fa.UNSIGNED_SHORT,1,y);void 0===w&&(w=y);var T=(new Hn.a).fromQuaternion(u.rotation);l.identity(),l.translate(u.translation),l.multiplyRight(T),l.scale(u.scale);var j=l.clone();i[y]={modelMatrix:j,batchId:w}}e.instances=i}(e,o,0,s),n}function Ns(e,t,n,r,i,a){return Ls.apply(this,arguments)}function Ls(){return(Ls=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a,o){var s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Sa(t,n,r,i),s=new DataView(n),t.tilesLength=s.getUint32(r,!0),r+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-r>12)){e.next=13;break}return c={},t.tiles.push(c),e.next=10,o(n,r,i,a,c);case 10:r=e.sent,e.next=5;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ms(e){return Us.apply(this,arguments)}function Us(){return(Us=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:0,r=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,a=o.length>4&&void 0!==o[4]?o[4]:{},r=r["3d-tiles"]||{},a.byteOffset=n,a.type=Vi(t,n),e.t0=a.type,e.next=e.t0===Bi.COMPOSITE?10:e.t0===Bi.BATCHED_3D_MODEL?13:e.t0===Bi.INSTANCED_3D_MODEL?16:e.t0===Bi.POINT_CLOUD?19:22;break;case 10:return e.next=12,Ns(a,t,n,r,i,Ms);case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,Ss(a,t,n,r,i);case 15:return e.abrupt("return",e.sent);case 16:return e.next=18,Cs(a,t,n,r,i);case 18:return e.abrupt("return",e.sent);case 19:return e.next=21,Ga(a,t,n,r,i);case 21:return e.abrupt("return",e.sent);case 22:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bs(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return zs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zs(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function zs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vs(e,t){if(e.content){var n=e.content.uri||e.content.url;e.contentUrl="".concat(t.basePath,"/").concat(n)}return e.id=e.contentUrl,e.lodMetricType=Yr,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return Fr;var t=e.contentUrl.split(".").pop();switch(t){case"pnts":return Hr;case"i3dm":case"b3dm":return Gr;default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return Vr;case"ADD":case"add":return zr;default:return e}}(e.refine),e}function Fs(e){var t=e.basePath,n=Vs(e.root,e),r=[];for(r.push(n);r.length>0;){var i,a=Bs(r.pop().children||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;Vs(o,{basePath:t}),r.push(o)}}catch(s){a.e(s)}finally{a.f()}}return n}function Gs(e){return Tr.a.dirname(e.url)}function Hs(e,t,n){return qs.apply(this,arguments)}function qs(){return(qs=Object(Gn.a)(In.a.mark((function e(t,n,r){var i;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i={}).content=i.content||{},0,e.next=5,Ms(t,0,n,r,i.content);case 5:return e.abrupt("return",i.content);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ws(e,t,n){return Zs.apply(this,arguments)}function Zs(){return(Zs=Object(Gn.a)(In.a.mark((function e(t,n,r){var i;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=JSON.parse((new TextDecoder).decode(t))).loader=n.loader||Xs,i.url=r.url,i.basePath=Gs(i),i.root=Fs(i),i.type=Zr,i.lodMetricType=Yr,i.lodMetricValue=i.root.lodMetricValue,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ys(){return(Ys=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n["3d-tiles"]||{},!("isTileset"in a?a.isTileset:r.url&&-1!==r.url.indexOf(".json"))){e.next=8;break}return e.next=5,Ws(t,n,r,i);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,Hs(t,n,r);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xs={id:"3d-tiles",name:"3D Tiles",version:"2.2.3",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],test:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,n,r){return Ys.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1}}},Js=Xs;function Ks(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ks(Object(n),!0).forEach((function(t){$s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ks(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ec(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}var tc=new Cn.d,nc={getPointColor:[0,0,0],pointSize:1,data:null,loadOptions:{},loader:Js,onTilesetLoad:function(e){},onTileLoad:function(e){},onTileUnload:function(e){},onTileError:function(e,t,n){}},rc=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.initializeState=function(){"onTileLoadFail"in this.props&&Vn.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null}},i.shouldUpdateState=function(e){return e.changeFlags.somethingChanged},i.updateState=function(e){var t=e.props,n=e.oldProps,r=e.changeFlags;if(t.data&&t.data!==n.data&&this._loadTileset(t.data),r.viewportChanged){var i=this.state.tileset3d;this._updateTileset(i)}},i.getPickingInfo=function(e){var t=e.info,n=e.sourceLayer,r=this.state.layerMap,i=n&&n.id;if(i){var a=i.substring(this.id.length+1),o=a.substring(a.indexOf("-")+1);t.object=r[o]&&r[o].tile}return t},i._loadTileset=function(){var e,t=(e=In.a.mark((function e(t){var n,r,i,a,o,s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,r=n.loader,i=n.loadOptions,a=Qs({},i),!r.preload){e.next=7;break}return e.next=5,r.preload(t,i);case 5:o=e.sent,Object.assign(a,o);case 7:return e.next=9,Object(Fn.a)(t,r,a);case 9:s=e.sent,c=new Ui(s,Qs({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},a)),this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(c),this.props.onTilesetLoad(c);case 14:case"end":return e.stop()}}),e,this)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ec(a,r,i,o,s,"next",e)}function s(e){ec(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}(),i._onTileLoad=function(e){this.props.onTileLoad(e),this._updateTileset(this.state.tileset3d),this.setNeedsUpdate()},i._onTileUnload=function(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)},i._updateTileset=function(e){var t=this.context,n=t.timeline,r=t.viewport;if(n&&r&&e){var i=e.update(r);this.state.frameNumber!==i&&this.setState({frameNumber:i})}},i._create3DTileLayer=function(e){if(!e.content)return null;switch(e.type){case Hr:return this._createPointCloudTileLayer(e);case Gr:return this._create3DModelTileLayer(e);case qr:return this._createSimpleMeshLayer(e);default:throw new Error("Tile3DLayer: Failed to render layer of type "+e.content.type)}},i._createPointCloudTileLayer=function(e){var t=e.content,n=t.attributes,r=t.pointCount,i=t.constantRGBA,a=t.cartographicOrigin,o=t.modelMatrix,s=n.positions,c=n.normals,u=n.colors;if(!s)return null;var l=this.props,h=l.pointSize,f=l.getPointColor;return new(this.getSubLayerClass("pointcloud",Un.a))({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:this.id+"-pointcloud-"+e.id,data:{header:{vertexCount:r},attributes:{POSITION:s,NORMAL:c,COLOR_0:u}},coordinateSystem:Ln.a.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:i||f})},i._create3DModelTileLayer=function(e){var t=e.content,n=t.gltf,r=t.instances,i=t.cartographicOrigin,a=t.modelMatrix;return new(this.getSubLayerClass("scenegraph",Bn.a))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:this.id+"-scenegraph-"+e.id,data:r||[{}],scenegraph:n,coordinateSystem:Ln.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(e){return e.modelMatrix},getPosition:function(e){return[0,0,0]}})},i._createSimpleMeshLayer=function(e){for(var t=e.content,n=t.attributes,r=t.modelMatrix,i=t.cartographicOrigin,a=t.texture,o=n.normals,s=n.texCoords,c=new Float32Array(n.positions.value.length),u=0;u<c.length;u+=3)tc.copy(n.positions.value.subarray(u,u+3)),c.set(tc,u);var l=new Nn.a({drawMode:Dn.a.TRIANGLES,attributes:{positions:c,normals:o,texCoords:s}});return new(this.getSubLayerClass("mesh",zn.a))(this.getSubLayerProps({id:"mesh"}),{id:this.id+"-mesh-"+e.id,mesh:l,data:[{}],getPosition:[0,0,0],getColor:[255,255,255],texture:a,modelMatrix:r,coordinateOrigin:i,coordinateSystem:Ln.a.METER_OFFSETS})},i.renderLayers=function(){var e=this,t=this.state,n=t.tileset3d,r=t.layerMap;return n?n.tiles.map((function(t){var n=r[t.id]&&r[t.id].layer;return t.selected?(n||(n=e._create3DTileLayer(t),r[t.id]={layer:n,tile:t}),n&&n.props&&!n.props.visible&&(n=n.clone({visible:!0}),r[t.id].layer=n),n):(n&&n.props&&n.props.visible&&(n=n.clone({visible:!1}),r[t.id].layer=n),n)})).filter(Boolean):null},r}(Mn.a);rc.layerName="Tile3DLayer",rc.defaultProps=nc;n("Ll4R");var ic,ac=1,oc=2,sc="empty",cc="scenegraph",uc="pointcloud",lc="TILES3D",hc="geometricError",fc={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(fc);function pc(e,t,n){Object(wr.a)(e instanceof ArrayBuffer);var r=new TextDecoder("utf8"),i=new Uint8Array(e,t,n);return r.decode(i)}function dc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new DataView(e);return"".concat(String.fromCharCode(n.getUint8(t+0))).concat(String.fromCharCode(n.getUint8(t+1))).concat(String.fromCharCode(n.getUint8(t+2))).concat(String.fromCharCode(n.getUint8(t+3)))}function yc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yc(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bc(e){return gc.apply(this,arguments)}function gc(){return(gc=Object(Gn.a)(In.a.mark((function e(t){var n;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.modules||{}).draco3d){e.next=3;break}return e.abrupt("return",{draco:n.draco3d.createDecoderModule()});case 3:return ic=ic||mc(t),e.next=6,ic;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mc(e){return Oc.apply(this,arguments)}function Oc(){return(Oc=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.draco&&t.draco.decoderType,e.next="js"===e.t0?3:(e.t0,7);break;case 3:return e.next=5,Object(Gi.a)("draco_decoder.js","draco",t);case 5:return n=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,Object(Gi.a)("draco_wasm_wrapper.js","draco",t);case 10:return e.t2=e.sent,e.next=13,Object(Gi.a)("draco_decoder.wasm","draco",t);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:i=e.sent,a=Object(N.a)(i,2),n=a[0],r=a[1];case 21:return n=n||Hi.a.DracoDecoderModule,e.next=24,_c(n,r);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _c(e,t){var n={};return t&&(n.wasmBinary=t),new Promise((function(t){e(vc(vc({},n),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}var wc=0,Tc=1,jc={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ec={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},kc=function(){function e(t){Object(y.a)(this,e),this.draco=t,this.drawMode="TRIANGLE"}return Object(b.a)(e,[{key:"destroy",value:function(){}},{key:"destroyGeometry",value:function(e){e&&this.draco.destroy(e.dracoGeometry)}},{key:"parseSync",value:function(e,t){var n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength);var r,i,a,o=new this.draco.Decoder,s={};try{var c=o.GetEncodedGeometryType(n);switch(c){case this.draco.TRIANGULAR_MESH:i=new this.draco.Mesh,r=o.DecodeBufferToMesh(n,i),a={type:wc,faceCount:i.num_faces(),attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;case this.draco.POINT_CLOUD:i=new this.draco.PointCloud,r=o.DecodeBufferToPointCloud(n,i),a={type:Tc,attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!r.ok()||!i.ptr){var u="DRACO decompression failed: ".concat(r.error_msg());throw i&&this.draco.destroy(i),new Error(u)}s.loaderData={header:a},this.extractDRACOGeometry(o,i,c,s),s.header={vertexCount:a.vertexCount,boundingBox:Object(Qi.a)(s.attributes)}}finally{this.draco.destroy(o),this.draco.destroy(n)}return s}},{key:"extractDRACOGeometry",value:function(e,t,n,r){var i=this.getAttributes(e,t),a=i.POSITION;if(!a)throw new Error("DRACO decompressor: No position attribute found.");return this.getPositionAttributeMetadata(a),n===this.draco.TRIANGULAR_MESH?(i.indices="TRIANGLE_STRIP"===this.drawMode?this.getMeshStripIndices(e,t):this.getMeshFaceIndices(e,t),r.mode="TRIANGLE_STRIP"===this.drawMode?5:4):r.mode=0,i.indices&&(r.indices={value:i.indices,size:1},delete i.indices),r.attributes=i,r}},{key:"getPositionAttributeMetadata",value:function(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};var t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(var n=0;n<3;++n)this.metadata.attributes.position.minValues[n]=t.min_value(n)}this.draco.destroy(t)}},{key:"getAttributes",value:function(e,t){var n={},r=t.num_points();for(var i in jc){var a=this.draco[i],o=e.GetAttributeId(t,a);if(-1!==o){var s=e.GetAttribute(t,o),c=this.getAttributeTypedArray(e,t,s,i).typedArray;n[jc[i]]={value:c,size:c.length/r}}}return n}},{key:"getMeshFaceIndices",value:function(e,t){for(var n=t.num_faces(),r=new Uint32Array(3*n),i=new this.draco.DracoInt32Array,a=0;a<n;++a){e.GetFaceFromMesh(t,a,i);var o=3*a;r[o]=i.GetValue(0),r[o+1]=i.GetValue(1),r[o+2]=i.GetValue(2)}return this.draco.destroy(i),r}},{key:"getMeshStripIndices",value:function(e,t){var n=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,n);for(var r=new Uint32Array(n.size()),i=0;i<n.size();++i)r[i]=n.GetValue(i);return this.draco.destroy(n),r}},{key:"getAttributeTypedArray",value:function(e,t,n,r){if(0===n.ptr){var i="DRACO decode bad attribute ".concat(r);throw new Error(i)}var a,o,s=Ec[n.data_type()],c=n.num_components(),u=t.num_points()*c;switch(s){case Float32Array:a=new this.draco.DracoFloat32Array,e.GetAttributeFloatForAllPoints(t,n,a),o=new Float32Array(u);break;case Int8Array:a=new this.draco.DracoInt8Array,e.GetAttributeInt8ForAllPoints(t,n,a),o=new Int8Array(u);break;case Int16Array:a=new this.draco.DracoInt16Array,e.GetAttributeInt16ForAllPoints(t,n,a),o=new Int16Array(u);break;case Int32Array:a=new this.draco.DracoInt32Array,e.GetAttributeInt32ForAllPoints(t,n,a),o=new Int32Array(u);break;case Uint8Array:a=new this.draco.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(t,n,a),o=new Uint8Array(u);break;case Uint16Array:a=new this.draco.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(t,n,a),o=new Uint16Array(u);break;case Uint32Array:a=new this.draco.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(t,n,a),o=new Uint32Array(u);break;default:throw new Error("DRACO decoder: unexpected attribute type.")}for(var l=0;l<u;l++)o[l]=a.GetValue(l);return this.draco.destroy(a),{typedArray:o,components:c}}},{key:"decode",value:function(e,t){return this.parseSync(e,t)}}]),e}();function xc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xc(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ac=Sc(Sc({},{id:"draco",name:"Draco",version:"2.2.2",extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,test:"DRACO",options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":Object(Qe.a)(WebAssembly))?"wasm":"js",libraryPath:"libs/",workerUrl:"https://unpkg.com/@loaders.gl/draco@".concat("2.2.2","/dist/draco-loader.worker.js"),localWorkerUrl:"modules/draco/dist/draco-loader.worker.dev.js"}}}),{},{parse:function(e,t,n,r){return Pc.apply(this,arguments)}});function Pc(){return(Pc=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bc(n);case 2:return a=e.sent,o=a.draco,s=new kc(o),e.prev=5,e.abrupt("return",s.parseSync(t));case 7:return e.prev=7,s.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})))).apply(this,arguments)}function Ic(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ic(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ic(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rc,Dc={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Nc=Cc(Cc({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6}),Dc),Lc=(Rc={},Object(_.a)(Rc,Dc.DOUBLE,Float64Array),Object(_.a)(Rc,Dc.FLOAT,Float32Array),Object(_.a)(Rc,Dc.UNSIGNED_SHORT,Uint16Array),Object(_.a)(Rc,Dc.UNSIGNED_INT,Uint32Array),Object(_.a)(Rc,Dc.UNSIGNED_BYTE,Uint8Array),Object(_.a)(Rc,Dc.BYTE,Int8Array),Object(_.a)(Rc,Dc.SHORT,Int16Array),Object(_.a)(Rc,Dc.INT,Int32Array),Rc),Mc={DOUBLE:Dc.DOUBLE,FLOAT:Dc.FLOAT,UNSIGNED_SHORT:Dc.UNSIGNED_SHORT,UNSIGNED_INT:Dc.UNSIGNED_INT,UNSIGNED_BYTE:Dc.UNSIGNED_BYTE,BYTE:Dc.BYTE,SHORT:Dc.SHORT,INT:Dc.INT},Uc=function(){function e(){Object(y.a)(this,e)}return Object(b.a)(e,null,[{key:"fromTypedArray",value:function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,Lc){if(Lc[t]===e)return t}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(e){var t=Mc[e];if(!t)throw new Error("Failed to convert GL type");return t}},{key:"getArrayType",value:function(e){switch(e){case Dc.UNSIGNED_SHORT_5_6_5:case Dc.UNSIGNED_SHORT_4_4_4_4:case Dc.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=Lc[e];if(!t)throw new Error("Failed to convert GL type");return t}}},{key:"getByteSize",value:function(t){return e.getArrayType(t).BYTES_PER_ELEMENT}},{key:"validate",value:function(t){return Boolean(e.getArrayType(t))}},{key:"createTypedArray",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(n.byteLength-r)/e.getByteSize(t));var a=e.getArrayType(t);return new a(n,r,i)}}]),e}(),Bc=function(){function e(t,n){Object(y.a)(this,e),this.json=t,this.buffer=n,this.featuresLength=0,this._cachedTypedArrays={}}return Object(b.a)(e,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nc.UNSIGNED_INT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,r.byteOffset):r}},{key:"getPropertyArray",value:function(e,t,n){var r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=Uc.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}},{key:"getProperty",value:function(e,t,n,r,i){var a=this.json[e];if(!a)return a;var o=this.getPropertyArray(e,t,n);if(1===n)return o[r];for(var s=0;s<n;++s)i[s]=o[n*r+s];return i}},{key:"_getTypedArrayFromBinary",value:function(e,t,n,r,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=Uc.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,r*n),a[e]=o),o}},{key:"_getTypedArrayFromArray",value:function(e,t,n){var r=this._cachedTypedArrays,i=r[e];return i||(i=Uc.createTypedArray(t,n),r[e]=i),i}}]),e}(),zc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Vc={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},Fc={SCALAR:function(e,t,n){t[n]=e},VEC2:function(e,t,n){t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:function(e,t,n){t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:function(e,t,n){t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:function(e,t,n){t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};var Gc=function(e){return void 0!==e};function Hc(e,t,n){if(!t)return null;var r=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?function(e,t){var n,r,i,a,o=e.instancesLength,s=e.classes,c=e.classIds,u=e.parentCounts,l=e.parentIds,h=o;Gc(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),Jr("classIds"),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,o));if(Gc(u))for(Gc(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),Jr("parentCounts"),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o)),a=new Uint16Array(o),Jr("parentIdsLength"),h=0,n=0;n<o;++n)a[n]=h,h+=(Jr("parentIdsLength"),u[n]);Gc(l)&&Gc(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),Jr("parentIds"),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));var f=s.length;for(n=0;n<f;++n){var p=s[n].length,d=s[n].instances,y=getBinaryProperties(p,d,t);s[n].instances=combine(y,d)}var v=new Array(f).fill(0),b=new Uint16Array(o);for(n=0;n<o;++n)r=c[n],b[n]=v[r],++v[r];var g={classes:s,classIds:c,classIndexes:b,parentCounts:u,parentIndexes:a,parentIds:l};return function(e){for(var t=e.classIds.length,n=0;n<t;++n)Wc(e,n,stack)}(g),g}(r,n):null}function qc(e,t,n){if(e){var r=e.parentCounts;return e.parentIds?n(e,t):r>0?function(e,t,n){var r=e.classIds,i=e.parentCounts,a=e.parentIds,o=e.parentIndexes,s=r.length,c=scratchVisited;c.length=Math.max(c.length,s);var u=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;)if(t=l.pop(),c[t]!==u){c[t]=u;var h=n(e,t);if(Gc(h))return h;for(var f=i[t],p=o[t],d=0;d<f;++d){var y=a[p+d];y!==t&&l.push(y)}}return null}(e,t,n):function(e,t,n){var r=!0;for(;r;){var i=n(e,t);if(Gc(i))return i;var a=e.parentIds[t];r=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,n)}}function Wc(e,t,n){var r=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=e.classIds.length;if(Gc(i)){assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(-1===n.indexOf(t),"Circular dependency detected in the batch table hierarchy."),n.push(t);for(var s=Gc(r)?r[t]:1,c=Gc(r)?a[t]:t,u=0;u<s;++u){var l=i[c+u];l!==t&&Wc(e,l,n)}n.pop(t)}}function Zc(e){return null!=e}var Yc={HIERARCHY:!0,extensions:!0,extras:!0},Xc=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var a in Object(y.a)(this,e),Object(wr.a)(r>=0),this.json=t||{},this.binary=n,this.featureCount=r,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)Yc[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Hc(this,this.json,this.binary))}return Object(b.a)(e,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,t){return this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),!!this._hierarchy&&Zc(qc(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return e.classes[r].name===t})))}},{key:"isExactClass",value:function(e,t){return Object(wr.a)("string"==typeof t,t),this.getExactClassName(e)===t}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}},{key:"hasProperty",value:function(e,t){return this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),Zc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}},{key:"getPropertyNames",value:function(e,t){var n;this._checkBatchId(e),(t=Zc(t)?t:[]).length=0;var r=Object.keys(this._properties);return(n=t).push.apply(n,Object(ba.a)(r)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}},{key:"getProperty",value:function(e,t){if(this._checkBatchId(e),Object(wr.a)("string"==typeof t,t),this._binaryProperties){var n=this._binaryProperties[t];if(Zc(n))return this._getBinaryProperty(n,e)}var r=this._properties[t];if(Zc(r))return r[e];if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(Zc(i))return i}}},{key:"setProperty",value:function(e,t,n){var r=this.featureCount;if(this._checkBatchId(e,r),Object(wr.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,n)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,n)){var a=this._properties[t];Zc(a)||(this._properties[t]=new Array(r),a=this._properties[t]),a[e]=n}}},{key:"_checkBatchId",value:function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,t){return e.unpack(e.typedArray,t)}},{key:"_setBinaryProperty",value:function(e,t,n){e.pack(n,e.typedArray,t)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var t in this._properties){var n=this._properties[t],r=this._initializeBinaryProperty(t,n);r&&((e=e||{})[t]=r)}return e}},{key:"_initializeBinaryProperty",value:function(e,t){if("byteOffset"in t){var n=t;Object(wr.a)(this.binary,"Property ".concat(e," requires a batch table binary.")),Object(wr.a)(n.type,"Property ".concat(e," requires a type."));var r=function(e,t,n,r){var i=e.componentType;Object(wr.a)(e.componentType);var a="string"==typeof i?Uc.fromName(i):i,o=zc[e.type],s=Vc[e.type],c=Fc[e.type];return n+=e.byteOffset,{values:Uc.createTypedArray(a,t,n,o*r),type:a,size:o,unpacker:s,packer:c}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,t){if(!this._hierarchy)return!1;var n=qc(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return Zc(e.classes[r].instances[t])}));return Zc(n)}},{key:"_getPropertyNamesInHierarchy",value:function(e,t){qc(this._hierarchy,e,(function(e,n){var r=e.classIds[n],i=e.classes[r].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)}))}},{key:"_getHierarchyProperty",value:function(e,t){var n=this;return qc(this._hierarchy,e,(function(e,r){var i=e.classIds[r],a=e.classes[i],o=e.classIndexes[r],s=a.instances[t];return Zc(s)?Zc(s.typedArray)?n._getBinaryProperty(s,o):s[o]:null}))}},{key:"_setHierarchyProperty",value:function(e,t,n,r){var i=this,a=qc(this._hierarchy,t,(function(e,a){var o=e.classIds[a],s=e.classes[o],c=e.classIndexes[a],u=s.instances[n];return!!Zc(u)&&(Object(wr.a)(a===t,'Inherited property "'.concat(n,'" is read-only.')),Zc(u.typedArray)?i._setBinaryProperty(u,c,r):u[c]=r,!0)}));return Zc(a)}}]),e}();function Jc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new DataView(t);if(e.magic=r.getUint32(n,!0),n+=4,e.version=r.getUint32(n,!0),n+=4,e.byteLength=r.getUint32(n,!0),n+=4,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return n}function Kc(e,t,n){var r=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=r.getUint32(n,!0),n+=4,e.header.featureTableBinaryByteLength=r.getUint32(n,!0),n+=4,e.header.batchTableJsonByteLength=r.getUint32(n,!0),n+=4,e.header.batchTableBinaryByteLength=r.getUint32(n,!0),n+=4}function Qc(e,t,n,r){return n=function(e,t,n,r){var i=e.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength;if(e.featureTableJson={BATCH_LENGTH:0},a>0){var s=pc(t,n,a);e.featureTableJson=JSON.parse(s)}return n+=a,e.featureTableBinary=new Uint8Array(t,n,o),n+=o}(e,t,n),n=function(e,t,n,r){var i=e.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=pc(t,n,a);e.batchTableJson=JSON.parse(s),n+=a,o>0&&(e.batchTableBinary=new Uint8Array(t,n,o),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=o)}return n}(e,t,n)}function $c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=e>>11&31,r=e>>5&63,i=31&e;return t[0]=n<<3,t[1]=r<<2,t[2]=i<<3,t}function eu(e,t,n){if(!(t||e&&e.batchIds&&n))return null;var r=e.batchIds,i=e.isRGB565,a=e.pointCount;if(r&&n){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var c=r[s],u=n.getProperty(c,"dimensions").map((function(e){return 255*e}));o[3*s]=u[0],o[3*s+1]=u[1],o[3*s+2]=u[2]}return{type:Nc.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),h=0;h<a;h++){var f=$c(t[h]);l[3*h]=f[0],l[3*h+1]=f[1],l[3*h+2]=f[2]}return{type:Nc.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return t&&t.length===3*a?{type:Nc.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Nc.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}function tu(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}new Ra.a,new qn.a,new Ra.a,new Ra.a,new Uint8Array(1);function nu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Object(Yn.a)(e,0,t)/t*2-1}function ru(e){return e<0?-1:1}function iu(e,t,n,r){if(tu(r),e<0||e>n||t<0||t>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=nu(e,n),r.y=nu(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){var i=r.x;r.x=(1-Math.abs(r.y))*ru(i),r.y=(1-Math.abs(i))*ru(r.y)}return r.normalize()}function au(e,t,n){return iu(e,t,255,n)}var ou=new qn.a;function su(e,t,n){return e.isQuantized?n.decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var n=new qn.a,r=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)n.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,3*i);return r}(e,t)):{type:Nc.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function cu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cu(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lu(e,t,n,r,i){return hu.apply(this,arguments)}function hu(){return(hu=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Jc(t,n,r,i),r=Kc(t,n,r),r=Qc(t,n,r),fu(t),o=pu(t),s=o.featureTable,c=o.batchTable,e.next=7,bu(t,s,c,i,a);case 7:return du(t,s,i),yu(t,s,c),vu(t,s),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fu(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function pu(e){var t=new Bc(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Nc.FLOAT,3);var r=function(e,t){var n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Nc.UNSIGNED_SHORT,1),e.batchIds)){var r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;n=new Xc(i,a,r)}return n}(e,t);return{featureTable:t,batchTable:r}}function du(e,t,n){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Nc.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var r=t.getPropertyArray("POSITION_QUANTIZED",Nc.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Nc.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Nc.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=su(e,r,n)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function yu(e,t,n){if(!e.attributes.colors){var r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",Nc.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",Nc.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",Nc.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=eu(e,r,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Nc.UNSIGNED_BYTE,4))}function vu(e,t){if(!e.attributes.normals){var n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",Nc.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",Nc.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){for(var n=new Float32Array(3*e.pointsLength),r=0;r<e.pointsLength;r++)au(t[2*r],t[2*r+1],ou),ou.toArray(n,3*r);return{type:Nc.FLOAT,size:2,value:n}}return{type:Nc.FLOAT,size:2,value:t}}(e,n)}}function bu(e,t,n,r,i){return gu.apply(this,arguments)}function gu(){return(gu=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c,u,l,h,f,p;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((u=r&&r.getExtension("3DTILES_draco_point_compression"))&&(c=u.properties),!(l=n.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(s=l.properties,h=l.byteOffset,f=l.byteLength,s&&Number.isFinite(h)&&f){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=t.featureTableBinary.slice(h,h+f),t.hasPositions=Number.isFinite(s.POSITION),t.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),t.hasNormals=Number.isFinite(s.NORMAL),t.hasBatchIds=Number.isFinite(s.BATCH_ID),t.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){e.next=17;break}return e.abrupt("return",!0);case 17:return p={buffer:o,properties:uu(uu({},s),c),featureTableProperties:s,batchTableProperties:c,dequantizeInShader:!1},e.next=20,mu(t,p,i,a);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mu(e,t,n,r){return Ou.apply(this,arguments)}function Ou(){return(Ou=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s,c,u,l,h,f,p,d;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.parse,e.next=3,a(n.buffer,Ac,{});case 3:o=e.sent,s=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,u=o.attributes.NORMAL&&o.attributes.NORMAL.value,l=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=s&&o.attributes.POSITION.value.quantization,f=u&&o.attributes.NORMAL.value.quantization,h&&(p=o.POSITION.data.quantization,d=p.range,t.quantizedVolumeScale=new qn.a(d,d,d),t.quantizedVolumeOffset=new qn.a(p.minValues),t.quantizedRange=(1<<p.quantizationBits)-1,t.isQuantizedDraco=!0),f&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),t.attributes={positions:s,colors:eu(t,c),normals:u,batchIds:l};case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _u(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function wu(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return n.substr(0,n.lastIndexOf("/")+1)+e}function Tu(e,t,n){var r=e.bufferViews[n];_u(r);var i=t[r.buffer];_u(i);var a=(r.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,r.byteLength)}var ju=["SCALAR","VEC2","VEC3","VEC4"],Eu=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),ku={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xu={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Su={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Au(e){return ju[e-1]||ju[0]}function Pu(e){var t=Eu.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Iu(e,t){var n=Su[e.componentType],r=ku[e.type],i=xu[e.componentType],a=e.count*r,o=e.count*r*i;return _u(o>=0&&o<=t.byteLength),{ArrayType:n,length:a,byteLength:o}}var Cu=function(){function e(t){if(Object(y.a)(this,e),t instanceof e)return t;t||(t={json:{version:2,buffers:[]},buffers:[]}),this.gltf=t,_u(this.gltf.json)}return Object(b.a)(e,[{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"getExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),n=this.json.extensions||{};return t?n[e]||!0:null}},{key:"getRequiredExtension",value:function(e){return this.getRequiredExtensions().find((function(t){return t===e}))?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,t){if("object"===Object(Qe.a)(t))return t;var n=this.json[e]&&this.json[e][t];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return n}},{key:"getTypedArrayForBufferView",value:function(e){var t=(e=this.getBufferView(e)).buffer,n=this.gltf.buffers[t];_u(n);var r=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=Iu(e,t),i=r.ArrayType,a=r.length;return new i(n,t.byteOffset+e.byteOffset,a)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(n,r,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,n){return _u(n),e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}},{key:"removeObjectExtension",value:function(e,t){return delete(e.extensions||{})[t],this}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _u(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _u(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}},{key:"setObjectExtension",value:function(e,t,n){(e.extensions||{})[t]=n}},{key:"addMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=this._addAttributes(e),i={primitives:[{attributes:r,indices:t,mode:n}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){t=t||Object(oo.a)(e);var n={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=e.byteLength;_u(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var n={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Object(no.c)(t),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var n={bufferView:e,type:Au(t.size),componentType:t.componentType,count:t.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},n=this.addBufferView(e),r={size:t.size,componentType:Pu(e),count:Math.round(e.length/t.size)};return this.addAccessor(n,Object.assign(r,t))}},{key:"createBinaryChunk",value:function(){if(!this.arrayBuffer){for(var e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t),r=0,i=0;i<this.sourceBuffers.length;i++){var a=this.sourceBuffers[i];r=Object(no.a)(a,n,r)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}}},{key:"_removeStringFromArray",value:function(e,t){for(var n=!0;n;){var r=e.indexOf(t);r>-1?e.splice(r,1):n=!1}}},{key:"json",get:function(){return this.gltf.json}}]),e}();function Ru(e){var t={};for(var n in e){var r=e[n];if("indices"!==n){var i=Du(r);t[n]=i}}return t}function Du(e,t){var n=function(e,t){var n=e,r=1,i=0;e&&e.value&&(n=e.value,r=e.size||1);n&&(ArrayBuffer.isView(n)||(n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(n&&!(e instanceof t))return new t(e);return e}(n,Float32Array)),i=n.length/r);return{buffer:n,size:r,count:i}}(e),r=n.buffer,i=n.size;return{value:r,size:i,bufferView:null,byteOffset:0,count:n.count,type:Au(i),componentType:Pu(r)}}var Nu=In.a.mark(qu);function Lu(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Mu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Mu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Uu(e,t,n){return Bu.apply(this,arguments)}function Bu(){return(Bu=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o,s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.gltf.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:i=new Cu(t),a=[],o=Lu(qu(i));try{for(o.s();!(s=o.n()).done;)c=s.value,i.getObjectExtension(c,"KHR_draco_mesh_compression")&&a.push(Vu(c,i,n,r))}catch(u){o.e(u)}finally{o.f()}return e.next=8,Promise.all(a);case 8:i.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zu(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new Cu(e),i=Lu(r.json.meshes||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;Gu(a,n),r.addRequiredExtension("KHR_draco_mesh_compression")}}catch(o){i.e(o)}finally{i.f()}}function Vu(e,t,n,r){return Fu.apply(this,arguments)}function Fu(){return(Fu=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o,s,c,u;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getObjectExtension(t,"KHR_draco_mesh_compression"),o=n.getTypedArrayForBufferView(a.bufferView),s=Object(no.b)(o.buffer,o.byteOffset),c=i.parse,e.next=6,c(s,Ac,r,i);case 6:u=e.sent,t.attributes=Ru(u.attributes),u.indices&&(t.indices=Du(u.indices)),Hu(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter||!r.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");var a=r.DracoWriter.encodeSync({attributes:e}),o=i.parseSync,s=o({attributes:e}),c=r._addFauxAttributes(s.attributes),u=r.addBufferView(a),l={primitives:[{attributes:c,mode:n,extensions:Object(_.a)({},"KHR_draco_mesh_compression",{bufferView:u,attributes:c})}]};return l}function Hu(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}function qu(e){var t,n,r,i,a,o;return In.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=Lu(e.json.meshes||[]),s.prev=1,t.s();case 3:if((n=t.n()).done){s.next=24;break}r=n.value,i=Lu(r.primitives),s.prev=6,i.s();case 8:if((a=i.n()).done){s.next=14;break}return o=a.value,s.next=12,o;case 12:s.next=8;break;case 14:s.next=19;break;case 16:s.prev=16,s.t0=s.catch(6),i.e(s.t0);case 19:return s.prev=19,i.f(),s.finish(19);case 22:s.next=3;break;case 24:s.next=29;break;case 26:s.prev=26,s.t1=s.catch(1),t.e(s.t1);case 29:return s.prev=29,t.f(),s.finish(29);case 32:case"end":return s.stop()}}),Nu,null,[[1,26,29,32],[6,16,19,22]])}function Wu(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Zu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Zu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yu(e,t){var n=new Cu(e),r=n.json,i=n.getExtension("KHR_lights_punctual");i&&(n.json.lights=i.lights,n.removeExtension("KHR_lights_punctual"));var a,o=Wu(r.nodes||[]);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=n.getObjectExtension(s,"KHR_lights_punctual");c&&(s.light=c.light),n.removeObjectExtension(s,"KHR_lights_punctual")}}catch(u){o.e(u)}finally{o.f()}}function Xu(e,t){var n=new Cu(e),r=n.json;if(r.lights){var i=n.addExtension("KHR_lights_punctual");_u(!i.lights),i.lights=r.lights,delete r.lights}if(n.json.lights){var a,o=Wu(n.json.lights);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.node;n.addObjectExtension(c,"KHR_lights_punctual",s)}}catch(u){o.e(u)}finally{o.f()}delete n.json.lights}}function Ju(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ku(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ku(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ku(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qu(e,t){var n=new Cu(e),r=n.json;n.removeExtension("KHR_materials_unlit");var i,a=Ju(r.materials||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.extensions&&o.extensions.KHR_materials_unlit&&(o.unlit=!0),n.removeObjectExtension(o,"KHR_materials_unlit")}}catch(s){a.e(s)}finally{a.f()}}function $u(e,t){var n=new Cu(e),r=n.json;if(n.materials){var i,a=Ju(r.materials);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.unlit&&(delete o.unlit,n.addObjectExtension(o,"KHR_materials_unlit"),n.addExtension("KHR_materials_unlit"))}}catch(s){a.e(s)}finally{a.f()}}}function el(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return tl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function tl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nl(e,t){var n=new Cu(e),r=n.json,i=n.getExtension("KHR_techniques_webgl");if(i){var a,o=function(e,t){var n=e.programs,r=void 0===n?[]:n,i=e.shaders,a=void 0===i?[]:i,o=e.techniques,s=void 0===o?[]:o,c=new TextDecoder;return a.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=c.decode(t.getTypedArrayForBufferView(e.bufferView))})),r.forEach((function(e){e.fragmentShader=a[e.fragmentShader],e.vertexShader=a[e.vertexShader]})),s.forEach((function(e){e.program=r[e.program]})),s}(i,n),s=el(r.materials||[]);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=n.getObjectExtension(c,"KHR_techniques_webgl");u&&(c.technique=Object.assign({},u,o[u.technique]),c.technique.values=il(c.technique,n)),n.removeObjectExtension(c,"KHR_techniques_webgl")}}catch(l){s.e(l)}finally{s.f()}n.removeExtension("KHR_techniques_webgl")}}function rl(e,t){}function il(e,t){var n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)})),Object.keys(n).forEach((function(e){"object"===Object(Qe.a)(n[e])&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))})),n}var al={KHR_draco_mesh_compression:s,KHR_lights_punctual:c,KHR_materials_unlit:u,KHR_techniques_webgl:l};function ol(e){return sl.apply(this,arguments)}function sl(){return(sl=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o,s=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2?s[2]:void 0,n.gltf=n.gltf||{},e.t0=In.a.keys(al);case 4:if((e.t1=e.t0()).done){e.next=14;break}if(i=e.t1.value,a=n.gltf.excludeExtensions||{},i in a&&!a[i]){e.next=12;break}return o=al[i],e.next=12,o.decode(t,n,r);case 12:e.next=4;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var cl;function ul(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function ll(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new DataView(e),i=n.magic,a=void 0===i?1735152710:i,o=r.getUint32(t,!1);return o===a||1735152710===o}function hl(e,t,n,r){for(;n+8<=e.header.byteLength;){var i=t.getUint32(n+0,!0),a=t.getUint32(n+4,!0);switch(n+=8,a){case 1313821514:fl(e,t,n,i,r);break;case 5130562:pl(e,t,n,i,r);break;case 0:r.glb.strict||fl(e,t,n,i,r);break;case 1:r.glb.strict||pl(e,t,n,i,r)}n+=Object(no.c)(i)}return n}function fl(e,t,n,r,i){var a=new Uint8Array(t.buffer,n,r),o=new TextDecoder("utf8").decode(a);e.json=JSON.parse(o)}function pl(e,t,n,r,i){e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:t.buffer})}function dl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dl(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bl={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},gl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ml={magFilter:gl.TEXTURE_MAG_FILTER,minFilter:gl.TEXTURE_MIN_FILTER,wrapS:gl.TEXTURE_WRAP_S,wrapT:gl.TEXTURE_WRAP_T},Ol=(cl={},Object(_.a)(cl,gl.TEXTURE_MAG_FILTER,gl.LINEAR),Object(_.a)(cl,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_LINEAR),Object(_.a)(cl,gl.TEXTURE_WRAP_S,gl.REPEAT),Object(_.a)(cl,gl.TEXTURE_WRAP_,gl.REPEAT),cl);var _l=function(){function e(){Object(y.a)(this,e)}return Object(b.a)(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.json,r=e.buffers,i=void 0===r?[]:r,a=e.images,o=void 0===a?[]:a,s=e.baseUri,c=void 0===s?"":s;return _u(n),this.baseUri=c,this.json=n,this.buffers=i,this.images=o,this._resolveTree(this.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this;e.bufferViews&&(e.bufferViews=e.bufferViews.map((function(e,n){return t._resolveBufferView(e,n)}))),e.images&&(e.images=e.images.map((function(e,n){return t._resolveImage(e,n)}))),e.samplers&&(e.samplers=e.samplers.map((function(e,n){return t._resolveSampler(e,n)}))),e.textures&&(e.textures=e.textures.map((function(e,n){return t._resolveTexture(e,n)}))),e.accessors&&(e.accessors=e.accessors.map((function(e,n){return t._resolveAccessor(e,n)}))),e.materials&&(e.materials=e.materials.map((function(e,n){return t._resolveMaterial(e,n)}))),e.meshes&&(e.meshes=e.meshes.map((function(e,n){return t._resolveMesh(e,n)}))),e.nodes&&(e.nodes=e.nodes.map((function(e,n){return t._resolveNode(e,n)}))),e.skins&&(e.skins=e.skins.map((function(e,n){return t._resolveSkin(e,n)}))),e.scenes&&(e.scenes=e.scenes.map((function(e,n){return t._resolveScene(e,n)}))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,t){if("object"===Object(Qe.a)(t))return t;var n=this.json[e]&&this.json[e][t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}},{key:"_resolveScene",value:function(e,t){var n=this;return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((function(e){return n.getNode(e)})),e}},{key:"_resolveNode",value:function(e,t){var n=this;return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((function(e){return n.getNode(e)}))),void 0!==e.mesh&&(e.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,t){var n=this;return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((function(e){var t=(e=yl({},e)).attributes;for(var r in e.attributes={},t)e.attributes[r]=n.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=n.getAccessor(e.indices)),void 0!==e.material&&(e.material=n.getMaterial(e.material)),e}))),e}},{key:"_resolveMaterial",value:function(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture=yl({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=yl({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=yl({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.pbrMetallicRoughness){e.pbrMetallicRoughness=yl({},e.pbrMetallicRoughness);var n=e.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture=yl({},n.baseColorTexture),n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture=yl({},n.metallicRoughnessTexture),n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,t){var n,r;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(n=e.componentType,bl[n]),e.components=(r=e.type,vl[r]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var i=e.bufferView.buffer,a=Iu(e,e.bufferView),o=a.ArrayType,s=a.length,c=(e.bufferView.byteOffset||0)+i.byteOffset;e.value=new o(i.arrayBuffer,c,s)}return e}},{key:"_resolveTexture",value:function(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):Ol,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,t){for(var n in e.id=e.id||"sampler-".concat(t),e.parameters={},e){var r=this._enumSamplerParameter(n);void 0!==r&&(e.parameters[r]=e[n])}return e}},{key:"_enumSamplerParameter",value:function(e){return ml[e]}},{key:"_resolveImage",value:function(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));var n=this.images[t];return n&&(e.image=n),e}},{key:"_resolveBufferView",value:function(e,t){e.id=e.id||"bufferView-".concat(t);var n=e.buffer;e.buffer=this.buffers[n];var r=this.buffers[n].arrayBuffer,i=this.buffers[n].byteOffset||0;return"byteOffset"in e&&(i+=e.byteOffset),e.data=new Uint8Array(r,i,e.byteLength),e}},{key:"_resolveCamera",value:function(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}]),e}();function wl(e,t){return(new _l).postProcess(e,t)}function Tl(e,t){return jl.apply(this,arguments)}function jl(){return(jl=Object(Gn.a)(In.a.mark((function e(t,n){var r,i,a,o,s,c,u=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:0,i=u.length>3?u[3]:void 0,a=u.length>4?u[4]:void 0,El(t,n,r,i),o=[],i.gltf.loadImages&&(s=Sl(t,i,a),o.push(s)),!i.gltf.loadBuffers){e.next=9;break}return e.next=9,kl(t,i,a);case 9:return c=ol(t,i,a),o.push(c),e.next=13,Promise.all(o);case 13:return e.abrupt("return",i.gltf.postProcess?wl(t,i):t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function El(e,t,n,r){(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!ll(t,n,r))&&(t=(new TextDecoder).decode(t));if("string"==typeof t)e.json=Object(to.a)(t);else if(t instanceof ArrayBuffer){var i={};n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=new DataView(t);e.type=ul(i,n+0),e.version=i.getUint32(n+4,!0);var a=i.getUint32(n+8,!0);return e.header={byteOffset:n,byteLength:a},Object(wr.a)(2===e.version,"Invalid GLB version ".concat(e.version,". Only supports v2.")),Object(wr.a)(e.header.byteLength>20),e.json={},e.binChunks=[],hl(e,i,n+12,r),n+e.header.byteLength}(i,t,n,r),_u("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else _u(!1,"GLTF: must be ArrayBuffer or string");var a=e.json.buffers||[];if(e.buffers=new Array(a.length).fill(null),e._glb&&e._glb.header.hasBinChunk){var o=e._glb.binChunks;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}var s=e.json.images||[];e.images=new Array(s.length).fill({})}function kl(e,t,n){return xl.apply(this,arguments)}function xl(){return(xl=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o,s,c,u;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<t.json.buffers.length)){e.next=18;break}if(!(a=t.json.buffers[i]).uri){e.next=15;break}return _u(o=r.fetch),s=wu(a.uri,n),e.next=9,o(s);case 9:return c=e.sent,e.next=12,c.arrayBuffer();case 12:u=e.sent,t.buffers[i]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri;case 15:++i,e.next=1;break;case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sl(e,t,n){return Al.apply(this,arguments)}function Al(){return(Al=Object(Gn.a)(In.a.mark((function e(t,n,r){var i,a,o;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.json.images||[],a=[],o=0;o<i.length;++o)a.push(Pl(t,i[o],o,n,r));return e.next=5,Promise.all(a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pl(e,t,n,r,i){return Il.apply(this,arguments)}function Il(){return(Il=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s,c,u,l,h,f;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.fetch,s=a.parse,!n.uri){e.next=9;break}return u=wu(n.uri,i),e.next=5,o(u);case 5:return l=e.sent,e.next=8,l.arrayBuffer();case 8:c=e.sent;case 9:return Number.isFinite(n.bufferView)&&(h=Tu(t.json,t.buffers,n.bufferView),c=Object(no.b)(h.buffer,h.byteOffset,h.byteLength)),_u(c,"glTF image has no data"),e.next=13,s(c,eo.a,{},a);case 13:f=e.sent,t.images[r]=f;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cl(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dl={id:"gltf",name:"glTF",version:"2.2.2",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,test:"glTF",parse:function(e){return Ll.apply(this,arguments)},options:{gltf:{loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}},Nl=Dl;function Ll(){return(Ll=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o,s=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2?s[2]:void 0,(n=Rl(Rl({},Dl.options),n)).gltf=Rl(Rl({},Dl.options.gltf),n.gltf),Ml(n),i=n.byteOffset,a=void 0===i?0:i,o={},e.next=9,Tl(o,t,a,n,r);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ml(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess)}var Ul=0,Bl=1;function zl(e,t,n){e.rotateYtoZ=!0;var r=e.byteOffset+e.byteLength-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");return e.gltfArrayBuffer=Object(no.b)(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,n%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}function Vl(e,t,n,r){return Fl.apply(this,arguments)}function Fl(){return(Fl=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a,o;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gl(t,n,r),!r.loadGLTF){e.next=15;break}if(a=i.parse,o=i.fetch,!t.gltfUrl){e.next=8;break}return e.next=6,o(t.gltfUrl,r);case 6:t.gltfArrayBuffer=e.sent,t.gltfByteOffset=0;case 8:if(!t.gltfArrayBuffer){e.next=15;break}return e.next=11,a(t.gltfArrayBuffer,Nl,r,i);case 11:t.gltf=e.sent,delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gl(e,t,n){switch(t){case Ul:var r=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(r);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Bl:break;default:throw new Error("b3dm: Illegal glTF format field")}}function Hl(e,t,n,r,i){return ql.apply(this,arguments)}function ql(){return(ql=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){var o,s;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wl(t,n,r,i,a),e.next=3,Vl(t,Bl,i,a);case 3:return o=t.gltf||{},(s=o.extensions)&&s.CESIUM_RTC&&(t.rtcCenter=s.CESIUM_RTC.center),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wl(e,t,n,r,i){n=zl(e,t,n=Qc(e,t,n=Kc(e,t,n=Jc(e,t,n,r))));var a=new Bc(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",Nc.FLOAT,3),n}function Zl(e,t,n,r,i){return Yl.apply(this,arguments)}function Yl(){return(Yl=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a){return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Xl(t,n,r,i,a),e.next=3,Vl(t,t.gltfFormat,i,a);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xl(e,t,n,r,i){if(n=Jc(e,t,n,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));n=Kc(e,t,n);var a=new DataView(t);if(e.gltfFormat=a.getUint32(n,!0),n=zl(e,t,n=Qc(e,t,n+=4)),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new Bc(e.featureTableJson,e.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",Nc.FLOAT,3);new Xc(e.batchTableJson,e.batchTableBinary,s);return function(e,t,n,r){for(var i=[new Array(r),e._batchTable][0],a=new qn.a,o=(new qn.a,new qn.a,new qn.a,new Kr.a),s=new Is.a,c=new qn.a,u={},l=new Hn.a,h=[],f=[],p=new qn.a,d=new qn.a,y=0;y<r;y++){var v=void 0;if(t.hasProperty("POSITION"))v=t.getProperty("POSITION",Nc.FLOAT,3,y,a);else if(t.hasProperty("POSITION_QUANTIZED")){v=t.getProperty("POSITION_QUANTIZED",Nc.UNSIGNED_SHORT,3,y,a);var b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Nc.FLOAT,3,p);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var g=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Nc.FLOAT,3,d);if(!g)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var m=0;m<3;m++)v[m]=v[m]/65535*g[m]+b[m]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(v),u.translation=a,e.normalUp=t.getProperty("NORMAL_UP",Nc.FLOAT,3,y,h),e.normalRight=t.getProperty("NORMAL_RIGHT",Nc.FLOAT,3,y,f);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Nc.UNSIGNED_SHORT,2,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Nc.UNSIGNED_SHORT,2,f),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(Or.WGS84.eastNorthUpToFixedFrame(a,l),l.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),u.rotation=s,c.set(1,1,1);var O=t.getProperty("SCALE",Nc.FLOAT,1,y);Number.isFinite(O)&&c.multiplyByScalar(O);var _=t.getProperty("SCALE_NON_UNIFORM",Nc.FLOAT,3,y,h);_&&c.scale(_),u.scale=c;var w=t.getProperty("BATCH_ID",Nc.UNSIGNED_SHORT,1,y);void 0===w&&(w=y);var T=(new Hn.a).fromQuaternion(u.rotation);l.identity(),l.translate(u.translation),l.multiplyRight(T),l.scale(u.scale);var j=l.clone();i[y]={modelMatrix:j,batchId:w}}e.instances=i}(e,o,0,s),n}function Jl(e,t,n,r,i,a){return Kl.apply(this,arguments)}function Kl(){return(Kl=Object(Gn.a)(In.a.mark((function e(t,n,r,i,a,o){var s,c;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Jc(t,n,r,i),s=new DataView(n),t.tilesLength=s.getUint32(r,!0),r+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-r>12)){e.next=13;break}return c={},t.tiles.push(c),e.next=10,o(n,r,i,a,c);case 10:r=e.sent,e.next=5;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ql(e){return $l.apply(this,arguments)}function $l(){return($l=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:0,r=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,a=o.length>4&&void 0!==o[4]?o[4]:{},r=r["3d-tiles"]||{},a.byteOffset=n,a.type=dc(t,n),e.t0=a.type,e.next=e.t0===fc.COMPOSITE?10:e.t0===fc.BATCHED_3D_MODEL?13:e.t0===fc.INSTANCED_3D_MODEL?16:e.t0===fc.POINT_CLOUD?19:22;break;case 10:return e.next=12,Jl(a,t,n,r,i,Ql);case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,Hl(a,t,n,r,i);case 15:return e.abrupt("return",e.sent);case 16:return e.next=18,Zl(a,t,n,r,i);case 18:return e.abrupt("return",e.sent);case 19:return e.next=21,lu(a,t,n,r,i);case 21:return e.abrupt("return",e.sent);case 22:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function eh(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return th(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return th(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function th(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nh(e,t){if(e.content){var n=e.content.uri||e.content.url;e.contentUrl="".concat(t.basePath,"/").concat(n)}return e.id=e.contentUrl,e.lodMetricType=hc,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return sc;var t=e.contentUrl.split(".").pop();switch(t){case"pnts":return uc;case"i3dm":case"b3dm":return cc;default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return oc;case"ADD":case"add":return ac;default:return e}}(e.refine),e}function rh(e){var t=e.basePath,n=nh(e.root,e),r=[];for(r.push(n);r.length>0;){var i,a=eh(r.pop().children||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;nh(o,{basePath:t}),r.push(o)}}catch(s){a.e(s)}finally{a.f()}}return n}function ih(e){return Tr.a.dirname(e.url)}function ah(e,t,n){return oh.apply(this,arguments)}function oh(){return(oh=Object(Gn.a)(In.a.mark((function e(t,n,r){var i;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i={}).content=i.content||{},0,e.next=5,Ql(t,0,n,r,i.content);case 5:return e.abrupt("return",i.content);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sh(e,t,n){return ch.apply(this,arguments)}function ch(){return(ch=Object(Gn.a)(In.a.mark((function e(t,n,r){var i;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=JSON.parse((new TextDecoder).decode(t))).loader=n.loader||lh,i.url=r.url,i.basePath=ih(i),i.root=rh(i),i.type=lc,i.lodMetricType=hc,i.lodMetricValue=i.root.lodMetricValue,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function uh(){return(uh=Object(Gn.a)(In.a.mark((function e(t,n,r,i){var a;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n["3d-tiles"]||{},!("isTileset"in a?a.isTileset:r.url&&-1!==r.url.indexOf(".json"))){e.next=8;break}return e.next=5,sh(t,n,r,i);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,ah(t,n,r);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var lh={id:"3d-tiles",name:"3D Tiles",version:"2.2.2",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],test:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,n,r){return uh.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1}}},hh=lh,fh=n("OauZ");function ph(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ph(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ph(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yh(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function vh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bh="https://api.cesium.com/v1/assets";function gh(e,t){return mh.apply(this,arguments)}function mh(){return(mh=Object(Gn.a)(In.a.mark((function e(t,n){var r,i,a,o,s,c,u;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=6;break}return e.next=3,Oh(t);case 3:r=e.sent,i=yh(r.items);try{for(i.s();!(a=i.n()).done;)"3DTILES"===(o=a.value).type&&(n=o.id)}catch(l){i.e(l)}finally{i.f()}case 6:return e.next=8,wh(t,n);case 8:return s=e.sent,c=s.type,u=s.url,Object(wr.a)("3DTILES"===c&&u),s.headers={Authorization:"Bearer ".concat(s.accessToken)},e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oh(e){return _h.apply(this,arguments)}function _h(){return(_h=Object(Gn.a)(In.a.mark((function e(t){var n,r;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(wr.a)(t),bh,n={Authorization:"Bearer ".concat(t)},e.next=5,Object(fh.a)("https://api.cesium.com/v1/assets",{headers:n,throws:!0});case 5:return r=e.sent,e.next=8,r.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wh(e,t){return Th.apply(this,arguments)}function Th(){return(Th=Object(Gn.a)(In.a.mark((function e(t,n){var r,i,a,o,s;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(wr.a)(t,n),r={Authorization:"Bearer ".concat(t)},i="".concat(bh,"/").concat(n),e.next=5,Object(fh.a)("".concat(i),{headers:r,throws:!0});case 5:return a=e.sent,e.next=8,a.json();case 8:return o=e.sent,e.next=11,Object(fh.a)("".concat(i,"/endpoint"),{headers:r,throws:!0});case 11:return a=e.sent,e.next=14,a.json();case 14:return s=e.sent,o=dh(dh({},o),s),e.abrupt("return",o);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Eh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jh(Object(n),!0).forEach((function(t){Object(_.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kh(){return(kh=Object(Gn.a)(In.a.mark((function e(t){var n,r,i,a,o=arguments;return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=o.length>1&&void 0!==o[1]?o[1]:{})["cesium-ion"]||{},r=n.accessToken,i=n.assetId,Number.isFinite(i)||(a=t.match(/\/([0-9]+)\/tileset.json/),i=a&&a[1]),e.abrupt("return",gh(r,i));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xh,Sh=Eh(Eh({},hh),{},{id:"cesium-ion",name:"Cesium Ion",preload:function(e){return kh.apply(this,arguments)},parse:(xh=Object(Gn.a)(In.a.mark((function e(t,n,r,i){return In.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n["3d-tiles"]=n["cesium-ion"],n.loader=Sh,e.abrupt("return",hh.parse(t,n,r,i));case 3:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return xh.apply(this,arguments)}),options:{"cesium-ion":hh.options["3d-tiles"]}}),Ah=Sh;function Ph(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ih(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ph(Object(n),!0).forEach((function(t){Ch(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ph(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ch(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rh={latitude:40,longitude:-75,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:17};function Dh(e){var t=e.mapStyle,n=void 0===t?"mapbox://styles/uberdata/cive485h000192imn6c6cc8fc":t,r=e.updateAttributions,i=Object(h.useState)(Rh),a=i[0],o=i[1],s=new rc({id:"tile-3d-layer",pointSize:2,data:"https://assets.cesium.com/43978/tileset.json",loader:Ah,loadOptions:{"cesium-ion":{accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlYWMxMzcyYy0zZjJkLTQwODctODNlNi01MDRkZmMzMjIxOWIiLCJpZCI6OTYyMCwic2NvcGVzIjpbImFzbCIsImFzciIsImdjIl0sImlhdCI6MTU2Mjg2NjI3M30.1FNiClUyk00YH_nWfSGpiQAjR5V2OvREDq1PJ5QMjWQ"}},onTilesetLoad:function(e){var t=e.cartographicCenter,n=e.zoom;o(Ih(Ih({},Rh),{},{longitude:t[0],latitude:t[1],zoom:n})),r&&r(e.credits&&e.credits.attributions)}});return f.a.createElement(An.a,{layers:[s],initialViewState:a,controller:!0},f.a.createElement(me,{reuseMaps:!0,mapStyle:n,mapboxApiAccessToken:"pk.eyJ1IjoidWJlcmRhdGEiLCJhIjoiY2pwY3owbGFxMDVwNTNxcXdwMms2OWtzbiJ9.1PPVl0VLUQgqrosrI2nUhg",preventStyleDiffing:!0}))}var Nh=n("CtqP");var Lh=function(e){var t,n;function r(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this)._updateAttributions=function(e){t.props.onStateChange({attributions:e})},t}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.renderInfo=function(e){if(!e.attributions)return null;var t=e.attributions;return f.a.createElement("div",{style:{marginTop:"0.5cm"}},f.a.createElement("div",{style:{textAlign:"center",borderStyle:"groove"}},Boolean(t.length)&&f.a.createElement("b",null,"Tileset Credentials"),t.map((function(e){return f.a.createElement("div",{key:e.html,dangerouslySetInnerHTML:{__html:e.html}})}))))},r.prototype.render=function(){return f.a.createElement(Dh,Object.assign({},this.props,{updateAttributions:this._updateAttributions}))},r}(h.Component);Lh.title="City of Melbourne 3D Point Cloud",Lh.code=p.b+"/examples/website/3d-tiles",Lh.parameters={},Lh.mapStyle=p.c.DARK;t.default=Object(Nh.a)(Lh)},evtk:function(e,t,n){"use strict";(function(e){n("LagC"),n("pS08"),n("E5k/"),n("R48M"),n("HQhv"),n("JHok"),n("sc67");var r=n("q1tI");function i(t){var n;n="undefined"!=typeof window?window:"undefined"!=typeof self?self:e;var r,i,a="undefined"!=typeof document&&document.attachEvent;if(!a){var o=(i=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(e){return n.setTimeout(e,20)},function(e){return i(e)}),s=(r=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout,function(e){return r(e)}),c=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,r=t.lastElementChild,i=n.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,i.style.width=n.offsetWidth+1+"px",i.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},u=function(e){if(!(e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;c(this),this.__resizeRAF__&&s(this.__resizeRAF__),this.__resizeRAF__=o((function(){(function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height})(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))}},l=!1,h="",f="animationstart",p="Webkit Moz O ms".split(" "),d="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),y=document.createElement("fakeelement");if(void 0!==y.style.animationName&&(l=!0),!1===l)for(var v=0;v<p.length;v++)if(void 0!==y.style[p[v]+"AnimationName"]){h="-"+p[v].toLowerCase()+"-",f=d[v],l=!0;break}var b="resizeanim",g="@"+h+"keyframes "+b+" { from { opacity: 0; } to { opacity: 0; } } ",m=h+"animation: 1ms "+b+"; "}return{addResizeListener:function(e,r){if(a)e.attachEvent("onresize",r);else{if(!e.__resizeTriggers__){var i=e.ownerDocument,o=n.getComputedStyle(e);o&&"static"==o.position&&(e.style.position="relative"),function(e){if(!e.getElementById("detectElementResize")){var n=(g||"")+".resize-triggers { "+(m||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',r=e.head||e.getElementsByTagName("head")[0],i=e.createElement("style");i.id="detectElementResize",i.type="text/css",null!=t&&i.setAttribute("nonce",t),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(e.createTextNode(n)),r.appendChild(i)}}(i),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=i.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),c(e),e.addEventListener("scroll",u,!0),f&&(e.__resizeTriggers__.__animationListener__=function(t){t.animationName==b&&c(e)},e.__resizeTriggers__.addEventListener(f,e.__resizeTriggers__.__animationListener__))}e.__resizeListeners__.push(r)}},removeResizeListener:function(e,t){if(a)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",u,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(f,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(n){}}}}}var a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u=function(e){function t(){var e,n,r;a(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={height:r.props.defaultHeight||0,width:r.props.defaultWidth||0},r._onResize=function(){var e=r.props,t=e.disableHeight,n=e.disableWidth,i=e.onResize;if(r._parentNode){var a=r._parentNode.offsetHeight||0,o=r._parentNode.offsetWidth||0,s=window.getComputedStyle(r._parentNode)||{},c=parseInt(s.paddingLeft,10)||0,u=parseInt(s.paddingRight,10)||0,l=parseInt(s.paddingTop,10)||0,h=parseInt(s.paddingBottom,10)||0,f=a-l-h,p=o-c-u;(!t&&r.state.height!==f||!n&&r.state.width!==p)&&(r.setState({height:a-l-h,width:o-c-u}),i({height:a,width:o}))}},r._setRef=function(e){r._autoSizer=e},c(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=i(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,i=e.disableHeight,a=e.disableWidth,o=e.style,c=this.state,u=c.height,l=c.width,h={overflow:"visible"},f={},p=!1;return i||(0===u&&(p=!0),h.height=0,f.height=u),a||(0===l&&(p=!0),h.width=0,f.width=l),Object(r.createElement)("div",{className:n,ref:this._setRef,style:s({},h,o)},!p&&t(f))}}]),t}(r.PureComponent);u.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}},t.a=u}).call(this,n("yLpj"))},oCaT:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={};n.r(r),n.d(r,"dirname",(function(){return i}));n("lFjb");function i(e){var t=e&&e.lastIndexOf("/");return t>=0?e.substr(0,t):""}},oJR1:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r="undefined"!=typeof window?window:e,i=(void 0!==e||window,"undefined"!=typeof document?document:{})}).call(this,n("yLpj"))},q8n8:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var r="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i="undefined"!=typeof window?window:e,a=(void 0!==e||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){return a=!0,!0}};i.addEventListener("test",o,o),i.removeEventListener("test",o,o)}catch(s){}}).call(this,n("yLpj"))}}]);